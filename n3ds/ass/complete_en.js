if (typeof cave === "undefined") {
    window.cave = {
        toolbar_enableBackBtnFunc: function(enable) {
            console.log('cave.toolbar_enableBackBtnFunc(enable = ' + enable + ')');
        },

        toolbar_setCallback: function(btnType, callback) {
            console.log('cave.toolbar_setCallback(btnType = ' + btnType + ', callback = ' + typeof callback + ')');
        },

        toolbar_setVisible: function(visibility) {
            console.log('cave.toolbar_setVisible(visibility = ' + visibility + ')');
        },

        toolbar_setButtonType: function(type) {
            console.log('cave.toolbar_setButtonType(type = ' + type + ')');
        },

        toolbar_setActiveButton: function(btnType) {
            console.log('cave.toolbar_setActiveButton(btnType = ' + btnType + ')');
        },

        memo_open: function() {
            console.log('cave.memo_open()');
        },

        memo_clear: function() {
            console.log('cave.memo_clear()');
        },

        memo_hasValidImage: function() {
            console.log('cave.memo_hasValidImage()');
            return true;
        },

        memo_getImageBmp: function() {
            console.log('cave.memo_getImageBmp()');
            return 'Qk1SEwAAAAAAAJIAAAB8AAAAQAEAAHgAAAABAAEAAAAAAMASAAASCwAAEgsAAAIAAAACAAAAAAD/AAD/AAD/AAAAAAAA/0JHUnOPwvUoUbgeFR6F6wEzMzMTZmZmJmZmZgaZmZkJPQrXAyhcjzIAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAP///wD/////////////////////+P/////8f/////////////////////////////////////////////j//////H/////////////////////////////////////////////4//////x/////////////////////////////////////////////+P/////8f////////////////////////////////////////4A///h//////H////////////////////////////////////////4AH//4f/////x////////////////////////////////////////+Hx///H/////8f////////////////////////////////////////j8H//x//////H////////////////////////////////////////4wB//8f/////x////////////////////////////////////////+AAP//D//h//8f////////////////////////////////////////wPh//4//4f//H////////////////////////////////////////8H4f/+P/+H//x/////////////////////////////////////////h/D//j/////8f////////////////////////////////////////4f4f/4//////H/////////////////////////////////////////D/D/+P/////x/////////////////////////////////////////w/w//j/////8f////////////////////////////////////////+H+H/4//////H/////////////////////////////////////////w/g/+P/////x/////////////////////////////////////////8P+H/j//A//8f/////////////////////////////////////////h/h/4//wP//H/////////////////////////////////////////8f8P+P/4B//x//////////////////////////////////////////D/D/j/8Mf/8f/////////////////////////////////////////4f4f4/+HD//H/////////////////////////////////////////+D+H+P/h4//x//////////////////////////////////////////4fwfj/w+H/8f/wB//////////////////////////////////////+H+H4/8Ph//H/wAP//////////////////////////////////////w/w+H+H4P/x/wPA//////////////////////////////////////+H+Hx/h+D/8fwH4H//////////////////////////////////////x/w8f4Pgf/HwP/wf/////////////////////////////////////8P8HH8D4H/x4H/8D//////////////////////////////////////h/wx/A8A/8YP//4H/////////////////////////////////////8f8EfgPEP/EH///B//////////////////////////////////////D/gH4jxj/wH///8H/////////////////////////////////////4f8B+I8Y/8D////g//////////////////////////////////////D/gfCHGH/D/8B/8D/////////////////////////////////////4f8Hwhxx/w/+AP/gf/////////////////////////////////////D/h8cccf///Bg/+D/////////////////////////////////////4f//HHHH///g8H/wf/////////////////////////////////////D//hxhw///w/gf+D/////////////////////////////////////wf/48YeP//4P+D/4f/////////////////////////////////////D/+PCPj//4P/wf/A/////////////////////////////////////w//Dwj4//8H//B/4H////////////////////////////////////+D/x+A+P/+D//4H/h/////////////////////////////////////w/8fgPj//D///g/4D////////////////////////////////////+D/GAAAf/B///+D8AP////////////////////////////////////w/xAAAH/g////wPDD////////////////////////////////////+H8ADAB/w/////BB4f////////////////////////////////////w/Aggwf4f////4A/H////////////////////////////////////+HweA/D4P/////gfh/////////////////////////////////////w4Pgfw8H/////8Hwf///////////////////////////////////+AAAAB+EH//////wAP//////////////////////////////////+AAAAAAAAAf/////8AH//////////////////////////////////gAB+P//gAAAAH////////////////////////////////////////4B///////H4AB////////////////////////////////////////+P//////////4f////////////////////////////////////////j//////////+H////////////////////////////////////////4///////////j////////////////////////////////////////+P//////////4/////////////////////////////////////////j//////////8P////////////////////////////////////////4///////////D////////////////////////////////////////+P//////////x/////////////////////////////////////////j//////////8f////////////////////////////////////////4////wD/////H////////////////////////////////////////+P///4AP////x/////////////////////////////////////////h///wPAH///8f////////////////////////////////////////4f//4H8Af///H//////////////////////////////////////8ADH//wP/+AP//x//////////////////////////////////////8AAB//wH//4B//8YB////////////////////////////////////+D/Af/wP///8B//AAAP///////////////////////////////////j/8H/4H////gH/wHgA/////////////////////////////////8AA//x/8P/////gP8f/8H///////AAAAAAAAP////////////////+AAP/8f+H/////+A/H//x///////wAAAAAAAD////////////////+D////H+D8P///H8Bx//4f//////////////w/////////////////h////x/B/D///x/wEf/8AH///////////////////////////////4////8fB/x///8f/gH//AAP//////////////////////////////+H////HA/8f///H/8B///+B/////////////////////////////8AA////xg//H///x//4f///8H////////////////////////////8AAP///8Q//x///8f//H////h////////////////////////////8D//////Af/4f///H//x////8f///////////////////////////+D//////wP/+P///x//8f////H////////////////////////////D//////8H//j///8f//H////h////////////////////////////h///////H//4////H//x////w////////////////////////////4///////x///////x//8D///gf///////////////////////////+P/////8Af//////////AH//4D////////////////////////////j/////AAH//////////xAP/+AD////////H//////////////////4/////ADj//////////8eB///Af///////w//////////////////+P///wA/4///////////H8H///D///////+H//////////////////h///wA/8P//////////x/gf//w//////g/g//////////////////8P//AP//D//////////8f+B//+P/////4P+P//////////////////D/+AP//w/gAAAAAAAAAH/4H//j/////+H/j//////////////////4P4A///8AAAAAAAAAAAB//gf/4////j/w/////////////////////BgB////gAf///////////+D/+P///4f+P////////////////////4AH///////////////////4H/D////D/h/4D//////////////////Af////////////////////Afg/x//w/AP+A////////////////////////////////////////+Awf8f/+MAB/h/////////////////////////////////////////wAP/D//gA4f8f/////////////////////////////////////////wP/4//8D/D///////////////////////////////////////////+D/+P//A/4///////////////////////////////////////////////j//4f+H//////////////////////////////////////////////4f//H/x///////////////////////////////////////////////H//w/////////////////////////////////////////////////w//8H////////////////////////////////////////////////+P//x/////////////////////////////////////////////////h////////////////////////////////////////////////////8P////////////////////////////////////////////////////D////////////////////////////////////////////////////4////////////////////////////////////////////////////+P////////////////////////////////////////////////////j////////////////////////////////////////////////////4//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8=';
        },

        memo_getImageRawTga: function() {
            console.log('cave.memo_getImageRawTga()');
            return 'Qk1CAAAAAAAAAD4AAAAoAAAAAQAAAAEAAAABAAEAAAAAAAQAAADEDgAAxA4AAAAAAAAAAAAAAAAAAP///wCAAAAAAAAA';
        },

        toolbar_setNotificationCount: function(count) {
            console.log('cave.toolbar_setNotificationCount(' + count + ')');
        },

        error_callErrorViewer: function(errorCode) {
            var fakeMessage = 'Message for error code ' + errorCode;
            alert(errorCode + '\n\n' + fakeMessage);
        },

        error_callFreeErrorViewer: function(errorCode, message) {
            alert(errorCode + '\n\n' + message);
        },

        transition_begin: function() {
            console.log('cave.transition_begin()');
        },
        transition_end: function() {
            console.log('cave.transition_end()');
        },
        transition_beginWithoutEffect: function() {
            console.log('cave.transition_beginWithoutEffect()');
        },
        transition_endWithoutEffect: function() {
            console.log('cave.transition_endWithoutEffect()');
        },

        ls_setItem: function(key, value) {
            console.log('cave.ls_setItem()');
            // string でないと実機でエラー出るので挙動を合わせる
            for (var i = 0; i < 2; i++) {
                if (typeof arguments[i] !== 'string') {
                    console.error('Argument ' + i + ' should be string');
                    console.error('JavaScript Extension error. Arguments Count or Argument Type is not mutch. Or , too big arguments.');
                    return undefined;
                }
            }
            sessionStorage.setItem(key, value);
        },
        ls_getItem: function(key) {
            console.log('cave.ls_getItem()');
            if (typeof key !== 'string') {
                console.error('Argument 0 should be string');
                console.error('JavaScript Extension error. Arguments Count or Argument Type is not mutch. Or , too big arguments.');
                return undefined;
            }
            return sessionStorage.getItem(key);
        },
        ls_removeItem: function(key) {
            console.log('cave.ls_removeItem()');
            sessionStorage.removeItem(key);
        },
        // ゲスト初回起動済みフラグをセットする
        ls_setGuestModeLaunched: function(bool) {
            console.log('cave.ls_setGuestModeLaunched( ' + bool + ' )');
        },
        lls_setItem: function(key, value) {
            console.log('cave.lls_setItem()');
            localStorage.setItem(key, value);
        },
        lls_getCount: function() {
            console.log('cave.lls_getCount()');
            return localStorage.length;
        },
        lls_getItem: function(key) {
            console.log('cave.lls_getItem()');
            return localStorage.getItem(key);
        },
        lls_removeItem: function(key) {
            console.log('cave.lls_removeItem()');
            return localStorage.removeItem(key);
        },
        ls_canUseCachedServiceToken: function() {
            console.log('cave.ls_canUseCachedServiceToken()');
            return sessionStorage.getItem('custk') === '1' ? true : false;
        },
        ls_setCanUseCachedServiceToken: function(can_use) {
            console.log('cave.ls_setCanUseCachedServiceToken');
            var flag = can_use ? '1' : '0';
            sessionStorage.setItem('custk', flag);
        },
        dialog_oneButton: function(title, message, button_text) {
            console.log('cave.dialog_oneButton()');
            alert("タイトル:" + title + "\n" + "メッセージ:" + message + "\n\n[ " + button_text + " ]");
            return 0;
        },
        lls_getKeyAt: function(index) {
            console.log('cave.lls_getKeyAt index = ' + index);
            return localStorage.key(index);
        },
        mii_getIconBase64: function(expression) {
            console.log('cave.mii_getIconBase64 expression = ' + expression);
            // 本来表情毎に出し分けるべきだが、とりあえず固定のものを出す
            return 'data:image/png;base64,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';
        },
        mii_getName: function() {
            console.log('cave.mii_getName');
            return 'chris4403';
        },
        dialog_twoButton: function(title, message, buttonL_text, buttonR_text) {
            console.log('cave.dialog_twoButton()');
            var result = confirm("タイトル:" + title + "\n" + "メッセージ:" + message + "\n\n[ " + buttonL_text + " (Cancel) ] [ " + buttonR_text + " (OK) ]");
            return result ? 1 : 0;
        },

        brw_scrollImmediately: function(posX, posY) {
            console.log('cave.brw_scrollImmediately(posX='+posX+', posY='+posY+')');
            window.scroll(posX, posY);
        },

        brw_getScrollTopX: function() {
            console.log('cave.brw_getScrollTopX()');
            return window.pageXOffset;
        },

        brw_getScrollTopY: function() {
            console.log('cave.brw_getScrollTopY()');
            return window.pageYOffset;
        },

        brw_notifyPageMoving: function() {
            console.log('cave.brw_notifyPageMoving()');
        },

        requestGc: function() {
            console.log('requestGc');
        },

        exitApp: function() {
            console.log('cave.exitApp()');
        },

        plog_getPlayTitlesFilteredByPlayTime: function(minutes) {
            console.log('cave.plog_getPlayTitlesFilteredByPlayTime(' + minutes + ')');
            return '{"IDs":["0004001000020700"]}'; // Miiスタジオ
        },

        jump_toAccount: function() {
            console.log('cave.jump_toAccount()');
        },

        snd_playSe: function(label) {
            console.log('cave.snd_playSe(' + label + ')');
        },

        snd_playBgm: function(label) {
            console.log('cave.snd_playBgm(' + label + ')');
        },

        sap_exists: function() {
            console.log('cave.sap_exists()');
            return false;
        },

        sap_programId: function() {
            console.log('cave.sap_programId()');
            return undefined;
        },

        capture_getLowerImage: function() {
            console.log('cave.capture_getLowerImage()');
        },

        capture_getUpperImageLeft: function() {
            console.log('cave.capture_getUpperImageLeft()');
        },

        capture_getUpperImageRight: function() {
            console.log('cave.capture_getUpperImageRight()');
        },

        capture_getUpperImage3D: function() {
            console.log('cave.capture_getUpperImage3D()');
        },

        capture_getLowerImageDetail: function(width, height, quality, format) {
            console.log('cave.capture_getLowerImageDetail('+
                        [width, height, quality, format].join(', ')
                        +')');
        },

        capture_getUpperImageLeftDetail: function(width, height, quality, format) {
            console.log('cave.capture_getUpperImageLeftDetail('+
                        [width, height, quality, format].join(', ')
                        +')');
        },

        capture_getUpperImageRightDetail: function(width, height, quality, format) {
            console.log('cave.capture_getUpperImageRightDetail('+
                        [width, height, quality, format].join(', ')
                        +')');
        },

        capture_getUpperImage3DDetail: function(width, height, quality, format) {
            console.log('cave.capture_getUpperImage3DDetail('+
                        [width, height, quality, format].join(', ')
                        +')');
        },

        capture_notifyUpdatedLocalList: function() {
            console.log('cave.capture_notifyUpdatedLocalList()');
        },

        capture_isEnabled: function() {
            console.log('cave.capture_isEnabled()');
            return false;
        },
        capture_isEnabledEx: function(screen) {
            console.log('cave.capture_isEnabledEx(' + screen +')');

            // テスト等でスクショの有無を固定したい場合にクッキーで指定できるようにする, 実機ではこの挙動は存在しない
            var force = Olv.Cookie.get('force_screenshot_for_test');
            if (force === 'true')  return true;
            if (force === 'false') return false;

            return Math.random() >= 0.5 ? true : false;
        },

        boss_regist: function(interval_hour) {
            console.log('cave.boss_regist(' + interval_hour + ')');
            return true;
        },
        boss_registEx: function(interval_hour, count) {
            console.log('cave.boss_regist(' + interval_hour + ',' + count + ')');
            return true;
        },

        boss_unregist: function() {
            console.log('cave.boss_unregist()');
        },

        boss_isRegisted: function() {
            console.log('cave.boss_isRegisted()');
            return true;
        },

        boss_clearNewArrival: function() {
            console.log('cave.boss_clearNewArrival()');
        },
        lls_clear: function() {
            console.log('cave.lls_clear()');
            localStorage.clear();
        },
        lls_setCaptureImage: function(key, value) {
            console.log('cave.setCaptureImage(' + [key, value].join(', ') + ')');
            localStorage.setItem(key, value);
            return 0;
        },
        lls_getPath: function(key) {
            console.log('cave.getPath(' +  key + ')');
            var value = localStorage.getItem(key);
            if (value == 0) {
                return '/img/dummy-image/screenshot-dummy-3ds-low.jpeg';
            } else {
                return '/img/dummy-image/screenshot-dummy-3ds-upper.jpeg';
            }
        },

        history_getPrev: function() {
            console.log('cave.history_getPrev()');
            // 直前の履歴項目の URL を返す API だが、
            // とりあえずは referrer で代用しておく。
            return document.referrer;
        },
        history_removePrev: function() {
            console.log('cave.history_removePrev()');
        },
        history_getAt: function(backIndex) {
            console.log('cave.history_getAt(' + backIndex + ')');
            return '';
        },
        history_removeAt: function(backIndex) {
            console.log('cave.history_removeAt(' + backIndex + ')');
        },

        history_getBackCount: function() {
            console.log('cave.history_getBackCount()');
            // 戻ることのできるページ数を返すAPIだが、
            // とりあえずは referrer で代用しておく。
            return !!document.referrer ? 1 : 0;
        },

        toolbar_setMode: function(mode) {
            console.log('cave.toolbar_setMode(' + mode + ')');
        },
        toolbar_setWideButtonMessage: function(message) {
            console.log('cave.toolbar_setWideButtonMessage(' + message + ')')
        },
        jump_existsWebbrs: function() {
            console.log('jump_existsWebbrs()');
            return true;
        },
        jump_toSystemUpdate: function(type) {
            console.log('jump_toSystemUpdate(' + type + ')')
        },
        jump_toWebbrs: function(url) {
            console.log('cave.jump_toWebbrs(' + url + ')');
            window.location.href = url;
            return true;
        },
        jump_toShop: function(dialog, titleId) {
            console.log('cave.jump_toShop(' + dialog + ', ' + titleId + ')');
            return true;
        },
        jump_getYoutubeVersion: function() {
            console.log('cave.jump_getYoutubeVersion()');
            return -1;
        },
        jump_suspendedToutube: function(query) {
            console.log('cave.jump_suspendedToutube(' + query + ')');
            return 1;
        },
        jump_toYoutube: function(dialog, query) {
            console.log('cave.jump_toYoutube(' + dialog + ', ' + query + ')');
            return 1;
        },
        jump_existsApplication: function(titleId) {
            console.log('jump_existsApplication(' + titleId + ')');
            return true;
        },
        jump_resetParamToApp: function() {
            console.log('jump_resetParamToApp');
        },
        jump_canUseQuery: function(titleId) {
            console.log('jump_canUseQuery(' + titleId + ')');
            return true;
        },
        jump_setModeToApp: function(mode) {
            console.log('jump_setModeToApp(' + mode + ')');
        },
        jump_setDataUTF8ToApp: function(type, data) {
            console.log('jump_setDataUTF8ToApp(' + type + ', ' + data + ')');
        },
        jump_setNumberDataToApp: function(type, data) {
            console.log('jump_setNumberDataToApp(' + type + ', ' + data + ')');
        },
        jump_setBase64DataToApp: function(type, data) {
            console.log('jump_setBase64DataToApp(' + type + ', ' + data + ')');
        },
        jump_toApplication: function(dialog, titleId) {
            console.log('cave.jump_toApplication(' + dialog + ', ' + titleId + ')');
            return true;
        },
        convertTimeToString: function(unixTime) {
            console.log('cave.convertTimeToString(' + unixTime + ')');
            var date = new Date(unixTime * 1000);
            return date.getFullYear() + '-' + this._toDoubleDigits( date.getMonth() + 1 ) + '-' + this._toDoubleDigits(date.getDate())
            + ' ' + this._toDoubleDigits(date.getHours()) + ':' + this._toDoubleDigits(date.getMinutes()) + ':' + this._toDoubleDigits(date.getSeconds());
        },
        _toDoubleDigits: function (num) {
            num +="";
            if (num.length === 1) {
                num = "0" + num;
            }
            return num;
        },
        getLocalTimeSeconds: function () {
            console.log('cave.getLocalTimeSeconds()');
            return parseInt(new Date().getTime() / 1000);
        },
        effect_scrollGuide: function(flag) {
            console.log('cave.effect_scrollGuide( ' + flag + ' )');
        },
        effect_setScrollGuideOffsetPos: function(x, y) {
            console.log('effect_setScrollGuideOffsetPos( x = ' + x + ', y = ' + ' )');
        },
        // キーボードアプレットに入力した文字列が返り値になるので window.prompt でエミュレートする
        swkbd_callFullKeyboard: function(text, maxLength, minLength, isMonospace, isMultiline, isConvertible) {
            console.log('cave.callFullKeyboard( ' + Array.prototype.join.call(arguments, ', ') + ' )');
            return window.prompt('cave.callFullKeyboard', text);
        },
        swkbd_callFullKeyboardWithGuide: function(text, maxLength, minLength, isMonospace, isMultiline, isConvertible, guide) {
            console.log('cave.callFullKeyboardWithGuide( ' + Array.prototype.join.call(arguments, ', ') + ' )');
            return window.prompt('cave.callFullKeyboardWithGuide [' + guide + ']', text);
        },
        viewer_setOnCloseCallback: function(callback) {
            console.log('cave.viewer_setOnCloseCallback(callback = ' + typeof callback + ')');
        },
        home_setEnabled: function(flag) {
            console.log('cave.home_setEnabled', flag);
        },
    };
}

</script><style type="text/css">* {}</style>
    <script>
/* Zepto v1.0-1-ga3cab6c - polyfill zepto detect event ajax form fx - zeptojs.com/license */
/**
#Simply Deferred
###Simplified Deferred Library (jQuery API) for Node and the Browser
####MIT Licensed.
Portions of this code are inspired and borrowed from [underscore.js](http://underscorejs.org/) (MIT License)
####[Source (github)](http://github.com/sudhirj/simply-deferred) | [Documentation](https://github.com/sudhirj/simply-deferred#simply-deferred)
&copy; Sudhir Jonathan [sudhirjonathan.com](http://www.sudhirjonathan.com)
 */
/**
 * @license
 * Lo-Dash 1.3.1 (Custom Build) lodash.com/license | Underscore.js 1.5.1 underscorejs.org/LICENSE
 * Build: `lodash backbone exports="amd,commonjs,global,node" -o ./dist/lodash.backbone.js`
 */
//     Backbone.js 1.0.0

//     (c) 2010-2011 Jeremy Ashkenas, DocumentCloud Inc.
//     (c) 2011-2013 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://backbonejs.org

/* Zepto v1.0-1-ga3cab6c - polyfill zepto detect event ajax form fx - zeptojs.com/license */(function(e){String.prototype.trim===e&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Array.prototype.reduce===e&&(Array.prototype.reduce=function(t){if(this===void 0||this===null)throw new TypeError;var n=Object(this),r=n.length>>>0,i=0,s;if(typeof t!="function")throw new TypeError;if(r==0&&arguments.length==1)throw new TypeError;if(arguments.length>=2)s=arguments[1];else do{if(i in n){s=n[i++];break}if(++i>=r)throw new TypeError}while(!0);while(i<r)i in n&&(s=t.call(e,s,n[i],i,n)),i++;return s})})();var Zepto=function(){function O(e){return e==null?String(e):T[N.call(e)]||"object"}function M(e){return O(e)=="function"}function _(e){return e!=null&&e==e.window}function D(e){return e!=null&&e.nodeType==e.DOCUMENT_NODE}function P(e){return O(e)=="object"}function H(e){return P(e)&&!_(e)&&e.__proto__==Object.prototype}function B(e){return e instanceof Array}function j(e){return typeof e.length=="number"}function F(e){return o.call(e,function(e){return e!=null})}function I(e){return e.length>0?n.fn.concat.apply([],e):e}function q(e){return e.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function R(e){return e in f?f[e]:f[e]=new RegExp("(^|\\s)"+e+"(\\s|$)")}function U(e,t){return typeof t=="number"&&!c[q(e)]?t+"px":t}function z(e){var t,n;return a[e]||(t=u.createElement(e),u.body.appendChild(t),n=l(t,"").getPropertyValue("display"),t.parentNode.removeChild(t),n=="none"&&(n="block"),a[e]=n),a[e]}function W(e){return"children"in e?s.call(e.children):n.map(e.childNodes,function(e){if(e.nodeType==1)return e})}function X(n,r,i){for(t in r)i&&(H(r[t])||B(r[t]))?(H(r[t])&&!H(n[t])&&(n[t]={}),B(r[t])&&!B(n[t])&&(n[t]=[]),X(n[t],r[t],i)):r[t]!==e&&(n[t]=r[t])}function V(t,r){return r===e?n(t):n(t).filter(r)}function $(e,t,n,r){return M(t)?t.call(e,n,r):t}function J(e,t,n){n==null?e.removeAttribute(t):e.setAttribute(t,n)}function K(t,n){var r=t.className,i=r&&r.baseVal!==e;if(n===e)return i?r.baseVal:r;i?r.baseVal=n:t.className=n}function Q(e){var t;try{return e?e=="true"||(e=="false"?!1:e=="null"?null:isNaN(t=Number(e))?/^[\[\{]/.test(e)?n.parseJSON(e):e:t):e}catch(r){return e}}function G(e,t){t(e);for(var n in e.childNodes)G(e.childNodes[n],t)}var e,t,n,r,i=[],s=i.slice,o=i.filter,u=window.document,a={},f={},l=u.defaultView.getComputedStyle,c={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},h=/^\s*<(\w+|!)[^>]*>/,p=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,d=/^(?:body|html)$/i,v=["val","css","html","text","data","width","height","offset"],m=["after","prepend","before","append"],g=u.createElement("table"),y=u.createElement("tr"),b={tr:u.createElement("tbody"),tbody:g,thead:g,tfoot:g,td:y,th:y,"*":u.createElement("div")},w=/complete|loaded|interactive/,E=/^\.([\w-]+)$/,S=/^#([\w-]*)$/,x=/^[\w-]+$/,T={},N=T.toString,C={},k,L,A=u.createElement("div");return C.matches=function(e,t){if(!e||e.nodeType!==1)return!1;var n=e.webkitMatchesSelector||e.mozMatchesSelector||e.oMatchesSelector||e.matchesSelector;if(n)return n.call(e,t);var r,i=e.parentNode,s=!i;return s&&(i=A).appendChild(e),r=~C.qsa(i,t).indexOf(e),s&&A.removeChild(e),r},k=function(e){return e.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})},L=function(e){return o.call(e,function(t,n){return e.indexOf(t)==n})},C.fragment=function(t,r,i){t.replace&&(t=t.replace(p,"<$1></$2>")),r===e&&(r=h.test(t)&&RegExp.$1),r in b||(r="*");var o,u,a=b[r];return a.innerHTML=""+t,u=n.each(s.call(a.childNodes),function(){a.removeChild(this)}),H(i)&&(o=n(u),n.each(i,function(e,t){v.indexOf(e)>-1?o[e](t):o.attr(e,t)})),u},C.Z=function(e,t){return e=e||[],e.__proto__=n.fn,e.selector=t||"",e},C.isZ=function(e){return e instanceof C.Z},C.init=function(t,r){if(!t)return C.Z();if(M(t))return n(u).ready(t);if(C.isZ(t))return t;var i;if(B(t))i=F(t);else if(P(t))i=[H(t)?n.extend({},t):t],t=null;else if(h.test(t))i=C.fragment(t.trim(),RegExp.$1,r),t=null;else{if(r!==e)return n(r).find(t);i=C.qsa(u,t)}return C.Z(i,t)},n=function(e,t){return C.init(e,t)},n.extend=function(e){var t,n=s.call(arguments,1);return typeof e=="boolean"&&(t=e,e=n.shift()),n.forEach(function(n){X(e,n,t)}),e},C.qsa=function(e,t){var n;return D(e)&&S.test(t)?(n=e.getElementById(RegExp.$1))?[n]:[]:e.nodeType!==1&&e.nodeType!==9?[]:s.call(E.test(t)?e.getElementsByClassName(RegExp.$1):x.test(t)?e.getElementsByTagName(t):e.querySelectorAll(t))},n.contains=function(e,t){return e!==t&&e.contains(t)},n.type=O,n.isFunction=M,n.isWindow=_,n.isArray=B,n.isPlainObject=H,n.isEmptyObject=function(e){var t;for(t in e)return!1;return!0},n.inArray=function(e,t,n){return i.indexOf.call(t,e,n)},n.camelCase=k,n.trim=function(e){return e.trim()},n.uuid=0,n.support={},n.expr={},n.map=function(e,t){var n,r=[],i,s;if(j(e))for(i=0;i<e.length;i++)n=t(e[i],i),n!=null&&r.push(n);else for(s in e)n=t(e[s],s),n!=null&&r.push(n);return I(r)},n.each=function(e,t){var n,r;if(j(e)){for(n=0;n<e.length;n++)if(t.call(e[n],n,e[n])===!1)return e}else for(r in e)if(t.call(e[r],r,e[r])===!1)return e;return e},n.grep=function(e,t){return o.call(e,t)},window.JSON&&(n.parseJSON=JSON.parse),n.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){T["[object "+t+"]"]=t.toLowerCase()}),n.fn={forEach:i.forEach,reduce:i.reduce,push:i.push,sort:i.sort,indexOf:i.indexOf,concat:i.concat,map:function(e){return n(n.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return n(s.apply(this,arguments))},ready:function(e){return w.test(u.readyState)?e(n):u.addEventListener("DOMContentLoaded",function(){e(n)},!1),this},get:function(t){return t===e?s.call(this):this[t>=0?t:t+this.length]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each(function(){this.parentNode!=null&&this.parentNode.removeChild(this)})},each:function(e){return i.every.call(this,function(t,n){return e.call(t,n,t)!==!1}),this},filter:function(e){return M(e)?this.not(this.not(e)):n(o.call(this,function(t){return C.matches(t,e)}))},add:function(e,t){return n(L(this.concat(n(e,t))))},is:function(e){return this.length>0&&C.matches(this[0],e)},not:function(t){var r=[];if(M(t)&&t.call!==e)this.each(function(e){t.call(this,e)||r.push(this)});else{var i=typeof t=="string"?this.filter(t):j(t)&&M(t.item)?s.call(t):n(t);this.forEach(function(e){i.indexOf(e)<0&&r.push(e)})}return n(r)},has:function(e){return this.filter(function(){return P(e)?n.contains(this,e):n(this).find(e).size()})},eq:function(e){return e===-1?this.slice(e):this.slice(e,+e+1)},first:function(){var e=this[0];return e&&!P(e)?e:n(e)},last:function(){var e=this[this.length-1];return e&&!P(e)?e:n(e)},find:function(e){var t,r=this;return typeof e=="object"?t=n(e).filter(function(){var e=this;return i.some.call(r,function(t){return n.contains(t,e)})}):this.length==1?t=n(C.qsa(this[0],e)):t=this.map(function(){return C.qsa(this,e)}),t},closest:function(e,t){var r=this[0],i=!1;typeof e=="object"&&(i=n(e));while(r&&!(i?i.indexOf(r)>=0:C.matches(r,e)))r=r!==t&&!D(r)&&r.parentNode;return n(r)},parents:function(e){var t=[],r=this;while(r.length>0)r=n.map(r,function(e){if((e=e.parentNode)&&!D(e)&&t.indexOf(e)<0)return t.push(e),e});return V(t,e)},parent:function(e){return V(L(this.pluck("parentNode")),e)},children:function(e){return V(this.map(function(){return W(this)}),e)},contents:function(){return this.map(function(){return s.call(this.childNodes)})},siblings:function(e){return V(this.map(function(e,t){return o.call(W(t.parentNode),function(e){return e!==t})}),e)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(e){return n.map(this,function(t){return t[e]})},show:function(){return this.each(function(){this.style.display=="none"&&(this.style.display=null),l(this,"").getPropertyValue("display")=="none"&&(this.style.display=z(this.nodeName))})},replaceWith:function(e){return this.before(e).remove()},wrap:function(e){var t=M(e);if(this[0]&&!t)var r=n(e).get(0),i=r.parentNode||this.length>1;return this.each(function(s){n(this).wrapAll(t?e.call(this,s):i?r.cloneNode(!0):r)})},wrapAll:function(e){if(this[0]){n(this[0]).before(e=n(e));var t;while((t=e.children()).length)e=t.first();n(e).append(this)}return this},wrapInner:function(e){var t=M(e);return this.each(function(r){var i=n(this),s=i.contents(),o=t?e.call(this,r):e;s.length?s.wrapAll(o):i.append(o)})},unwrap:function(){return this.parent().each(function(){n(this).replaceWith(n(this).children())}),this},clone:function(){return this.map(function(){return this.cloneNode(!0)})},hide:function(){return this.css("display","none")},toggle:function(t){return this.each(function(){var r=n(this);(t===e?r.css("display")=="none":t)?r.show():r.hide()})},prev:function(e){return n(this.pluck("previousElementSibling")).filter(e||"*")},next:function(e){return n(this.pluck("nextElementSibling")).filter(e||"*")},html:function(t){return t===e?this.length>0?this[0].innerHTML:null:this.each(function(e){var r=this.innerHTML;n(this).empty().append($(this,t,e,r))})},text:function(t){return t===e?this.length>0?this[0].textContent:null:this.each(function(){this.textContent=t})},attr:function(n,r){var i;return typeof n=="string"&&r===e?this.length==0||this[0].nodeType!==1?e:n=="value"&&this[0].nodeName=="INPUT"?this.val():!(i=this[0].getAttribute(n))&&n in this[0]?this[0][n]:i:this.each(function(e){if(this.nodeType!==1)return;if(P(n))for(t in n)J(this,t,n[t]);else J(this,n,$(this,r,e,this.getAttribute(n)))})},removeAttr:function(e){return this.each(function(){this.nodeType===1&&J(this,e)})},prop:function(t,n){return n===e?this[0]&&this[0][t]:this.each(function(e){this[t]=$(this,n,e,this[t])})},data:function(t,n){var r=this.attr("data-"+q(t),n);return r!==null?Q(r):e},val:function(t){return t===e?this[0]&&(this[0].multiple?n(this[0]).find("option").filter(function(e){return this.selected}).pluck("value"):this[0].value):this.each(function(e){this.value=$(this,t,e,this.value)})},offset:function(e){if(e)return this.each(function(t){var r=n(this),i=$(this,e,t,r.offset()),s=r.offsetParent().offset(),o={top:i.top-s.top,left:i.left-s.left};r.css("position")=="static"&&(o.position="relative"),r.css(o)});if(this.length==0)return null;var t=this[0].getBoundingClientRect();return{left:t.left+window.pageXOffset,top:t.top+window.pageYOffset,width:Math.round(t.width),height:Math.round(t.height)}},css:function(e,n){if(arguments.length<2&&typeof e=="string")return this[0]&&(this[0].style[k(e)]||l(this[0],"").getPropertyValue(e));var r="";if(O(e)=="string")!n&&n!==0?this.each(function(){this.style.removeProperty(q(e))}):r=q(e)+":"+U(e,n);else for(t in e)!e[t]&&e[t]!==0?this.each(function(){this.style.removeProperty(q(t))}):r+=q(t)+":"+U(t,e[t])+";";return this.each(function(){this.style.cssText+=";"+r})},index:function(e){return e?this.indexOf(n(e)[0]):this.parent().children().indexOf(this[0])},hasClass:function(e){return i.some.call(this,function(e){return this.test(K(e))},R(e))},addClass:function(e){return this.each(function(t){r=[];var i=K(this),s=$(this,e,t,i);s.split(/\s+/g).forEach(function(e){n(this).hasClass(e)||r.push(e)},this),r.length&&K(this,i+(i?" ":"")+r.join(" "))})},removeClass:function(t){return this.each(function(n){if(t===e)return K(this,"");r=K(this),$(this,t,n,r).split(/\s+/g).forEach(function(e){r=r.replace(R(e)," ")}),K(this,r.trim())})},toggleClass:function(t,r){return this.each(function(i){var s=n(this),o=$(this,t,i,K(this));o.split(/\s+/g).forEach(function(t){(r===e?!s.hasClass(t):r)?s.addClass(t):s.removeClass(t)})})},scrollTop:function(){if(!this.length)return;return"scrollTop"in this[0]?this[0].scrollTop:this[0].scrollY},position:function(){if(!this.length)return;var e=this[0],t=this.offsetParent(),r=this.offset(),i=d.test(t[0].nodeName)?{top:0,left:0}:t.offset();return r.top-=parseFloat(n(e).css("margin-top"))||0,r.left-=parseFloat(n(e).css("margin-left"))||0,i.top+=parseFloat(n(t[0]).css("border-top-width"))||0,i.left+=parseFloat(n(t[0]).css("border-left-width"))||0,{top:r.top-i.top,left:r.left-i.left}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||u.body;while(e&&!d.test(e.nodeName)&&n(e).css("position")=="static")e=e.offsetParent;return e})}},n.fn.detach=n.fn.remove,["width","height"].forEach(function(t){n.fn[t]=function(r){var i,s=this[0],o=t.replace(/,function(e){return e[0].toUpperCase()});return r===e?_(s)?s["inner"+o]:D(s)?s.documentElement["offset"+o]:(i=this.offset())&&i[t]:this.each(function(e){s=n(this),s.css(t,$(this,r,e,s[t]()))})}}),m.forEach(function(e,t){var r=t%2;n.fn[e]=function(){var e,i=n.map(arguments,function(t){return e=O(t),e=="object"||e=="array"||t==null?t:C.fragment(t)}),s,o=this.length>1;return i.length<1?this:this.each(function(e,u){s=r?u:u.parentNode,u=t==0?u.nextSibling:t==1?u.firstChild:t==2?u:null,i.forEach(function(e){if(o)e=e.cloneNode(!0);else if(!s)return n(e).remove();G(s.insertBefore(e,u),function(e){e.nodeName!=null&&e.nodeName.toUpperCase()==="SCRIPT"&&(!e.type||e.type==="text/javascript")&&!e.src&&window.eval.call(window,e.innerHTML)})})})},n.fn[r?e+"To":"insert"+(t?"Before":"After")]=function(t){return n(t)[e](this),this}}),C.Z.prototype=n.fn,C.uniq=L,C.deserializeValue=Q,n.zepto=C,n}();window.Zepto=Zepto,"$"in window||(window.$=Zepto),function(e){function t(e){var t=this.os={},n=this.browser={},r=e.match(/WebKit\/([\d.]+)/),i=e.match(/(Android)\s+([\d.]+)/),s=e.match(/(iPad).*OS\s([\d_]+)/),o=!s&&e.match(/(iPhone\sOS)\s([\d_]+)/),u=e.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),a=u&&e.match(/TouchPad/),f=e.match(/Kindle\/([\d.]+)/),l=e.match(/Silk\/([\d._]+)/),c=e.match(/(BlackBerry).*Version\/([\d.]+)/),h=e.match(/(BB10).*Version\/([\d.]+)/),p=e.match(/(RIM\sTablet\sOS)\s([\d.]+)/),d=e.match(/PlayBook/),v=e.match(/Chrome\/([\d.]+)/)||e.match(/CriOS\/([\d.]+)/),m=e.match(/Firefox\/([\d.]+)/);if(n.webkit=!!r)n.version=r[1];i&&(t.android=!0,t.version=i[2]),o&&(t.ios=t.iphone=!0,t.version=o[2].replace(/_/g,".")),s&&(t.ios=t.ipad=!0,t.version=s[2].replace(/_/g,".")),u&&(t.webos=!0,t.version=u[2]),a&&(t.touchpad=!0),c&&(t.blackberry=!0,t.version=c[2]),h&&(t.bb10=!0,t.version=h[2]),p&&(t.rimtabletos=!0,t.version=p[2]),d&&(n.playbook=!0),f&&(t.kindle=!0,t.version=f[1]),l&&(n.silk=!0,n.version=l[1]),!l&&t.android&&e.match(/Kindle Fire/)&&(n.silk=!0),v&&(n.chrome=!0,n.version=v[1]),m&&(n.firefox=!0,n.version=m[1]),t.tablet=!!(s||d||i&&!e.match(/Mobile/)||m&&e.match(/Tablet/)),t.phone=!t.tablet&&!!(i||o||u||c||h||v&&e.match(/Android/)||v&&e.match(/CriOS\/([\d.]+)/)||m&&e.match(/Mobile/))}t.call(e,navigator.userAgent),e.__detect=t}(Zepto),function(e){function o(e){return e._zid||(e._zid=r++)}function u(e,t,r,i){t=a(t);if(t.ns)var s=f(t.ns);return(n[o(e)]||[]).filter(function(e){return e&&(!t.e||e.e==t.e)&&(!t.ns||s.test(e.ns))&&(!r||o(e.fn)===o(r))&&(!i||e.sel==i)})}function a(e){var t=(""+e).split(".");return{e:t[0],ns:t.slice(1).sort().join(" ")}}function f(e){return new RegExp("(?:^| )"+e.replace(" "," .* ?")+"(?: |$)")}function l(t,n,r){e.type(t)!="string"?e.each(t,r):t.split(/\s/).forEach(function(e){r(e,n)})}function c(e,t){return e.del&&(e.e=="focus"||e.e=="blur")||!!t}function h(e){return s[e]||e}function p(t,r,i,u,f,p){var d=o(t),v=n[d]||(n[d]=[]);l(r,i,function(n,r){var i=a(n);i.fn=r,i.sel=u,i.e in s&&(r=function(t){var n=t.relatedTarget;if(!n||n!==this&&!e.contains(this,n))return i.fn.apply(this,arguments)}),i.del=f&&f(r,n);var o=i.del||r;i.proxy=function(e){var n=o.apply(t,[e].concat(e.data));return n===!1&&(e.preventDefault(),e.stopPropagation()),n},i.i=v.length,v.push(i),t.addEventListener(h(i.e),i.proxy,c(i,p))})}function d(e,t,r,i,s){var a=o(e);l(t||"",r,function(t,r){u(e,t,r,i).forEach(function(t){delete n[a][t.i],e.removeEventListener(h(t.e),t.proxy,c(t,s))})})}function b(t){var n,r={originalEvent:t};for(n in t)!g.test(n)&&t[n]!==undefined&&(r[n]=t[n]);return e.each(y,function(e,n){r[e]=function(){return this[n]=v,t[e].apply(t,arguments)},r[n]=m}),r}function w(e){if(!("defaultPrevented"in e)){e.defaultPrevented=!1;var t=e.preventDefault;e.preventDefault=function(){this.defaultPrevented=!0,t.call(this)}}}var t=e.zepto.qsa,n={},r=1,i={},s={mouseenter:"mouseover",mouseleave:"mouseout"};i.click=i.mousedown=i.mouseup=i.mousemove="MouseEvents",e.event={add:p,remove:d},e.proxy=function(t,n){if(e.isFunction(t)){var r=function(){return t.apply(n,arguments)};return r._zid=o(t),r}if(typeof n=="string")return e.proxy(t[n],t);throw new TypeError("expected function")},e.fn.bind=function(e,t){return this.each(function(){p(this,e,t)})},e.fn.unbind=function(e,t){return this.each(function(){d(this,e,t)})},e.fn.one=function(e,t){return this.each(function(n,r){p(this,e,t,null,function(e,t){return function(){var n=e.apply(r,arguments);return d(r,t,e),n}})})};var v=function(){return!0},m=function(){return!1},g=/^([A-Z]|layer[XY]$)/,y={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};e.fn.delegate=function(t,n,r){return this.each(function(i,s){p(s,n,r,t,function(n){return function(r){var i,o=e(r.target).closest(t,s).get(0);if(o)return i=e.extend(b(r),{currentTarget:o,liveFired:s}),n.apply(o,[i].concat([].slice.call(arguments,1)))}})})},e.fn.undelegate=function(e,t,n){return this.each(function(){d(this,t,n,e)})},e.fn.live=function(t,n){return e(document.body).delegate(this.selector,t,n),this},e.fn.die=function(t,n){return e(document.body).undelegate(this.selector,t,n),this},e.fn.on=function(t,n,r){return!n||e.isFunction(n)?this.bind(t,n||r):this.delegate(n,t,r)},e.fn.off=function(t,n,r){return!n||e.isFunction(n)?this.unbind(t,n||r):this.undelegate(n,t,r)},e.fn.trigger=function(t,n){if(typeof t=="string"||e.isPlainObject(t))t=e.Event(t);return w(t),t.data=n,this.each(function(){"dispatchEvent"in this&&this.dispatchEvent(t)})},e.fn.triggerHandler=function(t,n){var r,i;return this.each(function(s,o){r=b(typeof t=="string"?e.Event(t):t),r.data=n,r.target=o,e.each(u(o,t.type||t),function(e,t){i=t.proxy(r);if(r.isImmediatePropagationStopped())return!1})}),i},"focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error".split(" ").forEach(function(t){e.fn[t]=function(e){return e?this.bind(t,e):this.trigger(t)}}),["focus","blur"].forEach(function(t){e.fn[t]=function(e){return e?this.bind(t,e):this.each(function(){try{this[t]()}catch(e){}}),this}}),e.Event=function(e,t){typeof e!="string"&&(t=e,e=t.type);var n=document.createEvent(i[e]||"Events"),r=!0;if(t)for(var s in t)s=="bubbles"?r=!!t[s]:n[s]=t[s];return n.initEvent(e,r,!0,null,null,null,null,null,null,null,null,null,null,null,null),n.isDefaultPrevented=function(){return this.defaultPrevented},n}}(Zepto),function($){function triggerAndReturn(e,t,n){var r=$.Event(t);return $(e).trigger(r,n),!r.defaultPrevented}function triggerGlobal(e,t,n,r){if(e.global)return triggerAndReturn(t||document,n,r)}function ajaxStart(e){e.global&&$.active++===0&&triggerGlobal(e,null,"ajaxStart")}function ajaxStop(e){e.global&&!--$.active&&triggerGlobal(e,null,"ajaxStop")}function ajaxBeforeSend(e,t){var n=t.context;if(t.beforeSend.call(n,e,t)===!1||triggerGlobal(t,n,"ajaxBeforeSend",[e,t])===!1)return!1;triggerGlobal(t,n,"ajaxSend",[e,t])}function ajaxSuccess(e,t,n){var r=n.context,i="success";n.success.call(r,e,i,t),triggerGlobal(n,r,"ajaxSuccess",[t,n,e]),ajaxComplete(i,t,n)}function ajaxError(e,t,n,r){var i=r.context;r.error.call(i,n,t,e),triggerGlobal(r,i,"ajaxError",[n,r,e]),ajaxComplete(t,n,r)}function ajaxComplete(e,t,n){var r=n.context;n.complete.call(r,t,e),triggerGlobal(n,r,"ajaxComplete",[t,n]),ajaxStop(n)}function empty(){}function mimeToDataType(e){return e&&(e=e.split(";",2)[0]),e&&(e==htmlType?"html":e==jsonType?"json":scriptTypeRE.test(e)?"script":xmlTypeRE.test(e)&&"xml")||"text"}function appendQuery(e,t){return(e+"&"+t).replace(/[&?]{1,2}/,"?")}function serializeData(e){e.processData&&e.data&&$.type(e.data)!="string"&&(e.data=$.param(e.data,e.traditional)),e.data&&(!e.type||e.type.toUpperCase()=="GET")&&(e.url=appendQuery(e.url,e.data))}function parseArguments(e,t,n,r){var i=!$.isFunction(t);return{url:e,data:i?t:undefined,success:i?$.isFunction(n)?n:undefined:t,dataType:i?r||n:n}}function serialize(e,t,n,r){var i,s=$.isArray(t);$.each(t,function(t,o){i=$.type(o),r&&(t=n?r:r+"["+(s?"":t)+"]"),!r&&s?e.add(o.name,o.value):i=="array"||!n&&i=="object"?serialize(e,o,n,t):e.add(t,o)})}var jsonpID=0,document=window.document,key,name,rscript=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,scriptTypeRE=/^(?:text|application)\/javascript/i,xmlTypeRE=/^(?:text|application)\/xml/i,jsonType="application/json",htmlType="text/html",blankRE=/^\s*$/;$.active=0,$.ajaxJSONP=function(e){if("type"in e){var t="jsonp"+ ++jsonpID,n=document.createElement("script"),r=function(){clearTimeout(o),$(n).remove(),delete window[t]},i=function(n){r();if(!n||n=="timeout")window[t]=empty;ajaxError(null,n||"abort",s,e)},s={abort:i},o;return ajaxBeforeSend(s,e)===!1?(i("abort"),!1):(window[t]=function(t){r(),ajaxSuccess(t,s,e)},n.onerror=function(){i("error")},n.src=e.url.replace(/=\?/,"="+t),$("head").append(n),e.timeout>0&&(o=setTimeout(function(){i("timeout")},e.timeout)),s)}return $.ajax(e)},$.ajaxSettings={type:"GET",beforeSend:empty,success:empty,error:empty,complete:empty,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript",json:jsonType,xml:"application/xml, text/xml",html:htmlType,text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0},$.ajax=function(options){var settings=$.extend({},options||{});for(key in $.ajaxSettings)settings[key]===undefined&&(settings[key]=$.ajaxSettings[key]);ajaxStart(settings),settings.crossDomain||(settings.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(settings.url)&&RegExp.$2!=window.location.host),settings.url||(settings.url=window.location.toString()),serializeData(settings),settings.cache===!1&&(settings.url=appendQuery(settings.url,"_="+Date.now()));var dataType=settings.dataType,hasPlaceholder=/=\?/.test(settings.url);if(dataType=="jsonp"||hasPlaceholder)return hasPlaceholder||(settings.url=appendQuery(settings.url,"callback=?")),$.ajaxJSONP(settings);var mime=settings.accepts[dataType],baseHeaders={},protocol=/^([\w-]+:)\/\//.test(settings.url)?RegExp.$1:window.location.protocol,xhr=settings.xhr(),abortTimeout;settings.crossDomain||(baseHeaders["X-Requested-With"]="XMLHttpRequest"),mime&&(baseHeaders.Accept=mime,mime.indexOf(",")>-1&&(mime=mime.split(",",2)[0]),xhr.overrideMimeType&&xhr.overrideMimeType(mime));if(settings.contentType||settings.contentType!==!1&&settings.data&&settings.type.toUpperCase()!="GET")baseHeaders["Content-Type"]=settings.contentType||"application/x-www-form-urlencoded";settings.headers=$.extend(baseHeaders,settings.headers||{}),xhr.onreadystatechange=function(){if(xhr.readyState==4){xhr.onreadystatechange=empty,clearTimeout(abortTimeout);var result,error=!1;if(xhr.status>=200&&xhr.status<300||xhr.status==304||xhr.status==0&&protocol=="file:"){dataType=dataType||mimeToDataType(xhr.getResponseHeader("content-type")),result=xhr.responseText;try{dataType=="script"?(1,eval)(result):dataType=="xml"?result=xhr.responseXML:dataType=="json"&&(result=blankRE.test(result)?null:$.parseJSON(result))}catch(e){error=e}error?ajaxError(error,"parsererror",xhr,settings):ajaxSuccess(result,xhr,settings)}else ajaxError(null,xhr.status?"error":"abort",xhr,settings)}};var async="async"in settings?settings.async:!0;xhr.open(settings.type,settings.url,async);for(name in settings.headers)xhr.setRequestHeader(name,settings.headers[name]);return ajaxBeforeSend(xhr,settings)===!1?(xhr.abort(),!1):(settings.timeout>0&&(abortTimeout=setTimeout(function(){xhr.onreadystatechange=empty,xhr.abort(),ajaxError(null,"timeout",xhr,settings)},settings.timeout)),xhr.send(settings.data?settings.data:null),xhr)},$.get=function(e,t,n,r){return $.ajax(parseArguments.apply(null,arguments))},$.post=function(e,t,n,r){var i=parseArguments.apply(null,arguments);return i.type="POST",$.ajax(i)},$.getJSON=function(e,t,n){var r=parseArguments.apply(null,arguments);return r.dataType="json",$.ajax(r)},$.fn.load=function(e,t,n){if(!this.length)return this;var r=this,i=e.split(/\s/),s,o=parseArguments(e,t,n),u=o.success;return i.length>1&&(o.url=i[0],s=i[1]),o.success=function(e){r.html(s?$("<div>").html(e.replace(rscript,"")).find(s):e),u&&u.apply(r,arguments)},$.ajax(o),this};var escape=encodeURIComponent;$.param=function(e,t){var n=[];return n.add=function(e,t){this.push(escape(e)+"="+escape(t))},serialize(n,e,t),n.join("&").replace(/%20/g,"+")}}(Zepto),function(e){e.fn.serializeArray=function(){var t=[],n;return e(Array.prototype.slice.call(this.get(0).elements)).each(function(){n=e(this);var r=n.attr("type");this.nodeName.toLowerCase()!="fieldset"&&!this.disabled&&r!="submit"&&r!="reset"&&r!="button"&&(r!="radio"&&r!="checkbox"||this.checked)&&t.push({name:n.attr("name"),value:n.val()})}),t},e.fn.serialize=function(){var e=[];return this.serializeArray().forEach(function(t){e.push(encodeURIComponent(t.name)+"="+encodeURIComponent(t.value))}),e.join("&")},e.fn.submit=function(t){if(t)this.bind("submit",t);else if(this.length){var n=e.Event("submit");this.eq(0).trigger(n),n.defaultPrevented||this.get(0).submit()}return this}}(Zepto),function(e,t){function y(e){return b(e.replace(/([a-z])([A-Z])/,"$1-$2"))}function b(e){return e.toLowerCase()}function w(e){return r?r+e:b(e)}var n="",r,i,s,o={Webkit:"webkit",Moz:"",O:"o",ms:"MS"},u=window.document,a=u.createElement("div"),f=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i,l,c,h,p,d,v,m,g={};e.each(o,function(e,i){if(a.style[e+"TransitionProperty"]!==t)return n="-"+b(e)+"-",r=i,!1}),l=n+"transform",g[c=n+"transition-property"]=g[h=n+"transition-duration"]=g[p=n+"transition-timing-function"]=g[d=n+"animation-name"]=g[v=n+"animation-duration"]=g[m=n+"animation-timing-function"]="",e.fx={off:r===t&&a.style.transitionProperty===t,speeds:{_default:400,fast:200,slow:600},cssPrefix:n,transitionEnd:w("TransitionEnd"),animationEnd:w("AnimationEnd")},e.fn.animate=function(t,n,r,i){return e.isPlainObject(n)&&(r=n.easing,i=n.complete,n=n.duration),n&&(n=(typeof n=="number"?n:e.fx.speeds[n]||e.fx.speeds._default)/1e3),this.anim(t,n,r,i)},e.fn.anim=function(n,r,i,s){var o,u={},a,b="",w=this,E,S=e.fx.transitionEnd;r===t&&(r=.4),e.fx.off&&(r=0);if(typeof n=="string")u[d]=n,u[v]=r+"s",u[m]=i||"linear",S=e.fx.animationEnd;else{a=[];for(o in n)f.test(o)?b+=o+"("+n[o]+") ":(u[o]=n[o],a.push(y(o)));b&&(u[l]=b,a.push(l)),r>0&&typeof n=="object"&&(u[c]=a.join(", "),u[h]=r+"s",u[p]=i||"linear")}return E=function(t){if(typeof t!="undefined"){if(t.target!==t.currentTarget)return;e(t.target).unbind(S,E)}e(this).css(g),s&&s.call(this)},r>0&&this.bind(S,E),this.size()&&this.get(0).clientLeft,this.css(u),r<=0&&setTimeout(function(){w.each(function(){E.call(this)})},0),this},a=null}(Zepto);
/**
 * #Simply Deferred
 * ###Simplified Deferred Library (jQuery API) for Node and the Browser
 * ####MIT Licensed.
 * Portions of this code are inspired and borrowed from [underscore.js](http://underscorejs.org/) (MIT License)
 * ####[Source (github)](http://github.com/sudhirj/simply-deferred) | [Documentation](https://github.com/sudhirj/simply-deferred#simply-deferred)
 * &copy; Sudhir Jonathan [sudhirjonathan.com](http://www.sudhirjonathan.com)
 */
!function(){var n,r,e,t,u,o,i,l,a,c,s,f,p,h,g=[].slice;u="2.4.0",r="pending",t="resolved",e="rejected",a=function(n,r){return null!=n?n.hasOwnProperty(r):void 0},s=function(n){return a(n,"length")&&a(n,"callee")},f=function(n){return a(n,"promise")&&"function"==typeof(null!=n?n.promise:void 0)},l=function(n){return s(n)?l(Array.prototype.slice.call(n)):Array.isArray(n)?n.reduce(function(n,r){return Array.isArray(r)?n.concat(l(r)):(n.push(r),n)},[]):[n]},o=function(n,r){return 0>=n?r():function(){return--n<1?r.apply(this,arguments):void 0}},p=function(n,r){return function(){var e;return e=[n].concat(Array.prototype.slice.call(arguments,0)),r.apply(this,e)}},i=function(n,r,e){var t,u,o,i,a;for(i=l(n),a=[],u=0,o=i.length;o>u;u++)t=i[u],a.push(t.call.apply(t,[e].concat(g.call(r))));return a},n=function(){var u,o,a,c,s,p;return p=r,c=[],s=[],a={},this.promise=function(u){var o,h;return u=u||{},u.state=function(){return p},h=function(n,e){return function(){return p===r&&e.push.apply(e,l(arguments)),n()&&i(arguments,a),u}},u.done=h(function(){return p===t},c),u.fail=h(function(){return p===e},s),u.always=function(){var n;return(n=u.done.apply(u,arguments)).fail.apply(n,arguments)},o=function(r,e){var t,o;return o=new n,t=function(n,r,e){return e?u[n](function(){var n,t;return n=1<=arguments.length?g.call(arguments,0):[],t=e.apply(null,n),f(t)?t.done(o.resolve).fail(o.reject):o[r](t)}):u[n](o[r])},t("done","resolve",r),t("fail","reject",e),o},u.pipe=o,u.then=o,null==u.promise&&(u.promise=function(){return u}),u},this.promise(this),u=this,o=function(n,e,t){return function(){return p===r?(p=n,a=arguments,i(e,a,t),u):this}},this.resolve=o(t,c),this.reject=o(e,s),this.resolveWith=function(n,r){return o(t,c,n).apply(null,r)},this.rejectWith=function(n,r){return o(e,s,n).apply(null,r)},this},h=function(){var r,e,t,u,i,a,c;if(e=l(arguments),1===e.length)return f(e[0])?e[0]:(new n).resolve(e[0]).promise();if(i=new n,!e.length)return i.resolve().promise();for(u=[],t=o(e.length,function(){return i.resolve.apply(i,u)}),e.forEach(function(n,r){return f(n)?n.done(function(){var n;return n=1<=arguments.length?g.call(arguments,0):[],u[r]=n.length>1?n:n[0],t()}):(u[r]=n,t())}),a=0,c=e.length;c>a;a++)r=e[a],f(r)&&r.fail(i.reject);return i.promise()},c=function(r){return r.Deferred=function(){return new n},r.ajax=p(r.ajax,function(r,e){var t,u,o,i;return null==e&&(e={}),u=new n,t=function(n,r){return p(n,function(){var n,e;return e=arguments[0],n=2<=arguments.length?g.call(arguments,1):[],e&&e.apply(null,n),r.apply(null,n)})},e.success=t(e.success,u.resolve),e.error=t(e.error,u.reject),i=r(e),o=u.promise(),o.abort=function(){return i.abort()},o}),r.when=h},"undefined"!=typeof exports?(exports.Deferred=function(){return new n},exports.when=h,exports.installInto=c):"function"==typeof define&&define.amd?define(function(){return Zepto?c(Zepto):n}):Zepto?c(Zepto):(this.Deferred=function(){return new n},this.Deferred.when=h,this.Deferred.installInto=c)}.call(this);
/**
 * @license
 * Lo-Dash 1.3.1 (Custom Build) lodash.com/license | Underscore.js 1.5.1 underscorejs.org/LICENSE
 * Build: `lodash backbone exports="amd,commonjs,global,node" -o ./dist/lodash.backbone.js`
 */
;!function(n){function t(n,t,r){r=(r||0)-1;for(var e=n.length;++r<e;)if(n[r]===t)return r;return-1}function r(n,t){var r=n.m,e=t.m;if(n=n.l,t=t.l,n!==t){if(n>t||typeof n=="undefined")return 1;if(n<t||typeof t=="undefined")return-1}return r<e?-1:1}function e(){}function u(n){return n instanceof u?n:new o(n)}function o(n){this.__wrapped__=n}function f(n,t,r){function e(){var u=arguments,o=t;return r.length&&(u=u.length?r.concat(lt.call(u)):r),this instanceof e?(o=i(n.prototype),u=n.apply(o,u),y(u)?u:o):n.apply(o,u)
}if(!h(n))throw new TypeError;return e}function i(n){return y(n)?ut(n):{}}function a(n){return yt[n]}function c(){var n=(n=u.indexOf)===k?t:n;return n}function l(n){return n&&typeof n=="object"?rt.call(n)==z:!1}function p(n){if(!n)return n;for(var t=1,r=arguments.length;t<r;t++){var e=arguments[t];if(e)for(var u in e)n[u]=e[u]}return n}function s(n){var t=[];return mt(n,function(n,r){h(n)&&t.push(r)}),t.sort()}function v(n,t,r,e){if(n===t)return 0!==n||1/n==1/t;var o=typeof n,f=typeof t;if(n===n&&(!n||"function"!=o&&"object"!=o)&&(!t||"function"!=f&&"object"!=f))return!1;
if(null==n||null==t)return n===t;if(f=rt.call(n),o=rt.call(t),f!=o)return!1;switch(f){case P:case V:return+n==+t;case C:return n!=+n?t!=+t:0==n?1/n==1/t:n==+t;case H:case J:return n==t+""}if(o=f==D,!o){if(n instanceof u||t instanceof u)return v(n.__wrapped__||n,t.__wrapped__||t,r,e);if(f!=G)return!1;var f=n.constructor,i=t.constructor;if(f!=i&&(!h(f)||!(f instanceof f&&h(i)&&i instanceof i)))return!1}for(r||(r=[]),e||(e=[]),f=r.length;f--;)if(r[f]==n)return e[f]==t;var a=!0,c=0;if(r.push(n),e.push(t),o){if(c=t.length,a=c==n.length)for(;c--&&(a=v(n[c],t[c],r,e)););return a
}return mt(t,function(t,u,o){return nt.call(o,u)?(c++,!(a=nt.call(n,u)&&v(n[u],t,r,e))&&T):void 0}),a&&mt(n,function(n,t,r){return nt.call(r,t)?!(a=-1<--c)&&T:void 0}),a}function h(n){return typeof n=="function"}function y(n){return!(!n||!K[typeof n])}function g(n){return typeof n=="string"||rt.call(n)==J}function m(n){for(var t=-1,r=ht(n),e=r.length,u=Array(e);++t<e;)u[t]=n[r[t]];return u}function d(n,t){var r=c(),e=n?n.length:0,u=!1;return e&&typeof e=="number"?u=-1<r(n,t):dt(n,function(n){return(u=n===t)&&T
}),u}function _(n,t,r){var e=!0;t=q(t,r),r=-1;var u=n?n.length:0;if(typeof u=="number")for(;++r<u&&(e=!!t(n[r],r,n)););else dt(n,function(n,r,u){return!(e=!!t(n,r,u))&&T});return e}function b(n,t,r){var e=[];t=q(t,r),r=-1;var u=n?n.length:0;if(typeof u=="number")for(;++r<u;){var o=n[r];t(o,r,n)&&e.push(o)}else dt(n,function(n,r,u){t(n,r,u)&&e.push(n)});return e}function j(n,t,r){t=q(t,r),r=-1;var e=n?n.length:0;if(typeof e!="number"){var u;return dt(n,function(n,r,e){return t(n,r,e)?(u=n,T):void 0
}),u}for(;++r<e;){var o=n[r];if(t(o,r,n))return o}}function w(n,t,r){var e=-1,u=n?n.length:0;if(t=t&&typeof r=="undefined"?t:q(t,r),typeof u=="number")for(;++e<u&&t(n[e],e,n)!==T;);else dt(n,t)}function x(n,t,r){var e=-1,u=n?n.length:0;if(t=q(t,r),typeof u=="number")for(var o=Array(u);++e<u;)o[e]=t(n[e],e,n);else o=[],dt(n,function(n,r,u){o[++e]=t(n,r,u)});return o}function A(n,t,r,e){if(!n)return r;var u=3>arguments.length;t=q(t,e,4);var o=-1,f=n.length;if(typeof f=="number")for(u&&(r=n[++o]);++o<f;)r=t(r,n[o],o,n);
else dt(n,function(n,e,o){r=u?(u=!1,n):t(r,n,e,o)});return r}function O(n,t,r,e){var u=n?n.length:0,o=3>arguments.length;if(typeof u!="number")var f=ht(n),u=f.length;return t=q(t,e,4),w(n,function(e,i,a){i=f?f[--u]:--u,r=o?(o=!1,n[i]):t(r,n[i],i,a)}),r}function E(n,t,r){var e;t=q(t,r),r=-1;var u=n?n.length:0;if(typeof u=="number")for(;++r<u&&!(e=t(n[r],r,n)););else dt(n,function(n,r,u){return(e=t(n,r,u))&&T});return!!e}function B(n){for(var t=-1,r=c(),e=n.length,u=Y.apply(W,lt.call(arguments,1)),o=[];++t<e;){var f=n[t];
0>r(u,f)&&o.push(f)}return o}function R(n,t,r){if(n){var e=0,u=n.length;if(typeof t!="number"&&null!=t){var o=-1;for(t=q(t,r);++o<u&&t(n[o],o,n);)e++}else if(e=t,null==e||r)return n[0];return lt.call(n,0,at(it(0,e),u))}}function k(n,r,e){if(typeof e=="number"){var u=n?n.length:0;e=0>e?it(0,u+e):e||0}else if(e)return e=M(n,r),n[e]===r?e:-1;return n?t(n,r,e):-1}function I(n,t,r){if(typeof t!="number"&&null!=t){var e=0,u=-1,o=n?n.length:0;for(t=q(t,r);++u<o&&t(n[u],u,n);)e++}else e=null==t||r?1:it(0,t);
return lt.call(n,e)}function M(n,t,r,e){var u=0,o=n?n.length:u;for(r=r?q(r,e,1):F,t=r(t);u<o;)e=u+o>>>1,r(n[e])<t?u=e+1:o=e;return u}function S(n,t){return st.fastBind||et&&2<arguments.length?et.call.apply(et,arguments):f(n,t,lt.call(arguments,2))}function q(n,t,r){if(null==n)return F;var e=typeof n;if("function"!=e){if("object"!=e)return function(t){return t[n]};var u=ht(n);return function(t){for(var r=u.length,e=!1;r--&&(e=t[u[r]]===n[u[r]]););return e}}return typeof t=="undefined"?n:1===r?function(r){return n.call(t,r)
}:2===r?function(r,e){return n.call(t,r,e)}:4===r?function(r,e,u,o){return n.call(t,r,e,u,o)}:function(r,e,u){return n.call(t,r,e,u)}}function F(n){return n}function $(n){w(s(n),function(t){var r=u[t]=n[t];u.prototype[t]=function(){var n=[this.__wrapped__];return tt.apply(n,arguments),n=r.apply(u,n),this.__chain__&&(n=new o(n),n.__chain__=!0),n}})}var N=0,T={},z="[object Arguments]",D="[object Array]",P="[object Boolean]",V="[object Date]",C="[object Number]",G="[object Object]",H="[object RegExp]",J="[object String]",K={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},L=K[typeof exports]&&exports,Q=K[typeof module]&&module&&module.exports==L&&module,U=K[typeof global]&&global;
!U||U.global!==U&&U.window!==U||(n=U);var W=[],U=Object.prototype,X=RegExp("^"+(U.valueOf+"").replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),Y=W.concat,Z=Math.floor,nt=U.hasOwnProperty,tt=W.push,rt=U.toString,et=X.test(et=rt.bind)&&et,ut=X.test(ut=Object.create)&&ut,ot=X.test(ot=Array.isArray)&&ot,ft=X.test(ft=Object.keys)&&ft,it=Math.max,at=Math.min,ct=Math.random,lt=W.slice,U=X.test(n.attachEvent),pt=et&&!/\n|true/.test(et+U);o.prototype=u.prototype;var st={};!function(){var n={0:1,length:1};
st.fastBind=et&&!pt,st.spliceObjects=(W.splice.call(n,0,1),!n[0])}(1),ut||(i=function(n){if(y(n)){e.prototype=n;var t=new e;e.prototype=null}return t||{}}),l(arguments)||(l=function(n){return n&&typeof n=="object"?nt.call(n,"callee"):!1});var vt=ot||function(n){return n&&typeof n=="object"?rt.call(n)==D:!1},ot=function(n){var t,r=[];if(!n||!K[typeof n])return r;for(t in n)nt.call(n,t)&&r.push(t);return r},ht={}.o=ft?function(n){return y(n)?ft(n):[]}:ot,yt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},gt=RegExp("["+ht(yt).join("")+"]","g"),mt=function(n,t){var r;
if(!n||!K[typeof n])return n;for(r in n)if(t(n[r],r,n)===T)break;return n},dt=function(n,t){var r;if(!n||!K[typeof n])return n;for(r in n)if(nt.call(n,r)&&t(n[r],r,n)===T)break;return n};h(/x/)&&(h=function(n){return typeof n=="function"&&"[object Function]"==rt.call(n)}),u.bind=S,u.bindAll=function(n){for(var t=1<arguments.length?Y.apply(W,lt.call(arguments,1)):s(n),r=-1,e=t.length;++r<e;){var u=t[r];n[u]=S(n[u],n)}return n},u.countBy=function(n,t,r){var e={};return t=q(t,r),w(n,function(n,r,u){r=t(n,r,u)+"",nt.call(e,r)?e[r]++:e[r]=1
}),e},u.defaults=function(n){if(!n)return n;for(var t=1,r=arguments.length;t<r;t++){var e=arguments[t];if(e)for(var u in e)"undefined"==typeof n[u]&&(n[u]=e[u])}return n},u.difference=B,u.filter=b,u.forEach=w,u.functions=s,u.groupBy=function(n,t,r){var e={};return t=q(t,r),w(n,function(n,r,u){r=t(n,r,u)+"",(nt.call(e,r)?e[r]:e[r]=[]).push(n)}),e},u.initial=function(n,t,r){if(!n)return[];var e=0,u=n.length;if(typeof t!="number"&&null!=t){var o=u;for(t=q(t,r);o--&&t(n[o],o,n);)e++}else e=null==t||r?1:t||e;
return lt.call(n,0,at(it(0,u-e),u))},u.invert=function(n){for(var t=-1,r=ht(n),e=r.length,u={};++t<e;){var o=r[t];u[n[o]]=o}return u},u.invoke=function(n,t){var r=lt.call(arguments,2),e=-1,u=typeof t=="function",o=n?n.length:0,f=Array(typeof o=="number"?o:0);return w(n,function(n){f[++e]=(u?t:n[t]).apply(n,r)}),f},u.keys=ht,u.map=x,u.max=function(n,t,r){var e=-1/0,u=e,o=-1,f=n?n.length:0;if(t||typeof f!="number")t=q(t,r),w(n,function(n,r,o){r=t(n,r,o),r>e&&(e=r,u=n)});else for(;++o<f;)r=n[o],r>u&&(u=r);
return u},u.min=function(n,t,r){var e=1/0,u=e,o=-1,f=n?n.length:0;if(t||typeof f!="number")t=q(t,r),w(n,function(n,r,o){r=t(n,r,o),r<e&&(e=r,u=n)});else for(;++o<f;)r=n[o],r<u&&(u=r);return u},u.omit=function(n){var t=c(),r=Y.apply(W,lt.call(arguments,1)),e={};return mt(n,function(n,u){0>t(r,u)&&(e[u]=n)}),e},u.once=function(n){var t,r;return function(){return t?r:(t=!0,r=n.apply(this,arguments),n=null,r)}},u.pairs=function(n){for(var t=-1,r=ht(n),e=r.length,u=Array(e);++t<e;){var o=r[t];u[t]=[o,n[o]]
}return u},u.pick=function(n){for(var t=-1,r=Y.apply(W,lt.call(arguments,1)),e=r.length,u={};++t<e;){var o=r[t];o in n&&(u[o]=n[o])}return u},u.reject=function(n,t,r){return t=q(t,r),b(n,function(n,r,e){return!t(n,r,e)})},u.rest=I,u.shuffle=function(n){var t=-1,r=n?n.length:0,e=Array(typeof r=="number"?r:0);return w(n,function(n){var r=Z(ct()*(++t+1));e[t]=e[r],e[r]=n}),e},u.sortBy=function(n,t,e){var u=-1,o=n?n.length:0,f=Array(typeof o=="number"?o:0);for(t=q(t,e),w(n,function(n,r,e){f[++u]={l:t(n,r,e),m:u,n:n}
}),o=f.length,f.sort(r);o--;)f[o]=f[o].n;return f},u.toArray=function(n){return vt(n)?lt.call(n):n&&typeof n.length=="number"?x(n):m(n)},u.values=m,u.without=function(n){return B(n,lt.call(arguments,1))},u.collect=x,u.drop=I,u.each=w,u.extend=p,u.methods=s,u.select=b,u.tail=I,u.chain=function(n){return n=new o(n),n.__chain__=!0,n},u.clone=function(n){return y(n)?vt(n)?lt.call(n):p({},n):n},u.contains=d,u.escape=function(n){return null==n?"":(n+"").replace(gt,a)},u.every=_,u.find=j,u.has=function(n,t){return n?nt.call(n,t):!1
},u.identity=F,u.indexOf=k,u.isArguments=l,u.isArray=vt,u.isEmpty=function(n){if(!n)return!0;if(vt(n)||g(n))return!n.length;for(var t in n)if(nt.call(n,t))return!1;return!0},u.isEqual=v,u.isFunction=h,u.isObject=y,u.isRegExp=function(n){return n&&K[typeof n]?rt.call(n)==H:!1},u.isString=g,u.lastIndexOf=function(n,t,r){var e=n?n.length:0;for(typeof r=="number"&&(e=(0>r?it(0,e+r):at(r,e-1))+1);e--;)if(n[e]===t)return e;return-1},u.mixin=$,u.reduce=A,u.reduceRight=O,u.result=function(n,t){var r=n?n[t]:void 0;
return h(r)?n[t]():r},u.size=function(n){var t=n?n.length:0;return typeof t=="number"?t:ht(n).length},u.some=E,u.sortedIndex=M,u.uniqueId=function(n){var t=++N+"";return n?n+t:t},u.all=_,u.any=E,u.detect=j,u.foldl=A,u.foldr=O,u.include=d,u.inject=A,u.first=R,u.last=function(n,t,r){if(n){var e=0,u=n.length;if(typeof t!="number"&&null!=t){var o=u;for(t=q(t,r);o--&&t(n[o],o,n);)e++}else if(e=t,null==e||r)return n[u-1];return lt.call(n,it(0,u-e))}},u.take=R,u.head=R,u.VERSION="1.3.1",$(u),u.prototype.chain=function(){return this.__chain__=!0,this
},u.prototype.value=function(){return this.__wrapped__},w("pop push reverse shift sort splice unshift".split(" "),function(n){var t=W[n];u.prototype[n]=function(){var n=this.__wrapped__;return t.apply(n,arguments),!st.spliceObjects&&0===n.length&&delete n[0],this}}),w(["concat","join","slice"],function(n){var t=W[n];u.prototype[n]=function(){var n=t.apply(this.__wrapped__,arguments);return this.__chain__&&(n=new o(n),n.__chain__=!0),n}}),typeof define=="function"&&typeof define.amd=="object"&&define.amd?(n._=u, define(function(){return u
})):L&&!L.nodeType?Q?(Q.exports=u)._=u:L._=u:n._=u}(this);
//     Backbone.js 1.0.0
//     (c) 2010-2011 Jeremy Ashkenas, DocumentCloud Inc.
//     (c) 2011-2013 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://backbonejs.org
(function(){var e=this,t=e.Backbone,n=[],r=n.push,i=n.slice,s=n.splice,o;typeof exports!="undefined"?o=exports:o=e.Backbone={},o.VERSION="1.0.0";var u=e._;!u&&typeof require!="undefined"&&(u=require("underscore")),o.$=e.jQuery||e.Zepto||e.ender||e.$,o.noConflict=function(){return e.Backbone=t,this},o.emulateHTTP=!1,o.emulateJSON=!1;var a=o.Events={on:function(e,t,n){if(!l(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,n){if(!l(this,"once",e,[t,n])||!t)return this;var r=this,i=u.once(function(){r.off(e,i),t.apply(this,arguments)});return i._callback=t,this.on(e,i,n)},off:function(e,t,n){var r,i,s,o,a,f,c,h;if(!this._events||!l(this,"off",e,[t,n]))return this;if(!e&&!t&&!n)return this._events={},this;o=e?[e]:u.keys(this._events);for(a=0,f=o.length;a<f;a++){e=o[a];if(s=this._events[e]){this._events[e]=r=[];if(t||n)for(c=0,h=s.length;c<h;c++)i=s[c],(t&&t!==i.callback&&t!==i.callback._callback||n&&n!==i.context)&&r.push(i);r.length||delete this._events[e]}}return this},trigger:function(e){if(!this._events)return this;var t=i.call(arguments,1);if(!l(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&c(n,t),r&&c(r,arguments),this},stopListening:function(e,t,n){var r=this._listeners;if(!r)return this;var i=!t&&!n;typeof t=="object"&&(n=this),e&&((r={})[e._listenerId]=e);for(var s in r)r[s].off(t,n,this),i&&delete this._listeners[s];return this}},f=/\s+/,l=function(e,t,n,r){if(!n)return!0;if(typeof n=="object"){for(var i in n)e[t].apply(e,[i,n[i]].concat(r));return!1}if(f.test(n)){var s=n.split(f);for(var o=0,u=s.length;o<u;o++)e[t].apply(e,[s[o]].concat(r));return!1}return!0},c=function(e,t){var n,r=-1,i=e.length,s=t[0],o=t[1],u=t[2];switch(t.length){case 0:while(++r<i)(n=e[r]).callback.call(n.ctx);return;case 1:while(++r<i)(n=e[r]).callback.call(n.ctx,s);return;case 2:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o);return;case 3:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o,u);return;default:while(++r<i)(n=e[r]).callback.apply(n.ctx,t)}},h={listenTo:"on",listenToOnce:"once"};u.each(h,function(e,t){a[t]=function(t,n,r){var i=this._listeners||(this._listeners={}),s=t._listenerId||(t._listenerId=u.uniqueId("l"));return i[s]=t,typeof n=="object"&&(r=this),t[e](n,r,this),this}}),a.bind=a.on,a.unbind=a.off,u.extend(o,a);var p=o.Model=function(e,t){var n,r=e||{};t||(t={}),this.cid=u.uniqueId("c"),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(r=this.parse(r,t)||{}),t._attrs||(t._attrs=r);if(n=u.result(this,"defaults"))r=u.defaults({},r,n);this.set(r,t),this.changed={},this.initialize.apply(this,arguments)};u.extend(p.prototype,a,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return u.clone(this.attributes)},sync:function(){return o.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return u.escape(this.get(e))},has:function(e){return this.get(e)!=null},set:function(e,t,n){var r,i,s,o,a,f,l,c;if(e==null)return this;typeof e=="object"?(i=e,n=t):(i={})[e]=t,n||(n={});if(!this._validate(i,n))return!1;s=n.unset,a=n.silent,o=[],f=this._changing,this._changing=!0,f||(this._previousAttributes=u.clone(this.attributes),this.changed={}),c=this.attributes,l=this._previousAttributes,this.idAttribute in i&&(this.id=i[this.idAttribute]);for(r in i)t=i[r],u.isEqual(c[r],t)||o.push(r),u.isEqual(l[r],t)?delete this.changed[r]:this.changed[r]=t,s?delete c[r]:c[r]=t;if(!a){o.length&&(this._pending=!0);for(var h=0,p=o.length;h<p;h++)this.trigger("change:"+o[h],this,c[o[h]],n)}if(f)return this;if(!a)while(this._pending)this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,u.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,u.extend({},e,{unset:!0}))},hasChanged:function(e){return e==null?!u.isEmpty(this.changed):u.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?u.clone(this.changed):!1;var t,n=!1,r=this._changing?this._previousAttributes:this.attributes;for(var i in e){if(u.isEqual(r[i],t=e[i]))continue;(n||(n={}))[i]=t}return n},previous:function(e){return e==null||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return u.clone(this._previousAttributes)},fetch:function(e){e=e?u.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=this,n=e.success;return e.success=function(r){if(!t.set(t.parse(r,e),e))return!1;n&&n(t,r,e),t.trigger("sync",t,r,e)},j(this,e),this.sync("read",this,e)},save:function(e,t,n){var r,i,s,o=this.attributes;e==null||typeof e=="object"?(r=e,n=t):(r={})[e]=t,n=u.extend({validate:!0},n);if(r&&!n.wait){if(!this.set(r,n))return!1}else if(!this._validate(r,n))return!1;r&&n.wait&&(this.attributes=u.extend({},o,r)),n.parse===void 0&&(n.parse=!0);var a=this,f=n.success;return n.success=function(e){a.attributes=o;var t=a.parse(e,n);n.wait&&(t=u.extend(r||{},t));if(u.isObject(t)&&!a.set(t,n))return!1;f&&f(a,e,n),a.trigger("sync",a,e,n)},j(this,n),i=this.isNew()?"create":n.patch?"patch":"update",i==="patch"&&(n.attrs=r),s=this.sync(i,this,n),r&&n.wait&&(this.attributes=o),s},destroy:function(e){e=e?u.clone(e):{};var t=this,n=e.success,r=function(){t.trigger("destroy",t,t.collection,e)};e.success=function(i){(e.wait||t.isNew())&&r(),n&&n(t,i,e),t.isNew()||t.trigger("sync",t,i,e)};if(this.isNew())return e.success(),!1;j(this,e);var i=this.sync("delete",this,e);return e.wait||r(),i},url:function(){var e=u.result(this,"urlRoot")||u.result(this.collection,"url")||B();return this.isNew()?e:e+(e.charAt(e.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(e){return this._validate({},u.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=u.extend({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return n?(this.trigger("invalid",this,n,u.extend(t||{},{validationError:n})),!1):!0}});var d=["keys","values","pairs","invert","pick","omit"];u.each(d,function(e){p.prototype[e]=function(){var t=i.call(arguments);return t.unshift(this.attributes),u[e].apply(u,t)}});var v=o.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),t.comparator!==void 0&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,u.extend({silent:!0},t))},m={add:!0,remove:!0,merge:!0},g={add:!0,remove:!1};u.extend(v.prototype,a,{model:p,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return o.sync.apply(this,arguments)},add:function(e,t){return this.set(e,u.extend({merge:!1},t,g))},remove:function(e,t){e=u.isArray(e)?e.slice():[e],t||(t={});var n,r,i,s;for(n=0,r=e.length;n<r;n++){s=this.get(e[n]);if(!s)continue;delete this._byId[s.id],delete this._byId[s.cid],i=this.indexOf(s),this.models.splice(i,1),this.length--,t.silent||(t.index=i,s.trigger("remove",s,this,t)),this._removeReference(s)}return this},set:function(e,t){t=u.defaults({},t,m),t.parse&&(e=this.parse(e,t)),u.isArray(e)||(e=e?[e]:[]);var n,i,o,a,f,l,c=t.at,h=this.comparator&&c==null&&t.sort!==!1,p=u.isString(this.comparator)?this.comparator:null,d=[],v=[],g={},y=t.add,b=t.merge,w=t.remove,E=!h&&y&&w?[]:!1;for(n=0,i=e.length;n<i;n++){if(!(o=this._prepareModel(a=e[n],t)))continue;(f=this.get(o))?(w&&(g[f.cid]=!0),b&&(a=a===o?o.attributes:t._attrs,f.set(a,t),h&&!l&&f.hasChanged(p)&&(l=!0))):y&&(d.push(o),o.on("all",this._onModelEvent,this),this._byId[o.cid]=o,o.id!=null&&(this._byId[o.id]=o)),E&&E.push(f||o),delete t._attrs}if(w){for(n=0,i=this.length;n<i;++n)g[(o=this.models[n]).cid]||v.push(o);v.length&&this.remove(v,t)}if(d.length||E&&E.length)h&&(l=!0),this.length+=d.length,c!=null?s.apply(this.models,[c,0].concat(d)):(E&&(this.models.length=0),r.apply(this.models,E||d));l&&this.sort({silent:!0});if(t.silent)return this;for(n=0,i=d.length;n<i;n++)(o=d[n]).trigger("add",o,this,t);return(l||E&&E.length)&&this.trigger("sort",this,t),this},reset:function(e,t){t||(t={});for(var n=0,r=this.models.length;n<r;n++)this._removeReference(this.models[n]);return t.previousModels=this.models,this._reset(),this.add(e,u.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,u.extend({at:this.length},t)),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,u.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(){return i.apply(this.models,arguments)},get:function(e){return e==null?void 0:this._byId[e.id]||this._byId[e.cid]||this._byId[e]},at:function(e){return this.models[e]},where:function(e,t){return u.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),u.isString(this.comparator)||this.comparator.length===1?this.models=this.sortBy(this.comparator,this):this.models.sort(u.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},sortedIndex:function(e,t,n){t||(t=this.comparator);var r=u.isFunction(t)?t:function(e){return e.get(t)};return u.sortedIndex(this.models,e,r,n)},pluck:function(e){return u.invoke(this.models,"get",e)},fetch:function(e){e=e?u.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=e.success,n=this;return e.success=function(r){var i=e.reset?"reset":"set";n[i](r,e),t&&t(n,r,e),n.trigger("sync",n,r,e)},j(this,e),this.sync("read",this,e)},create:function(e,t){t=t?u.clone(t):{};if(!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var n=this,r=t.success;return t.success=function(e,t,i){i.wait&&n.add(e,i),r&&r(e,t,i)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof p)return e.collection||(e.collection=this),e;t||(t={}),t.collection=this;var n=new this.model(e,t);return n.validationError?(this.trigger("invalid",this,e,t),!1):n},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e==="add"||e==="remove")&&n!==this)return;e==="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],t.id!=null&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments)}});var y=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain"];u.each(y,function(e){v.prototype[e]=function(){var t=i.call(arguments);return t.unshift(this.models),u[e].apply(u,t)}});var b=["groupBy","countBy","sortBy"];u.each(b,function(e){v.prototype[e]=function(t,n){var r=u.isFunction(t)?t:function(e){return e.get(t)};return u[e](this.models,r,n)}});var w=o.View=function(e){this.cid=u.uniqueId("view"),e||(e={}),u.extend(this,u.pick(e,S)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},E=/^(\S+)\s*(.*)$/,S=["model","collection","el","id","attributes","className","tagName","events"];u.extend(w.prototype,a,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,t){return this.$el&&this.undelegateEvents(),this.$el=e instanceof o.$?e:o.$(e),this.el=this.$el[0],t!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=u.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var n=e[t];u.isFunction(n)||(n=this[e[t]]);if(!n)continue;var r=t.match(E),i=r[1],s=r[2];n=u.bind(n,this),i+=".delegateEvents"+this.cid,s===""?this.$el.on(i,n):this.$el.on(i,s,n)}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(!this.el){var e=u.extend({},u.result(this,"attributes"));this.id&&(e.id=u.result(this,"id")),this.className&&(e["class"]=u.result(this,"className"));var t=o.$("<"+u.result(this,"tagName")+">").attr(e);this.setElement(t,!1)}else this.setElement(u.result(this,"el"),!1)}}),o.sync=function(e,t,n){var r=T[e];u.defaults(n||(n={}),{emulateHTTP:o.emulateHTTP,emulateJSON:o.emulateJSON});var i={type:r,dataType:"json"};n.url||(i.url=u.result(t,"url")||B()),n.data==null&&t&&(e==="create"||e==="update"||e==="patch")&&(i.contentType="application/json",i.data=JSON.stringify(n.attrs||t.toJSON(n))),n.emulateJSON&&(i.contentType="application/x-www-form-urlencoded",i.data=i.data?{model:i.data}:{});if(n.emulateHTTP&&(r==="PUT"||r==="DELETE"||r==="PATCH")){i.type="POST",n.emulateJSON&&(i.data._method=r);var s=n.beforeSend;n.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",r);if(s)return s.apply(this,arguments)}}i.type!=="GET"&&!n.emulateJSON&&(i.processData=!1),i.type==="PATCH"&&x&&(i.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var a=n.xhr=o.ajax(u.extend(i,n));return t.trigger("request",t,a,n),a};var x=typeof window!="undefined"&&!!window.ActiveXObject&&(!window.XMLHttpRequest||!(new XMLHttpRequest).dispatchEvent),T={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};o.ajax=function(){return o.$.ajax.apply(o.$,arguments)};var N=o.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},C=/\((.*?)\)/g,k=/(\(\?)?:\w+/g,L=/\*\w+/g,A=/[\-{}\[\]+?.,\\\^$|#\s]/g;u.extend(N.prototype,a,{initialize:function(){},route:function(e,t,n){u.isRegExp(e)||(e=this._routeToRegExp(e)),u.isFunction(t)&&(n=t,t=""),n||(n=this[t]);var r=this;return o.history.route(e,function(i){var s=r._extractParameters(e,i);n&&n.apply(r,s),r.trigger.apply(r,["route:"+t].concat(s)),r.trigger("route",t,s),o.history.trigger("route",r,t,s)}),this},navigate:function(e,t){return o.history.navigate(e,t),this},_bindRoutes:function(){if(!this.routes)return;this.routes=u.result(this,"routes");var e,t=u.keys(this.routes);while((e=t.pop())!=null)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(A,"\\$&").replace(C,"(?:$1)?").replace(k,function(e,t){return t?e:"([^/]+)"}).replace(L,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){var n=e.exec(t).slice(1);return u.map(n,function(e){return e?decodeURIComponent(e):null})}});var O=o.History=function(){this.handlers=[],u.bindAll(this,"checkUrl"),typeof window!="undefined"&&(this.location=window.location,this.history=window.history)},M=/^[#\/]|\s+$/g,_=/^\/+|\/+$/g,D=/msie [\w.]+/,P=/\/$/;O.started=!1,u.extend(O.prototype,a,{interval:50,getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var n=this.root.replace(P,"");e.indexOf(n)||(e=e.slice(n.length))}else e=this.getHash();return e.replace(M,"")},start:function(e){if(O.started)throw new Error("Backbone.history has already been started");O.started=!0,this.options=u.extend({},{root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var t=this.getFragment(),n=document.documentMode,r=D.exec(navigator.userAgent.toLowerCase())&&(!n||n<=7);this.root=("/"+this.root+"/").replace(_,"/"),r&&this._wantsHashChange&&(this.iframe=o.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?o.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!r?o.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=t;var i=this.location,s=i.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!s)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._hasPushState&&s&&i.hash&&(this.fragment=this.getHash().replace(M,""),this.history.replaceState({},document.title,this.root+this.fragment+i.search))}if(!this.options.silent)return this.loadUrl()},stop:function(){o.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),O.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(e){var t=this.fragment=this.getFragment(e);return u.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0})},navigate:function(e,t){if(!O.started)return!1;if(!t||t===!0)t={trigger:!!t};e=this.getFragment(e||"");if(this.fragment===e)return;this.fragment=e;var n=this.root+e;e===""&&n!=="/"&&(n=n.slice(0,-1));if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}if(t.trigger)return this.loadUrl(e)},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),o.history=new O;var H=function(e,t){var n=this,r;e&&u.has(e,"constructor")?r=e.constructor:r=function(){return n.apply(this,arguments)},u.extend(r,n,t);var i=function(){this.constructor=r};return i.prototype=n.prototype,r.prototype=new i,e&&u.extend(r.prototype,e),r.__super__=n.prototype,r};p.extend=v.extend=N.extend=w.extend=O.extend=H;var B=function(){throw new Error('A "url" property or function must be specified')},j=function(e,t){var n=t.error;t.error=function(r){n&&n(e,r,t),e.trigger("error",e,r,t)}}}).call(this);
var Olv=Olv||{};(function(a){a.init||(a.init=!0,$(function(){cave.transition_end(),cave.toolbar_enableBackBtnFunc(!1),a.router=new a.Router,a.Pjax.start(),Backbone.history.checkUrl=function(b){a.History.needToSetState&&(history.state=b.state),Backbone.History.prototype.checkUrl.call(Backbone.history,b)},Backbone.history.start({pushState:!0,root:"/",silent:!0}),a.router.navigate(location.pathname+location.search,{trigger:!0}),a.OneTime.update(),a.ImageViewer.setup()}),a.Locale={Data:{},text:function(b){var c=Array.prototype.slice.call(arguments);return c.splice(1,0,-1),a.Locale.textN.apply(this,c)},textN:function(b,c){if(a.Cookie.get("plain_msgid"))return b;c=+c||0;var d=a.Locale.Data[b];if(!d)return b;var e,f,g=d.quanttype||"o",h="1_o"===g&&1===c||"01_o"===g&&(0===c||1===c);if(h?(e=d.text_value_1||d.value_1,f=d.text_args_1||d.args_1):(e=d.text_value||d.value,f=d.text_args||d.args),!f)return e;var i=Array.prototype.slice.call(arguments,2),j=0;return e.replace(/%s/g,function(){return i[f[j++]-1]})}},a.loc=a.Locale.text,a.loc_n=a.Locale.textN,a.alert=function(b,c,d){a.Loading.isLocked()||(arguments.length<=2&&(d=a.loc("olv.portal.n3ds.ok")),d=String.fromCharCode(57344)+" "+d,cave.dialog_oneButton(b,c,d))},a.confirm=function(b,c,d,e){if(!a.Loading.isLocked()){arguments.length<=2&&(d=a.loc("olv.portal.cancel"),e=a.loc("olv.portal.n3ds.ok")),e=String.fromCharCode(57344)+" "+e,d=String.fromCharCode(57345)+" "+d;var f=cave.dialog_twoButton(b,c,d,e);return 1===f?!0:0===f?!1:null}},a.deferredAlert=function(b,c,d){var e=arguments,f=$.Deferred();return setTimeout(function(){a.alert.apply(null,e),f.resolve()},0),f.promise()},a.deferredConfirm=function(b,c,d,e){var f=arguments,g=$.Deferred();return setTimeout(function(){var b=a.confirm.apply(null,f);g.resolve(b)},0),g.promise()},a.PostStorage={maxLocalStorageNum:3,getAll:function(){for(var a={},b=cave.lls_getCount(),c=new RegExp("^[0-9]+$"),d=0,e=0;b>e;e++){var f=cave.lls_getKeyAt(e);c.test(f)&&(a[f]=cave.lls_getItem(f),d+=1)}return[a,d]},getCount:function(){return a.PostStorage.getAll()[1]},setItem:function(a){var b=(new Date).getTime();cave.lls_setItem(String(b),a)},removeItem:function(a){var b=JSON.parse(cave.lls_getItem(a));b&&b.screenShotKey&&cave.lls_removeItem(b.screenShotKey),cave.lls_removeItem(a)},hasKey:function(a){for(var b=cave.lls_getCount(),c=0;b>c;c++){var d=cave.lls_getKeyAt(c);if(a===d)return!0}return!1},sweep:function(){var b=a.PostStorage.getAll(),c=b[0],d=b[1];if(d>0)for(var e in c){var f=JSON.parse(cave.lls_getItem(e)),g=f.screenShotKey;g&&!a.PostStorage.hasKey(g)&&cave.lls_removeItem(e)}}},a.Cookie={set:function(a,b){var c=encodeURIComponent(a)+"="+encodeURIComponent(b)+"; path=/";document.cookie=c},get:function(a){if(!a||!document.cookie)return void 0;for(var b=document.cookie.split("; "),c=0;c<b.length;c++){var d=b[c].split("=");if(a===decodeURIComponent(d[0]))return decodeURIComponent(d[1])}return void 0}},a.OneTime={updateLocalList:function(){var b=$("#body").attr("data-region-id");b&&a.Net.ajax({url:"/local_list.json?region_id="+b,silent:!0,cache:!1}).done(function(a){console.log(a.local_list),cave.lls_setItem("CaveLocalList",a.local_list),cave.capture_notifyUpdatedLocalList(),console.log(cave.lls_getItem("CaveLocalList"))})},updateUseTokenCache:function(){cave.ls_canUseCachedServiceToken()||cave.ls_setCanUseCachedServiceToken(!0)},clearBossLuminous:function(){cave.boss_clearNewArrival(),cave.boss_isRegisted()&&cave.boss_registEx(1,336)},updateAgreeOlvFlag:function(){/^\/(?:welcome\/|warning\/device_ban)/.test(location.pathname)||cave.lls_setItem("agree_olv","1")},updatePlayedTitles:function(){if(!a.Guest.isGuest()){var b=void 0,c=cave.plog_getPlayTitlesFilteredByPlayTime(1);void 0!==c&&(b=JSON.parse(c).IDs),b&&b.length&&a.Net.ajax({type:"POST",url:"/settings/played_title_ids",data:b.map(function(a){return{name:"title_id_hex",value:a}}),silent:!0})}},activateCommunityToolbar:function(){"/communities"===location.pathname&&a.Toolbar.activateButton(a.Toolbar.buttons.COMMUNITY)},update:function(){var b=a.Cookie.get("onetime");b||(a.Cookie.set("onetime",!0),this.updateLocalList(),this.updateUseTokenCache(),this.clearBossLuminous(),this.updateAgreeOlvFlag(),this.updatePlayedTitles(),this.activateCommunityToolbar())}},a.Loading={locked_:!1,lock:function(){this.locked_||(this.locked_=!0,cave.transition_begin())},unlock:function(){this.locked_&&(cave.transition_end(),this.locked_=!1)},isLocked:function(){return this.locked_},setup:function(){$(document).on("olv:pagechange:start olv:pjax:start",function(b,c){a.Loading.lock(),cave.brw_notifyPageMoving()}),$(document).on("olv:pagechange:end olv:pjax:error",function(){a.router.lockRequest=!1,a.Loading.unlock()})}},a.Loading.setup(),a.ErrorViewer={open:function(b){if(!a.Loading.isLocked()){b=b||{};var c=+(b.error_code||b.code||0),d=b.message||b.msgid&&a.loc(b.msgid);c||(c=1219999,d=d||a.loc("olv.portal.error.500.for_n3ds")),d?cave.error_callFreeErrorViewer(c,d):cave.error_callErrorViewer(c)}},deferredOpen:function(b){var c=$.Deferred();return setTimeout(function(){a.ErrorViewer.open(b),c.resolve()},0),c.promise()}},a.Net={ajax:function(b){var c=b.method||b.type||"";"POST"===c.toUpperCase()&&a.Net.needsPostFix&&(history.pushState(history.state,document.title,location.href),cave.history_removeAt(0),a.Net.needsPostFix=!1);var d=$.ajax(b),e=history.state&&history.state.id||0,f=d.then(function(a,b,c){var d=history.state.id===e,f=a&&"object"==typeof a&&!a.success||!d,g=[a,b,c,d];return f?$.Deferred().rejectWith(this,g):$.Deferred().resolveWith(this,g)},function(b,c){var d=a.Net.getDataFromXHR(b);void 0===d&&(d=b.responseText);var f=history.state.id===e;return $.Deferred().rejectWith(this,[d,c,b,f])});return b.lock&&(a.Loading.lock(),f.always(function(){a.Loading.unlock()})),b.silent||f.fail(a.Net.errorFeedbackHandler),f.promise(d),d},getDataFromXHR:function(a){var b=a.responseText,c=a.getResponseHeader("Content-Type");if(b&&c&&/^application\/json(?:;|$)/.test(c))try{return JSON.parse(b)}catch(d){}return void 0},getErrorFromXHR:function(b){var c=a.Net.getDataFromXHR(b),d=c&&c.errors&&c.errors[0];if(d&&"object"==typeof d)return d;var e=b.status;return e?503==e?{error_code:1211503,message:a.loc("olv.portal.error.503.content")}:500>e?{error_code:1210902,message:a.loc("olv.portal.error.failed_to_connect")}:{error_code:1219999,message:a.loc("olv.portal.error.500.for_n3ds")}:{error_code:1219998,message:a.loc("olv.portal.error.network_unavailable")}},errorFeedbackHandler:function(b,c,d,e){if("abort"!==c&&e&&!a.Loading.isLocked()){var f=a.Net.getErrorFromXHR(d);a.ErrorViewer.open(f)}},get:function(b,c,d,e){return a.Net.ajax({type:"GET",url:b,data:c,success:d,dataType:e})},post:function(b,c,d,e){return a.Net.ajax({type:"POST",url:b,data:c,success:d,dataType:e})},needsPostFix:!0,_pageId:1,onPageChange:function(){a.Net._pageId++,a.Net.needsPostFix=!0}},$(document).on("olv:pagechange:end",a.Net.onPageChange),a.Pjax={isEnabled:!1,cacheMapping_:{},stack_:[],current_:-1,maxCacheLength:3,start:function(){$(document).on("click","a[href][data-pjax]",function(b){b.preventDefault();var c=$(b.currentTarget);if(!a.Form.isDisabled(c)){var d=$(this).attr("href");a.router.navigate(d,{trigger:!0,replace:!!$(this).attr("data-pjax-replace")})}}),a.Pjax.isEnabled=!0},load:function(b){$(document).trigger("olv:pjax:start");var c=new Date;console.log("olv:pjax:start");var d=function(b,d,e){var f=e.getResponseHeader("X-PJAX-PATH");if(f&&history.state.url!==f){var g=_.extend({},history.state,{url:f});window.history.replaceState(g,null,f),a.History.needToSetState&&(history.state=g)}$(document).trigger("olv:pjax:end");var h=new Date-c;console.log("olv:pjax:end "+h),a.Content.replaceBody(b),$(document).trigger("olv:pagechange:ready");var i=new Date-c;return console.log("olv:pagechange:ready "+i),setTimeout(function(){var a=new Date-c;console.log("olv:pagechange:end "+a),$(document).trigger("olv:pagechange:end",[[h,i,a]])},0),$.Deferred().resolveWith(this,arguments)},e=a.Net.ajax({url:b,data:{_pjax:1},headers:{"X-PJAX":"true","X-PJAX-Container":"#body"},silent:!0}),f=e.then(d,function(b,c,e){if(e.getResponseHeader("X-PJAX-OK"))return d.apply(this,arguments);$(document).trigger("olv:pjax:error");var f=a.Net.getErrorFromXHR(e);return a.ErrorViewer.open(f),$.Deferred().rejectWith(this,arguments)});return f.promise(e),e},cachePush:function(b,c){for(a.Pjax.cacheMapping_[b]=c,++a.Pjax.current_;a.Pjax.current_<a.Pjax.stack_.length;)delete a.Pjax.cacheMapping_[a.Pjax.stack_.pop()];a.Pjax.stack_.push(b);for(var d=0;d<a.Pjax.stack_.length-a.Pjax.maxCacheLength;d++)a.Pjax.cacheMapping_[a.Pjax.stack_[d]]=void 0},cachePop:function(b){"forward"===b?++a.Pjax.current_:--a.Pjax.current_;var c=a.Pjax.stack_[a.Pjax.current_];return a.Pjax.cacheMapping_[c]},cacheSet:function(b){var c=a.Pjax.stack_[a.Pjax.current_];a.Pjax.cacheMapping_[c]=b},cacheReplace:function(b,c){delete a.Pjax.cacheMapping_[a.Pjax.stack_[a.Pjax.current_]],a.Pjax.stack_[a.Pjax.current_]=b,a.Pjax.cacheMapping_[b]=c},canGo:function(b){if(!b||"replace"===b)return!1;var c="forward"===b?1:-1,d=a.Pjax.stack_[a.Pjax.current_+c];return!!d&&history.state.id==d},go:function(b,c){var d=c.direction,e=c.cacheId||history.state.id,f=history.state&&history.state.scrollTo||0;if($(document).trigger("olv:pagechange:start"),!d||d&&"back"!==d&&!a.Pjax.canGo(d))return a.Pjax.load(b).done(function(b){setTimeout(function(){cave.brw_scrollImmediately(0,0)},0),"forward"===d?a.Pjax.cachePush(e,b):"replace"===d&&a.Pjax.cacheReplace(e,b)}).fail(function(){"forward"===d&&(a.router.isReverting=!0,history.back())});var g=a.Pjax.cachePop(d);return g?(a.Content.replaceBody(g),$(document).trigger("olv:pagechange:ready"),setTimeout(function(){$(document).trigger("olv:pagechange:end"),cave.brw_scrollImmediately(0,f)},0),$.Deferred().resolve().promise()):a.Pjax.load(b).done(function(a){setTimeout(function(){cave.brw_scrollImmediately(0,f)},0)}).fail(function(){"back"===d&&(a.router.isReverting=!0,history.forward())})},uniqueId:function(){return(new Date).getTime()},cacheClear:function(){a.Pjax.isEnabled&&(a.Pjax.cacheMapping_={})}},a.History={isInitialLoad:!0,state:void 0,needToSetState:void 0===history.state},a.Browsing={navigate:function(b){a.router.navigate(b,!0)},replaceWith:function(b){a.router.navigate(b,{trigger:!0,replace:!0})},reload:function(){a.Pjax.isEnabled?a.Browsing.replaceWith(location.href):location.reload()},goBack:function(){cave.brw_notifyPageMoving(),a.Loading.lock(),history.back()}},a.Toolbar={setup:function(){var a=["BACK","BACK_KEY","ACTIVITY","COMMUNITY","NOTIFICATION","MYMENU","GUIDE"],b=this;_.each(a,function(a){cave.toolbar_setCallback(b.buttons[a],b[a.toLowerCase()+"Callback"])})},buttons:{EXIT:0,BACK:1,ACTIVITY:2,COMMUNITY:3,NOTIFICATION:4,MYMENU:5,GUIDE:7,BACK_KEY:99},backCallback:function(){a.router.lockRequest||(a.router.lockRequest=!0,history.back())},back_keyCallback:function(){a.Toolbar.backCallback()},activityCallback:function(){a.Toolbar.activateButton(a.Toolbar.buttons.ACTIVITY),a.Browsing.navigate("/")},communityCallback:function(){a.Toolbar.activateButton(a.Toolbar.buttons.COMMUNITY),a.Browsing.navigate("/communities")},notificationCallback:function(){a.Toolbar.activateButton(a.Toolbar.buttons.NOTIFICATION),a.Browsing.navigate("/news/my_news")},mymenuCallback:function(){a.Toolbar.activateButton(a.Toolbar.buttons.MYMENU);var b=$("body").attr("data-profile-url");a.Browsing.navigate(b)},guideCallback:function(){a.Toolbar.activateButton(a.Toolbar.buttons.GUIDE),a.Browsing.navigate("/guide/for_guest")},setCornerButtonType:function(a){(a==this.buttons.EXIT||a==this.buttons.BACK)&&cave.toolbar_setButtonType(a)},_activeButtonId:void 0,activateButton:function(a){this._activeButtonId=a,cave.toolbar_setActiveButton(a)},_currentVisibility:void 0,setVisible:function(a){this._currentVisibility=!!a,cave.toolbar_setVisible(a),a&&this._activeButtonId&&cave.toolbar_setActiveButton(this._activeButtonId)},isVisible:function(){return this._currentVisibility},setNotificationCount:function(a){cave.toolbar_setNotificationCount(a)}},a.ImageViewer={setup:function(){cave.viewer_setOnCloseCallback(this.close_viewerCallback)},close_viewerCallback:function(){a.router.lockRequest=!1}},document.addEventListener("DOMContentLoaded",function(){a.Toolbar.setup()}),a.View=a.View||{},a.View.Page=a.View.Page||{},a.View.Page.current=void 0,a.View.Page.Common=Backbone.View.extend({widgets:[],isCurrent:function(){return a.View.Page.current&&a.View.Page.current.cid===this.cid},initialize:function(){this.widgets=[],a.View.Page.current&&!this.isCurrent()&&a.View.Page.current.undelegateEvents(),a.View.Page.current=this,a.Guest.isGuest()?this.widgets.push(new a.View.Widget.GuestDialog({el:$("#body")})):this.widgets.push(new a.View.Widget.UpdateChecker({el:$(document)})),this.widgets.push(new a.View.Widget.ExitOrBackButton({el:$(document)})),this.widgets.push(new a.View.Widget.ToolbarVisibility({el:$(document)})),this.widgets.push(new a.View.Widget.PostScroller({el:$(document)})),this.widgets.push(new a.View.Widget.HomeButton({el:$(document)}))},delegateEvents:function(){Backbone.View.prototype.delegateEvents.call(this),_.each(this.widgets,function(a){a.delegateEvents()})},undelegateEvents:function(){_.each(this.widgets,function(a){a.undelegateEvents()}),Backbone.View.prototype.undelegateEvents.call(this)}}),a.View.Page.Activity=a.View.Page.Common.extend({isAbortByPageChange:!1,initialize:function(){a.View.Page.Common.prototype.initialize.call(this);var b=this.loadActivity(),c=this.loadFollowingsProfilePosts(),d=this;$(document).one("olv:pagechange:start",function(){d.isAbortByPageChange=!0,b.abort&&b.abort()}),$.when(b,c).done(function(a,b){var c=$($.trim(b[0])),e=d.$("[data-latest-following-relation-profile-post-placeholder]"),f=[];e.each(function(a,b){var d=c.get(a);d&&($(b).html(d),f.push(b))}),$(f).removeClass("none")}).done(function(){d.widgets.push(new a.View.Widget.Follow({el:d.$(".toggle-follow-button")}))})},loadActivity:function(){var b,c=this,d=$(".content-loading-window");return b=d.length?a.Net.ajax({type:"GET",url:location.pathname+location.search,silent:!0}).done(function(b){a.Content.replaceBody(b)}).fail(function(a,b,e,f){d.remove(),c.isAbortByPageChange||$(".content-load-error-window").removeClass("none")}):$.Deferred().resolve().promise(),b.then(function(){c.delayedInitialize()})},loadFollowingsProfilePosts:function(){return a.Net.ajax({type:"GET",url:"/my/latest_following_related_profile_posts",silent:!0})},delayedInitialize:function(){this.widgets.push(new a.View.Widget.Empathy({el:this.$(".post")})),this.widgets.push(new a.View.Widget.ImageViewer({el:$(".js-open-image-viewer")})),this.widgets.push(new a.View.Widget.HiddenContent({el:this.$(".post")})),this.widgets.push(new a.View.Widget.CloseTutorial({el:this.$(".tutorial-close-button")})),this.widgets.push(new a.View.Widget.PageReloader({el:$(document)})),this.widgets.push(new a.View.Widget.Follow({el:$(".toggle-follow-button")})),this.widgets.push(new a.View.Widget.UserSearch({el:$(".user-search-button")}))}}),a.View.Page.PostForm=a.View.Page.Common.extend({events:{'click input[type="checkbox"]':"onCheckboxClick","click .forbidden-image-selector":"onForbiddenImageSelectorClick","click .cancel-button":function(){cave.memo_clear(),a.Browsing.goBack()},"input .textarea-text":"onInput","input .js-topic-title-input":"onInput","olv:painting:end":"onInput",'click input[name="screenshot_type"]':"onScreenshotSelect","olv:textarea:menu:change":"onInput","submit form":"onSubmit","olv:dropdown:open":"onDropdownOpen","olv:dropdown:close":"onDropdownClose","click .select-from-album-button":"onClickSelectFromAlbum","change select[data-required]":"onInput"},initialize:function(){a.View.Page.Common.prototype.initialize.call(this),this.restoreStateFromAlbumImageSelector(),this.widgets.push(new a.View.Widget.TextareaWithMenu({el:$(".textarea-with-menu").first()})),this.widgets.push(new a.View.Widget.OverlaidPreview({el:$(".textarea-text").first()}));var b=$(".js-topic-title-input");b.length&&this.widgets.push(new a.View.Widget.OverlaidPreview({el:b.first()})),this.widgets.push(new a.View.Widget.CheckableControls({el:$(".feeling-selector").first()})),this.widgets.push(new a.View.Widget.CheckableControls({el:$(".spoiler-button").first()}));var c=$("#tab-header-topic-categories");if(c.length){var d=new a.View.Widget.SelectButtons({el:c});d.updateLabel(c.find("select")),this.widgets.push(d)}this.topicTitle=this.$(".js-topic-title-input"),this.body=this.$('form input[name="body"],textarea[name="body"]'),this.painting=this.$('form input[name="painting"]'),this.paintingPreview=this.$(".textarea-memo-preview"),this.typeBody=this.$('form input[name="_post_type"][value="body"]'),this.submit=this.$(".fixed-bottom-button-post"),this.overlaidElements=$(),this.setupScreenshotSelector(),this.toggleSubmit()},setupScreenshotSelector:function(){var b=this.$(".image-selector").first(),c=b.find(".preview-image"),d=b.length&&!b.hasClass("disabled"),e=a.Screenshot.isEnabledAnySide(),f=b.find(".select-from-album-button").length;if(d&&(e||f)){this.widgets.push(new a.View.Widget.Dropdown({el:b})),this.widgets.push(new a.View.Widget.CheckableControls({el:b.find(".dropdown-menu").first()}));var g=b.find(".upside");g.css("display","none");var h=b.find(".downside");h.css("display","none"),a.Screenshot.isEnabled(a.Screenshot.SCREEN_UPSIDE)&&(b.find(".upside .capture-image").attr("src",a.Screenshot.retrieveImagePath(a.Screenshot.SCREEN_UPSIDE)),g.css("display","")),a.Screenshot.isEnabled(a.Screenshot.SCREEN_DOWNSIDE)&&(b.find(".downside .capture-image").attr("src",a.Screenshot.retrieveImagePath(a.Screenshot.SCREEN_DOWNSIDE)),h.css("display","")),c.attr("data-default-src",c.attr("src")),this.screenshotSelect(b.find('input[name="screenshot_type"]:checked'))}else b.length&&(b.addClass("disabled"),b.find(".dropdown-toggle").addClass("forbidden-image-selector"),c.attr("src",c.attr("data-forbidden-src")))},onClickSelectFromAlbum:function(b){var c=a.Form.serializeUserInputs(this),d={"album-preview-src":this.$("input.js-screenshot-radio-album").attr("data-src")};a.View.Page.PostForm.postArgsStock.push({formControls:c,miscAttributes:d})},onCheckboxClick:function(a){var b=a.target;$(b).attr("data-sound",b.checked?"SE_OLV_CHECKBOX_CHECK":"SE_OLV_CHECKBOX_UNCHECK")},onForbiddenImageSelectorClick:function(b){b.preventDefault(),a.deferredAlert(null,a.loc("olv.portal.post.screenshot_forbidden.for_n3ds"))},onInput:function(a){this.toggleSubmit()},appearedGraphicalChars:function(){var a=this.topicTitle.length?this.topicTitle:this.body;return!this.nonGraphicalCharsPattern.test(a.val())},nonGraphicalCharsPattern:/^\s*$/,toggleSubmit:function(a){var b=!this.typeBody.length||this.typeBody.prop("checked"),c=b?!this.appearedGraphicalChars()||this.hasUnfilledDropdown():"none"===this.paintingPreview.css("background-image");this.submit.prop("disabled",c)},hasUnfilledDropdown:function(){var a=this.$("select[data-required]");return a.filter(function(){return!$(this).val()}).length>0},onSubmit:function(b){a.Loading.lock();var c=$(b.currentTarget).find('input[type="submit"]');a.Form.toggleDisabled(c,!0),this.painting&&this.painting.prop("disabled")&&this.painting.val("")},onScreenshotSelect:function(a){var b=$(a.currentTarget);this.screenshotSelect(b)},screenshotSelect:function(a){var b=this.$(".dropdown-toggle .preview-image"),c=function(a){b.attr("src",a)},d=$.proxy(function(a){$('input[name="album_image_id"]').val("");var d="";if(null!==a){var e=this.$('[name="screenshot"]');e.prop("disabled",!1).attr("lls",a),e.focus(),e.trigger("click"),d=cave.lls_getPath(a)}else this.$('[name="screenshot"]').prop("disabled",!0),d=b.attr("data-default-src");c(d)},this);switch(a.val()){case"js-album":c(a.attr("data-src"));break;case"upside":d("upside");break;case"downside":d("downside");break;case"null":d(null)}},onDropdownOpen:function(b,c){this.overlaidElements=this.$("#bottom-menu input:enabled"),a.Form.toggleDisabled(this.overlaidElements,!0)},onDropdownClose:function(b,c){a.Form.toggleDisabled(this.overlaidElements,!1),this.overlaidElements=$()},restoreStateFromAlbumImageSelector:function(){var b=a.View.Page.PostForm.postArgsStock.shift();if(b){var c=b.formControls;a.Form.fillInputsWithSerializedObject(this,c);var d=b.miscAttributes;$("input.js-screenshot-radio-album").attr("data-src",d["album-preview-src"])}var e=a.View.Page.PostFormAlbumSelector.stock.shift();e&&($('input[name="album_image_id"]').val(e.albumImageId),$("input.js-screenshot-radio-album").attr("data-src",e.previewUrl).prop("checked",!0))}}),a.View.Page.PostForm.postArgsStock=[],a.View.Page.PostFormError=a.View.Page.Common.extend({events:{"click .back-button":function(){a.Browsing.goBack()}}}),a.View.Page.ReplyForm=a.View.Page.PostForm.extend({}),a.View.Page.PostMemo=a.View.Page.Common.extend({events:{"click .delete-button":"onDeleteButton","submit form":"onSubmit"},onSubmit:function(b){a.Loading.lock();var c=$(b.currentTarget).find('input[type="submit"]');a.Form.toggleDisabled(c,!0)},initialize:function(){a.View.Page.Common.prototype.initialize.call(this),a.PostStorage.sweep();var b=a.PostStorage.getAll(),c=b[0],d=b[1];if(d>0){this.$(".no-content-window").addClass("none").siblings().removeClass("none");var e=0,f=this;_.each(_.keys(c).sort(function(a,b){return b-a}),function(a){f.viewPost(c[a],a,e),e+=1});for(var g=e;g<a.PostStorage.maxLocalStorageNum;g++)this.clearContent(this.$("#post-"+g));$('input[name="screenshot"], input[name="thumbnail"]').forEach(function(a){a.focus(),$(a).trigger("click"),$(a).css("display","none"),a.blur()})}else this.$(".no-content-window").removeClass("none").siblings().addClass("none")},viewPost:function(b,c,d){function e(a){if(a+="",2===a.length){var b=a.match(/^([0-9])([0-9])$/);if(b[0]&&"0"===b[1])return b[2]}return a}function f(a){return a+="",1===a.length?"0"+a:a}var g=JSON.parse(b),h=this.$("#post-"+d);h.find(".user-name").text(cave.mii_getName());var i=cave.convertTimeToString(Number(c)),j=i.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})\s([0-9]{2}):([0-9]{2}):([0-9]{2})/),k=a.loc("olv.datetime"),l=j[1],m=j[2],n=j[3],o=j[4],p=+o,q=j[5],r=k.match(/M/g);1===r.length&&(m=e(m));var s=k.match(/d/g);1===s.length&&(n=e(n));var t=k.match(/m/g);1===t.length&&(n=e(q));var u="";if(/a/.test(k)){12>p?u=" AM":(u=" PM",p-=12);var v=k.match(/h/g);o=1===v.length?e(p):f(p)}else{var w=k.match(/H/g);1===w.length&&(o=e(o))}h.find(".timestamp-container .timestamp").text(a.loc("olv.datetime.n3ds.date",l,m,n)+" "+o+":"+q+u),h.find(".user-icon").attr("src",cave.mii_getIconBase64(Number(g.feeling))),g.titleID&&h.find('input[name="memo_title_id"]').val(g.titleID);var x=h.find(".screenshot-container");x.toggleClass("none",!g.screenShotKey);var y=h.find('input[name="screenshot"]');if(g.screenShotKey){var z=cave.lls_getPath(g.screenShotKey);x.find("img").attr("src",z),x.find("a").attr("href",z),y.prop("disabled",!1).attr("lls",g.screenShotKey)}else y.prop("disabled",!0);var A=h.find('input[name="thumbnail"]');if(g.thumbnailKey){var z=cave.lls_getPath(g.thumbnailKey);x.find("img").attr("src",z),A.prop("disabled",!1).attr("lls",g.thumbnailKey)}else A.prop("disabled",!0);var B=h.find(".spoiler");B.toggleClass("none",!g.spoiler),h.find('input[name="is_spoiler"]').val(g.spoiler?"1":""),h.find('input[name="feeling_id"]').val(g.feeling),void 0!==g.appStartable&&(g.appStartable&&h.find('input[name="is_app_jumpable"]').val("1").prop("disabled",!1),void 0!==g.externalUrl&&null!==g.externalUrl&&h.find('input[name="url"]').val(g.externalUrl).prop("disabled",!1),void 0!==g.appData&&null!==g.appData&&h.find('input[name="app_data"]').val(g.appData).prop("disabled",!1),void 0!==g.topicTag&&null!==g.topicTag&&(h.find('input[name="topic_tag"]').val(g.topicTag).prop("disabled",!1),h.find(".post-tag").text(g.topicTag).removeClass("none")),void 0!==g.searchKeys&&g.searchKeys instanceof Array&&_.each(g.searchKeys,function(a){h.find('input[name="topic_tag"]').after($("<input>",{type:"hidden",name:"search_key",value:a}))}),h.find('input[name="has_title_depended_value"]').val("1").prop("disabled",!1));var C,D=($("#list-content").attr("data-available-post-type"),h.find(".post-content")),E=D.find(".post-content-text"),F=D.find(".post-content-memo");if(void 0!==g.text&&null!==g.text)E.text(g.text),E.removeClass("none"),F.addClass("none"),h.find('input[name="body"]').val(g.text),C="body";else{var G="data:image/bmp;base64,"+g.paint;F.find("img").attr("src",G),F.removeClass("none"),E.addClass("none"),h.find('input[name="painting"]').val(g.paint),C="painting"}h.toggleClass("forbidden",!0),h.find(".post-button").prop("disabled",!0);var H={};H.post_type=C,g.titleID&&(H.src_title_id=g.titleID),g.screenShotKey&&(H.has_screenshot="1"),void 0!==g.communityId&&null!==g.communityId&&(H.dst_nex_community_id=g.communityId);a.Net.get("post_memo.check.json",H).done(function(a){if(a.show_community_name){var b=h.find(".community-container");b.removeClass("none"),a.community_path?b.find("a").attr("href",a.community_path):b.find("a").removeAttr("href"),b.find("img").attr("src",a.community_icon_url),b.find(".community-container-inner").append(a.community_name)}"1"==a.can_post?(h.find('input[name="olive_community_id"]').val(a.olive_community_id),h.find('input[name="olive_title_id"]').val(a.olive_title_id),h.toggleClass("forbidden",!1),h.find(".post-button").prop("disabled",!1)):(h.find(".forbidden-message").toggleClass("none",!1),h.find(".forbidden-message").text(a.message))}).fail(function(a,b,c,d){});h.attr("data-ls-key",c),h.find('input[name="ls_key"]').val(c),h.removeClass("none")},clearContent:function(a){a.addClass("none")},onDeleteButton:function(b){a.deferredConfirm(null,a.loc("olv.portal.offline.post.delete")).done($.proxy(function(c){if(c){var d=$(b.target).closest(".post"),e=d.attr("data-ls-key");a.PostStorage.removeItem(e),this.clearContent(d),0===a.PostStorage.getCount()&&this.$(".no-content-window").removeClass("none")}},this))}}),a.View.Page.PostDiaryForm=a.View.Page.PostForm.extend({setupScreenshotSelector:function(){var b=this.$('[name="screenshot"]');if(b){var c=b.attr("lls");c?this.setupPreSpecifiedScreenshotSelector(c):a.View.Page.PostForm.prototype.setupScreenshotSelector.call(this)}},setupPreSpecifiedScreenshotSelector:function(a){var b=this.$(".image-selector").first(),c=(b.find(".preview-image"),this.$('[name="screenshot"]')),d=(c.attr("lls"),$.proxy(function(a){var b=this.$(".image-selector .preview-image"),c=this.$('input[name="screenshot"]'),d="";null!==a?(c.prop("disabled",!1),c.focus(),c.trigger("click"),d=cave.lls_getPath(a)):(c.prop("disabled",!0),d=b.attr("data-forbidden-src")),b.attr("src",d)},this));switch(a){case"upside":d("upside");break;case"downside":d("downside");break;default:d(null)}},onSubmit:function(b){if($(b.currentTarget).find('input[name="album_image_id"]').val());else{var c=$($(b.currentTarget).find('input[name="screenshot"]')),d=this.$(".image-selector").first(),e=d.length&&!d.hasClass("disabled"),f=!c.attr("disabled");if(a.Screenshot.isEnabledAnySide()&&e&&!f)return a.deferredAlert(null,a.loc("olv.portal.post.screenshot_required")),!1}return a.View.Page.PostForm.prototype.onSubmit.call(this,b),!0}}),a.View.Page.PostRedirection=a.View.Page.Common.extend({initialize:function(){var b=$("#fresh-post-fragment");if(b.length){var c=b.attr("data-ls-key");c?a.PostStorage.removeItem(c):cave.memo_clear();var d=cave.history_getPrev();/\/(?:post|post\.memo|reply)(?:$|[?#])/.test(d)&&(cave.history_removePrev(),d=cave.history_getPrev());var e=b.attr("data-back-url");location.protocol+"//"+location.host+e===d&&cave.history_removePrev(),a.View.Widget.FreshPost.stock.push(b),setTimeout(function(){a.Browsing.replaceWith(e)},0)}}}),a.View.Page.Community=a.View.Page.Common.extend({events:{"click .unfavorite-button":"onUnfavorite","click .js-topic-post-button":"clickTopicPost"},initialize:function(){a.View.Page.Common.prototype.initialize.call(this),this.widgets.push(new a.View.Widget.FavoriteButtons({el:$("#header-meta").find(".favorite-button")})),this.widgets.push(new a.View.Widget.FreshPost({el:$(".post-list")})),a.Guest.isGuest()||this.widgets.push(new a.View.Widget.InfoTicker({el:$(".info-ticker")})),this.widgets.push(new a.View.Widget.Empathy({el:$(".post")})),this.widgets.push(new a.View.Widget.ImageViewer({el:$(".js-open-image-viewer")})),this.widgets.push(new a.View.Widget.HiddenContent({el:$(".post")})),this.widgets.push(new a.View.Widget.HiddenContent({el:$(".multi-timeline-post")})),this.widgets.push(new a.View.Widget.URLSelector({el:$("#post-filter")})),this.widgets.push(new a.View.Widget.eShopJump({el:$(".eshop-button")})),this.widgets.push(new a.View.Widget.PageReloader({el:$(document)})),this.widgets.push(new a.View.Widget.FirstPostNotice({el:$(".js-post-button")})),this.widgets.push(new a.View.Widget.URLSelector({el:$(".js-select-button")})),$(".age-gate-dialog").length&&(this.widgets.push(new a.View.Widget.AgeGateDialog({el:this.$(".age-gate-dialog")})),this.widgets.push(new a.View.Widget.SelectButtons({el:this.$(".age-gate-dialog .window-body-inner")}))),$(".toggle-follow-button").length&&this.widgets.push(new a.View.Widget.Follow({el:$(".toggle-follow-button")}))},onUnfavorite:function(b){b.preventDefault();var c=$(b.currentTarget);a.Form.isDisabled(c)||a.Form.post(c.attr("data-action"),null,c).done(function(){a.deferredAlert(null,a.loc("olv.portal.unfavorite_succeeded_to")),c.add(c.prev()).remove(),$(".unfavorite-confirm-message").remove()})},clickTopicPost:function(a){a.preventDefault();var b=$(".js-topic-filter");b.addClass("open")}}),a.View.Page.Post=a.View.Page.Common.extend({events:{"click .link-button":"onPostLinkClick","click .app-jump-button":"onAppJumpClick"},initialize:function(){a.View.Page.Common.prototype.initialize.call(this),this.widgets.push(new a.View.Widget.FreshReply({el:this.$(".post-permalink-reply")})),this.widgets.push(new a.View.Widget.EmpathyWithIcons({el:$(".post")})),this.widgets.push(new a.View.Widget.Empathy({el:$("#post-permalink-comments")})),this.widgets.push(new a.View.Widget.ImageViewer({el:$(".js-open-image-viewer")})),this.widgets.push(new a.View.Widget.Reply({el:this.$("#post-permalink-comments")})),this.widgets.push(new a.View.Widget.HiddenContent({el:this.$("#post-permalink-comments")})),this.widgets.push(new a.View.Widget.YoutubeJump({el:this.$(".video")})),this.widgets.push(new a.View.Widget.FirstPostNotice({el:$(".reply-button")})),this.widgets.push(new a.View.Widget.PageReloader({el:$(document)})),$("#body-language-selector").length&&(this.widgets.push(new a.View.Widget.BodyLanguageSelector({el:$("#body-language-selector")})),this.widgets.push(new a.View.Widget.SelectButtons({el:$(".select-button")}))),$(".post.official-user.post-subtype-default").length&&this.widgets.push(new a.View.Widget.MoreContentButton({el:$(".post.official-user.post-subtype-default")})),this.widgets.push(new a.View.Widget.CloseTopicPost({el:this.$(".post-meta")}))},onPostLinkClick:function(b){var c=$(b.currentTarget);if(!a.Form.isDisabled(c)&&!b.isDefaultPrevented()){b.preventDefault();var d=c.attr("href");cave.jump_existsWebbrs&&!cave.jump_existsWebbrs()?a.deferredConfirm(a.loc("olv.portal.confirm_syste_update.title"),a.loc("olv.portal.confirm_syste_update.body")).done(function(a){a&&cave.jump_toSystemUpdate(1)}):a.deferredConfirm(a.loc("olv.portal.confirm_url_form.title"),a.loc("olv.portal.confirm_url_form.body.for_n3ds")+"\n"+d).done(function(a){a&&cave.jump_toWebbrs(d)})}},onAppJumpClick:function(b){var c=$(b.currentTarget);if(!a.Form.isDisabled(c)&&!b.isDefaultPrevented()){b.preventDefault();var d=c.attr("data-app-jump-title-ids").split(","),e=c.attr("data-title-id");e&&d.unshift(e);for(var f,g=0;g<d.length;g++)if(cave.jump_existsApplication(d[g])){f=d[g];break}f?a.deferredConfirm(null,a.loc("olv.portal.confirm_app_jump")).done(function(a){if(a){if(cave.jump_resetParamToApp(),cave.jump_canUseQuery(f)){cave.jump_setModeToApp(2),cave.jump_setDataUTF8ToApp(13,c.attr("data-url-id")),cave.jump_setNumberDataToApp(12,Number(c.attr("data-nex-community-id")));
var b=c.attr("data-app-data");b&&cave.jump_setBase64DataToApp(5,b)}cave.jump_toApplication(1,f)}}):a.deferredAlert(null,a.loc("olv.portal.confirm_you_have_no_soft"))}},mayIncrementMoreRepliesButtonCount:function(a){}}),a.View.Page.Reply=a.View.Page.Post.extend({initialize:function(){a.View.Page.Common.prototype.initialize.call(this),this.widgets.push(new a.View.Widget.EmpathyWithIcons({el:$(".reply-permalink-content")})),this.widgets.push(new a.View.Widget.ImageViewer({el:$(".js-open-image-viewer")})),this.widgets.push(new a.View.Widget.HiddenContent({el:this.$("#post-permalink-comments")})),this.widgets.push(new a.View.Widget.PageReloader({el:$(document)})),$("#body-language-selector").length&&(this.widgets.push(new a.View.Widget.BodyLanguageSelector({el:$("#body-language-selector")})),this.widgets.push(new a.View.Widget.SelectButtons({el:$(".select-button")})))}}),a.View.Page.Violation=a.View.Page.Common.extend({events:{"change select":"onChangeViolationType",'input textarea[name="body"]':"onInputBody","click .cancel-button":function(){a.Browsing.goBack()}},initialize:function(){a.View.Page.Common.prototype.initialize.call(this),this.widgets.push(new a.View.Widget.PostToBack({el:$("form")})),this.$selectContent=this.$("span.select-button-content"),this.$type=this.$('select[name="type"]'),this.$body=this.$('textarea[name="body"]'),this.$submit=this.$(".post-button")},onChangeViolationType:function(){var a=$(this.$type[0].options[this.$type[0].selectedIndex]),b=!!this.$type.val();this.$selectContent.text(a.text()),this.$body.toggleClass("none",!b),this.updateSubmitBody()},onInputBody:function(){this.updateSubmitBody()},updateSubmitBody:function(){var a=$(this.$type[0].options[this.$type[0].selectedIndex]),b=!!a.val(),c=!!a.attr("data-body-required"),d=!b||c&&/^\s*$/.test(this.$body.val());this.$submit.prop("disabled",d)}}),a.View.Page.EditForm=a.View.Page.Common.extend({events:{"change select":"onSelectChange","click .cancel-button":function(){a.Browsing.goBack()},submit:"onSubmit"},initialize:function(){a.View.Page.Common.prototype.initialize.call(this),this.widgets.push(new a.View.Widget.SelectButtons({el:this.$(".select-button")}))},onSelectChange:function(a){var b=!!$(a.currentTarget).val();this.$(".post-button").prop("disabled",!b)},onSubmit:function(b){b.preventDefault();var c=$("#edit_type").val(),d=/^(screenshot|painting)-profile-post$/.test(c);if(!d||a.confirm(a.loc("olv.portal.profile_post"),a.loc("olv.portal.profile_post.confirm_update"),a.loc("olv.portal.cancel"),a.loc("olv.portal.profile_post.confirm_update.yes"))){var e=$("form"),f=e.find('input[type="submit"]');a.Form.submit(e,f,!0).done(function(){return d&&a.confirm(a.loc("olv.portal.profile_post"),a.loc("olv.portal.profile_post.done"),a.loc("olv.portal.close"),a.loc("olv.portal.user.search.go"))?void a.Browsing.replaceWith("/users/@me"):void history.back()})}}}),a.View.Page.Blacklist=a.View.Page.Common.extend({initialize:function(){a.View.Page.Common.prototype.initialize.call(this),this.widgets.push(new a.View.Widget.Blacklist({el:$("#block-list-page")}))}}),a.View.Page.ConfirmBlacklist=a.View.Page.Common.extend({initialize:function(){a.View.Page.Common.prototype.initialize.call(this),this.widgets.push(new a.View.Widget.ConfirmBlacklist({el:$(".window-bottom-buttons")}))}}),a.View.Page.IdentifiedUserPosts=a.View.Page.Common.extend({initialize:function(){a.View.Page.Common.prototype.initialize.call(this),this.widgets.push(new a.View.Widget.Follow({el:$(".toggle-follow-button")})),this.widgets.push(new a.View.Widget.ImageViewer({el:$(".js-open-image-viewer")}))}}),a.View.Page.User=a.View.Page.Common.extend({initialize:function(){a.View.Page.Common.prototype.initialize.call(this),this.widgets.push(new a.View.Widget.URLSelector({el:$("#user-violator-blacklist")})),this.widgets.push(new a.View.Widget.Follow({el:$(".toggle-follow-button")})),this.widgets.push(new a.View.Widget.Empathy({el:$(".post")})),this.widgets.push(new a.View.Widget.ImageViewer({el:$(".js-open-image-viewer")})),this.widgets.push(new a.View.Widget.HiddenContent({el:$(".post, .multi-timeline-post")}))}}),a.View.Page.UserDiary=a.View.Page.Common.extend({initialize:function(){a.View.Page.Common.prototype.initialize.call(this),this.widgets.push(new a.View.Widget.URLSelector({el:$("#user-violator-blacklist")})),this.widgets.push(new a.View.Widget.Empathy({el:$(".post")})),this.widgets.push(new a.View.Widget.ImageViewer({el:$(".js-open-image-viewer")})),this.widgets.push(new a.View.Widget.HiddenContent({el:$(".post")})),this.widgets.push(new a.View.Widget.CheckableControls({el:$(".js-diary-screenshot-window")})),this.widgets.push(new a.View.Widget.CreateDiaryOrSaveScreenshotWindow({el:$(".js-diary-screenshot-window")})),this.widgets.push(new a.View.Widget.FreshPost({el:this.$(".post-list")}))}}),a.View.Page.Settings=a.View.Page.Common.extend({events:{"submit .setting-form":"onSubmit","click #profile-post":"onProfilePostRemoveClick"},initialize:function(){a.View.Page.Common.prototype.initialize.call(this),this.widgets.push(new a.View.Widget.SelectButtons({el:this.$(".settings-list")})),a.ScrollGuide.activate()},onProfilePostRemoveClick:function(b){b.preventDefault();var c=$(b.currentTarget);a.deferredConfirm(a.loc("olv.portal.profile_post"),a.loc("olv.portal.profile_post.confirm_remove"),a.loc("olv.portal.stop"),a.loc("olv.portal.button.remove")).done(function(b){b&&a.Form.post("/settings/profile_post.unset.json",null,c,!0).done(function(){c.remove()})})},onSubmit:function(b){b.preventDefault();var c=$(b.currentTarget),d=c.find('input[type="submit"]');a.Form.submit(c,d,!0).done(function(){a.alert(null,a.loc("olv.portal.dialog.apply_settings_done"))})}}),a.View.Page.AccountSettings=a.View.Page.Settings.extend({events:{"submit .setting-form":"onSubmit"},initialize:function(){a.View.Page.Settings.prototype.initialize.call(this),this.setLuminousOptInValue()},setLuminousOptInValue:function(){var a=cave.boss_isRegisted(),b=a?1:0,c=this.$('[name="luminous_opt_in"]');c.find('[value="'+b+'"]').prop("selected",!0),c.change()},onSubmit:function(b){b.preventDefault();var c=+this.$('[name="luminous_opt_in"]').val();c?cave.boss_registEx(1,336):cave.boss_unregist(),a.View.Page.Settings.prototype.onSubmit.call(this,b)}}),a.View.Page.ProfileSettings=a.View.Page.Settings.extend({initialize:function(){a.View.Page.Settings.prototype.initialize.call(this),this.widgets.push(new a.View.Widget.MultipleSelectMediator({el:this.$("#favorite-game-genre")}))},onSubmit:function(b){a.View.Page.Settings.prototype.onSubmit.call(this,b)}}),a.View.Page.Welcome=a.View.Page.Common.extend({events:{"click .slide-button":"onSlideClick","click .welcome-exit-button":"onExitClick","click .welcome-luminous_opt_in-button":"onLuminousOptInClick","click .welcome-finish-button":"onFinishClick",'click input[name="luminous_opt_in"]':"onLuminousOptInButtonClick","olv:welcome:slide .slide-page":"onSlide"},initialize:function(){a.View.Page.Common.prototype.initialize.call(this),this.widgets.push(new a.View.Widget.CheckableControls({el:this.$(".window-bottom-buttons")})),this.slideByButton($("<button/>").attr("data-slide",".start-page")),this.showScrollGuideTimer=null},slideByButton:function(b){document.activeElement.blur();var c=b.closest(".slide-page"),d=$(b.attr("data-slide"));cave.brw_notifyPageMoving(),c.attr("data-scroll",b.attr("data-save-scroll")?cave.brw_getScrollTopY():null),c.hide(),d.show(),cave.brw_scrollImmediately(0,+d.attr("data-scroll")||0);var e=d.attr("data-bgm");e&&a.Sound.playBGM(e),d.trigger("olv:welcome:slide")},onSlide:function(b){var c=$(b.currentTarget),d=c.attr("id");if(clearTimeout(this.showScrollGuideTimer),"welcome-guideline"===d||"welcome-guideline-body"===d)this.showScrollGuideTimer=setTimeout(function(){cave.brw_getScrollTopY()<=0&&a.ScrollGuide.show()},1500);else if("welcome-finish"===d){var e=this.$(".welcome-finish-button"),f=e.attr("data-activate-url");a.Form.post(f,null,e,!0).done(function(){a.OneTime.updatePlayedTitles()}).fail(function(){a.Browsing.reload()})}},onSlideClick:function(b){b.preventDefault();var c=$(b.currentTarget);a.Form.isDisabled(c)||this.slideByButton(c)},onExitClick:function(a){a.preventDefault(),setTimeout(function(){cave.exitApp()},0)},onLuminousOptInClick:function(b){b.preventDefault();var c=$(b.currentTarget);return $('input[name="luminous_opt_in"]:checked').length?void this.slideByButton(c):void a.deferredAlert(null,a.loc("olv.portal.welcome.select_luminous_opt_in"))},onLuminousOptInButtonClick:function(a){var b=$(a.currentTarget),c=+b.val();c?cave.boss_registEx(1,336):cave.boss_unregist()},onFinishClick:function(a){cave.lls_setItem("agree_olv","1")}}),a.View.Page.WelcomeProfile=a.View.Page.Common.extend({events:{"click .js-slide-button.back-button":"onBackButtonClick","click .js-slide-button.next-button":"onNextButtonClick"},initialize:function(){a.View.Page.Common.prototype.initialize.call(this),this.widgets.push(new a.View.Widget.CheckableControls({el:this.$(".js-checkable-controls")})),this.widgets.push(new a.View.Widget.MultipleSelectMediator({el:this.$("#js-favorite-game-genre-form")})),this.widgets.push(new a.View.Widget.SelectButtons({el:this.$("#js-favorite-game-genre-form")})),this.widgets.push(new a.View.Widget.AchievementUpdater({el:this.$("#welcome-profile-window")})),this.$pageWindow=$("#welcome-profile-window");var b="#profile-game-skill";this.slideByButton($("<button/>").attr("data-slide",b))},slideByButton:function(a){document.activeElement.blur();var b=a.closest(".js-slide-page"),c=$(a.attr("data-slide"));cave.brw_notifyPageMoving(),b.length&&(b.addClass("none"),this.$pageWindow.removeClass(b.attr("id"))),c.removeClass("none"),this.$pageWindow.addClass(c.attr("id"))},onBackButtonClick:function(a){a.preventDefault();var b=$(a.currentTarget);this.slideByButton(b)},onNextButtonClick:function(b){b.preventDefault();var c=$(b.currentTarget),d=c.closest(".js-slide-page").find("form"),e=this;a.Form.submit(d,c,!0).done(function(){c.attr("data-slide")&&e.slideByButton(c),c.hasClass("finish-button")&&(c.one("olv:achievement:update:done",function(){a.Browsing.replaceWith(c.attr("data-href"))}),c.trigger("olv:achievement:update"))})}}),a.View.Page.WelcomeFavoriteCommunityVisibility=a.View.Page.Common.extend({events:{"click .next-button":"onClickToMyPageButton"},initialize:function(){a.View.Page.Common.prototype.initialize.call(this),this.widgets.push(new a.View.Widget.CheckableControls({el:this.$(".js-checkable-controls")})),this.widgets.push(new a.View.Widget.AchievementUpdater({el:this.$("#favorite-community-suggest")}))},onClickToMyPageButton:function(b){b.preventDefault();var c=$(b.currentTarget),d=$("#js-favorite-community-visibility-form");a.Form.submit(d,c,!0).done(function(){c.one("olv:achievement:update:done",function(){a.Browsing.replaceWith(c.attr("data-href"))}),c.trigger("olv:achievement:update")})}}),a.View.Page.GuestWelcome=a.View.Page.Common.extend({events:{"click a[href]":"onAnyLinkClick"},onAnyLinkClick:function(a){var b=$(a.currentTarget);cave.ls_setGuestModeLaunched(!0),b.hasClass("register")&&(a.preventDefault(),setTimeout(function(){cave.jump_toAccount(1)},0))}}),a.View.Page.Users=a.View.Page.Common.extend({events:{"click .cancel-button":function(){a.Browsing.goBack()}},initialize:function(){a.View.Page.Common.prototype.initialize.call(this),this.widgets.push(new a.View.Widget.UserSearch({el:$(".user-search-button")}))}}),a.View.Page.TitleSearch=a.View.Page.Common.extend({events:{"click .cancel-button":function(){a.Browsing.goBack()}},initialize:function(){a.View.Page.Common.prototype.initialize.call(this),this.widgets.push(new a.View.Widget.TitleSearch({el:$(".title-search-button")}))}}),a.View.Page.Communities=a.View.Page.Common.extend({initialize:function(){a.View.Page.Common.prototype.initialize.call(this),a.Guest.isGuest()||this.widgets.push(new a.View.Widget.InfoTicker({el:$(".info-ticker")})),this.widgets.push(new a.View.Widget.URLSelector({el:$("#view-region-selector")})),this.widgets.push(new a.View.Widget.URLSelector({el:$("#community-filter")})),this.widgets.push(new a.View.Widget.CloseTutorial({el:$(".tutorial-close-button")})),this.widgets.push(new a.View.Widget.TitleSearch({el:$(".title-search-button")}))}}),a.View.Page.MyNews=a.View.Page.Common.extend({initialize:function(){a.View.Page.Common.prototype.initialize.call(this),this.widgets.push(new a.View.Widget.CloseTutorial({el:$(".tutorial-close-button")})),this.widgets.push(new a.View.Widget.Follow({el:$(".toggle-follow-button")}))}}),a.View.Page.ConfirmAlbum=a.View.Page.Common.extend({initialize:function(){a.View.Page.Common.prototype.initialize.call(this),this.widgets.push(new a.View.Widget.ConfirmAlbum({el:$(".js-confirm-album-window")}))}}),a.View.Page.Warning=a.View.Page.Common.extend({events:{'click input[type="submit"]':"onSubmit","click .exit-button":"onExitButton"},onSubmit:function(b){var c=$(b.currentTarget);if(!a.Form.isDisabled(c)&&!b.defaultPrevented){b.preventDefault();var d=$(b.currentTarget.form);a.Form.submit(d,c,!0,!0).done(function(b){var d=a.Browsing.replaceWith(b.location||"/");a.Form.disable(c,d)})}},onExitButton:function(a){a.preventDefault(),setTimeout(function(){cave.exitApp()},0)}}),a.View.Page.PostError=a.View.Page.Common.extend({events:{"click .back-button":function(){a.Browsing.goBack()}}}),a.View.Page.Help=a.View.Page.Common.extend({initialize:function(){a.View.Page.Common.prototype.initialize.call(this),a.ScrollGuide.activate()}}),a.View.Widget=a.View.Widget||{},a.View.Widget.OverlaidPreview=Backbone.View.extend({events:{input:"onTextInput"},initialize:function(){var a;this.$el.attr("data-preview-class",function(b,c){return a=c||"textarea-text-preview"}),this.textPreview=$('<div class="placeholder">').addClass(a).insertAfter(this.$el);var b=this.$el.val();this.textPreview.text(b||this.$el.attr("placeholder")),this.textPreview.toggleClass("placeholder",!b)},onTextInput:function(a){var b=$(a.target),c=b.val();this.textPreview.text(c||b.attr("placeholder")),this.textPreview.toggleClass("placeholder",!c)}}),a.View.Widget.TextareaWithMenu=Backbone.View.extend({className:"textarea-with-menu",events:{'click input[name="_post_type"]':"onMenuClicked","olv:painting:start":"paint","click .textarea-memo-preview":function(){this.$el.trigger("olv:painting:start")}},initialize:function(){this.painting=this.$('form input[name="painting"]'),this.paintingPreview=this.$(".textarea-memo-preview"),this.body=this.$('input[name="body"], textarea[name="body"]'),cave.memo_hasValidImage()&&this.previePaint();var a=this.$('input[name="_post_type"]:checked');this.toggleMenu(a)},onMenuClicked:function(a){var b=$(a.target);this.toggleMenu(b),"painting"===b.val()?this.$el.trigger("olv:painting:start"):this.inputTextBody(),this.$el.trigger("olv:textarea:menu:change")},toggleMenu:function(a){var b="body"===a.val();this.$el.toggleClass("active-text",b),this.$el.toggleClass("active-memo",!b),this.$('input[name="body"], textarea[name="body"]').prop("disabled",!b),this.painting.prop("disabled",b)},inputTextBody:function(){setTimeout($.proxy(function(){var a=cave.swkbd_callFullKeyboard(this.body.val(),+this.body.attr("maxlength")||200,0,!1,!0,!0);null!=a&&(this.body.val(a),this.body.trigger("input"))},this),0)},paint:function(){setTimeout($.proxy(function(){cave.memo_open(),cave.memo_hasValidImage()&&(this.previePaint(),this.$el.trigger("olv:painting:end"))},this),0)},previePaint:function(){var a=cave.memo_getImageBmp(),b="data:image/bmp;base64,"+a;this.paintingPreview.css("background-image","url("+b+")"),this.painting.val(a)}}),a.View.Widget.UpdateChecker=Backbone.View.extend({events:{"olv:updatechecker:update":"onUpdate"},onUpdate:function(b,c){var d=a.UpdateChecker.getInstance();$.each(d._settings,function(a,b){var d=!0;$.each(b.params,function(a,b){void 0==c[a]&&(this.success=!1)}),d&&b.update.call(void 0,c,b.params)})},initialize:function(){var b=a.UpdateChecker.getInstance();a.View.Widget.UpdateChecker.isInvoked||(b.onUpdate("checkupdate",{news:{},admin_message:{},mission:{}},function(b,c){var d=0;$.each(c,function(a,c){d+=Number(b[a].unread_count)}),a.Toolbar.setNotificationCount(d)}),a.View.Widget.UpdateChecker.isInvoked=!0),b.invoke(),$(document).one("olv:pagechange:end",function(a,c){b.pjaxLoadLog=c?c.join(","):""}),$(document).one("olv:pagechange:start",function(){b.clearTimeout()})}},{isInvoked:!1}),a.View.Widget.GuestDialog=Backbone.View.extend({events:{"click .guest-dialog":"onButtonClick"},onButtonClick:function(b){b.preventDefault(),a.deferredConfirm(null,a.loc("olv.portal.guest.alert.message")).done(function(a){a&&cave.jump_toAccount(0)})}}),a.View.Widget.AgeGateDialog=Backbone.View.extend({events:{"click .age-confirm-button":"onAgeConfirmButton","mousedown .age-gate select":"onMousedownSelect","change .age-gate select":"onChangeSelect","click .cancel-button":function(){a.Browsing.goBack()}},initialize:function(){$("#body").children().filter(function(){return!$(this).hasClass("age-gate-dialog")}).hide(),this.$day=this.$(".day"),this.$month=this.$(".month"),this.$year=this.$(".year")},validateDate:function(a,b,c){if(isNaN(a)||isNaN(b)||isNaN(c))return!1;var d=new Date(a,b-1,c);return d.getFullYear()!==a||d.getMonth()+1!==b||d.getDate()!==c?!1:!0},calculateAge:function(a,b,c){var d=new Date,e=100*b+c>100*(d.getMonth()+1)+d.getDate()?1:0;return d.getFullYear()-a-e},validateAge:function(a,b,c){return this.calculateAge(a,b,c)>=18},defaultDate:{year:1990,month:1,day:1},selectDefault:function(a,b){var c=this.defaultDate[b],d=$(a[0].options[a[0].selectedIndex]);isNaN(d.val())&&(a.find('[value="'+c+'"]').prop("selected",!0),a.trigger("change"),this.adjustDay(),d.remove())},onMousedownSelect:function(a){var b=$(a.currentTarget);this.selectDefault(b,b.attr("name"))},adjustDay:function(){var a=this.$day,b=+a.val(),c=+this.$month.val(),d=+this.$year.val();if(!isNaN(c)){var e=new Date(d,c,0).getDate(),f=+a.find("option").last().val();if(f>e)$(Array.prototype.slice.call(a[0].options,e-f)).remove();else if(e>f)for(var g=f+1;e>=g;g++)a.append($("<option>").val(g).text(g));!isNaN(b)&&b>e&&(a.find('[value="'+e+'"]').prop("selected",!0),a.trigger("change"))}},passAgeGate:function(){this.$el.remove(),$("#body").children().show(),a.Cookie.set("age_gate_done","1")},onChangeSelect:function(a){this.adjustDay()},onAgeConfirmButton:function(b){var c=+this.$year.val(),d=+this.$month.val(),e=+this.$day.val();a.Cookie.get("age_gate_done")?this.passAgeGate():this.validateDate(c,d,e)?this.validateAge(c,d,e)?this.passAgeGate():(this.$(".age-gate").addClass("none"),this.$(".back-dialog").removeClass("none")):a.deferredAlert(null,a.Locale.text("olv.portal.age_gate.select_label"))}}),a.View.Widget.HiddenContent=Backbone.View.extend({className:"post multi-timeline-post",events:{"click .hidden-content-button":"onHiddenClick"},onHiddenClick:function(a){var b=$(a.currentTarget),c=b.closest(".hidden");c.removeClass("hidden"),c.filter("[data-href-hidden]").add(c.find("[data-href-hidden]")).each(function(){var a=$(this);a.attr(a.is("a")?"href":"data-href",a.attr("data-href-hidden"))}),b.closest(".hidden-content").remove()}}),a.View.Widget.YoutubeJump=Backbone.View.extend({events:{click:"onClick"},onClick:function(b){b.preventDefault();var c=$(b.currentTarget),d=cave.jump_getYoutubeVersion(),e=c.attr("data-jump-query");return-1===d?void a.deferredAlert(null,a.loc("olv.portal.n3ds.youtube.alert")):1024>d?void a.deferredAlert(null,a.loc("olv.portal.n3ds.youtube.alert.patch")):void(cave.jump_suspendedYoutube()?a.deferredConfirm(null,a.loc("olv.portal.n3ds.youtube.jump")).done(function(a){a&&cave.jump_toSuspendedYoutube(e)}):setTimeout(function(){cave.jump_toYoutube(1,e)},0))}}),a.View.Widget.Reply=Backbone.View.extend({events:{"click .more-button":"onMoreButtonClick"},onMoreButtonClick:function(b){var c=$(b.currentTarget).closest("a");b.preventDefault(),this.loader||a.Form.isDisabled(c)||(a.Loading.lock(),this.loader=a.Form.get(c.attr("href"),null,c,!1).done($.proxy(function(a){var b=$(a);if(c.hasClass("all-replies-button")){c.remove();var d=b.filter(".post-permalink-reply").children().filter(function(){return!$("#"+this.id).length});this.$el.find(".post-permalink-reply").prepend(d)}else this.$el.empty().append(b);c.hasClass("newer-replies-button")?window.scroll(0,this.$el.offset().top):(c.hasClass("older-replies-button")||c.hasClass("newest-replies-button"))&&window.scroll(0,$(document).height())},this)).always($.proxy(function(){c.removeClass("loading"),this.loader=null,setTimeout(function(){a.Loading.unlock()},0)},this)))}}),a.View.Widget.FirstPostNotice=Backbone.View.extend({events:{click:"onTriggerClick"},onTriggerClick:function(b){if($(document.body).attr("data-is-first-post")&&!a.Form.isDisabled(this.$el)){var c=$(b.currentTarget);b.preventDefault(),c.removeAttr("data-pjax"),a.deferredAlert(null,a.loc("olv.portal.confirm_display_played_mark")).done(function(){c.attr("data-pjax","1");var a=c.attr("data-sound");c.attr("data-sound",""),c.trigger("click"),c.attr("data-sound",a)}),$(document.body).removeAttr("data-is-first-post"),$.post("/settings/struct_post").fail(function(){$(document.body).attr("data-is-first-post","1")})}}}),a.View.Widget.Empathy=Backbone.View.extend({className:"post",events:{"click .empathy-button":"onEmpathyClick","olv:entry:empathy:toggle":"onEmpathyToggle","olv:entry:empathy:toggle:fail":"onEmpathyToggle"},isEmpathyAdded:function(a){return a.hasClass("empathy-added")},onEmpathyClick:function(b){var c=$(b.currentTarget);if(!(a.Form.isDisabled(c)||a.Guest.isGuest()||b.defaultPrevented)){var d=this.isEmpathyAdded(c),e=!d,f=c.attr("data-action");c.trigger("olv:entry:empathy:toggle",[e]),d&&(f+=".delete");var g=a.Form.post(f,null,c).done(function(){c.trigger("olv:entry:empathy:toggle:done",[e])}).fail(function(){c.trigger("olv:entry:empathy:toggle:fail",[d])});return g}},onEmpathyToggle:function(a,b){var c=$(a.target);this.toggleButtonStatus(c,b);var d;d=c.hasClass("reply")?c.closest(".reply-meta").find(".empathy-count"):c.closest(".post-meta").find(".empathy-count"),d.text(+d.text()+(b?1:-1))},toggleButtonStatus:function(b,c){b.toggleClass("empathy-added",c),b.attr("data-sound",c?"SE_OLV_MII_ADD":"SE_OLV_CANCEL");var d=b.attr("data-feeling")||"normal";b.find(".empathy-button-text").text(a.loc("olv.portal.miitoo."+d+(c?".delete":"")))}}),a.View.Widget.ImageViewer=Backbone.View.extend({events:{"click a":"onScreenshotClick"},onScreenshotClick:function(b){return a.router.lockRequest?!1:(a.router.lockRequest=!0,void cave.brw_notifyPageMoving())}}),a.View.Widget.EmpathyWithIcons=a.View.Widget.Empathy.extend({initialize:function(){a.View.Widget.Empathy.prototype.initialize.call(this);var b=this.$(".empathy-button"),c=this.isEmpathyAdded(b);this.updateIcons(b,c)},onEmpathyToggle:function(a,b){var c=$(a.target);this.toggleButtonStatus(c,b),this.updateIcons(c,b)},updateIcons:function(b,c){var d=$("#empathy-content"),e=+b.attr("data-other-empathy-count"),f=e>0?a.loc_n(c?"olv.portal.empathy.you_and_n_added":"olv.portal.empathy.n_added",e,e):c?a.loc("olv.portal.empathy.you_added"):"";d.toggle(!!f),d.find(".post-permalink-feeling-text").text(f),d.find(".visitor").toggle(c),d.find(".extra").toggle(!c)}}),a.View.Widget.ConfirmBlacklist=Backbone.View.extend({events:{"click .unblock-button, .block-button":"onButtonClick","click .cancel-button":function(){a.Browsing.goBack()}},onButtonClick:function(b){var c=$(b.currentTarget),d=c.hasClass("block"),e=c.attr("data-action"),f=c.attr("data-screen-name"),g=d?{title:a.loc("olv.portal.blocklist.add"),body:a.loc("olv.portal.blocklist.block_successed_to",f)}:{title:a.loc("olv.portal.blocklist.delete"),body:a.loc("olv.portal.blocklist.unblock_successed_to",f)};a.Net.ajax({type:"POST",url:e,lock:!0}).done(function(){a.alert(g.title,g.body);var b=c.attr("data-user-url");location.protocol+"//"+location.host+b===cave.history_getPrev()&&cave.history_removePrev(),a.Browsing.replaceWith(b)})}}),a.View.Widget.Blacklist=Backbone.View.extend({events:{"click .unblock-button, .block-button":"onButtonClick"},onButtonClick:function(b){var c=$(b.currentTarget),d=c.hasClass("block"),e=c.attr("data-screen-name"),f=d?{title:a.loc("olv.portal.blocklist.add"),body:a.loc("olv.portal.blocklist.block_confirm_to.for_n3ds",e),back:a.loc("olv.portal.back"),ok:a.loc("olv.portal.block"),done:a.loc("olv.portal.blocklist.block_successed_to",e)}:{title:a.loc("olv.portal.blocklist.delete"),body:a.loc("olv.portal.confirm.remove_from_blocklist_to",e),back:a.loc("olv.portal.back"),ok:a.loc("olv.portal.button.remove"),done:a.loc("olv.portal.blocklist.unblock_successed_to",e)};a.deferredConfirm(f.title,f.body,f.back,f.ok).done(function(b){if(b){var d=c.attr("data-action");a.Form.post(d,null,c,!0).done(function(){a.alert(f.title,f.done),a.Browsing.replaceWith(location.pathname)}).fail(function(b,c,d,e){e&&d.status&&503!==d.status&&a.Browsing.replaceWith(location.pathname)})}})}}),a.View.Widget.Follow=Backbone.View.extend({events:{"click .unfollow-button, .follow-button":"onButtonClick"},onButtonClick:function(b){var c=$(b.currentTarget);if(!(a.Form.isDisabled(c)||a.Guest.isGuest()||b.defaultPrevented)){var d,e=c.hasClass("unfollow-button"),f="",g="";if(e){f=c.attr("data-screen-name"),g=a.loc("olv.portal.unfollow");var h=a.loc("olv.portal.followlist.confirm_unfollow_to",f);d=a.deferredConfirm(g,h,a.loc("olv.portal.back"),a.loc("olv.portal.button.remove"))}else d=$.Deferred().resolve(!0);d.done(function(b){if(b){var d=c.attr("data-action");a.Form.post(d,null,c,!0).done(function(){e&&a.alert(g,a.loc("olv.portal.unfollow_succeeded_to",f)),c.addClass("none").siblings().removeClass("none"),c.hasClass("relation")&&a.Browsing.replaceWith(location.href)})}})}}}),a.View.Widget.FavoriteButtons=Backbone.View.extend({events:{"click .favorite-button":"onFavoriteClick"},onFavoriteClick:function(b){b.preventDefault();var c=$(b.currentTarget);if(!a.Form.isDisabled(c)){var d=c.hasClass("checked"),e=c.attr(d?"data-action-unfavorite":"data-action-favorite");this.toggleFavoriteButton(c,!d),$(document.body).attr("data-is-first-favorite")&&!d&&a.deferredAlert(null,a.loc("olv.portal.confirm_first_favorite")).done(function(){$(document.body).removeAttr("data-is-first-favorite")});var f=this;a.Form.post(e,null,c).done(function(){d=!d,c.trigger("olv:community:favorite:toggle",[d])}).fail(function(){f.toggleFavoriteButton(c,d)})}},toggleFavoriteButton:function(a,b){a.toggleClass("checked",b),a.attr("data-sound",b?"SE_OLV_CHECKBOX_CHECK":"SE_OLV_CHECKBOX_UNCHECK")}}),a.View.Widget._Search=Backbone.View.extend({onInput:function(b){var c=$(b.currentTarget),d=c.attr("data-action"),e=c.val();e&&(c.val(""),a.Browsing.navigate(d+"?"+c.attr("name")+"="+encodeURIComponent(e)))}}),a.View.Widget.UserSearch=a.View.Widget._Search.extend({className:"user-search-button",events:{"input .user-search-user-id":"onInput"}}),a.View.Widget.TitleSearch=a.View.Widget._Search.extend({className:"title-search-button",events:{"input .title-search-title-id":"onInput"}}),a.View.Widget.InfoTicker=Backbone.View.extend({events:{"click a[href]":"onTickerClick"},initialize:function(){var a=this.$el,b="last-seen."+a.attr("data-olive-title-id"),c=+cave.ls_getItem(b)||0,d=+a.attr("data-last-seen")||0;d>c&&(c=d,cave.ls_setItem(b,""+c));var e=+a.attr("data-last-posted");e>c?a.removeClass("none"):a.remove()},onTickerClick:function(b){var c=$(b.currentTarget);if(!a.Form.isDisabled(c)&&!b.defaultPrevented){if(c.attr("data-pjax")){var d=this;$(document).one("olv:pjax:end olv:pjax:error",function(){d.$el.remove()})}else b.preventDefault(),this.$el.remove();var e="last-seen."+this.$el.attr("data-olive-title-id");cave.ls_setItem(e,""+Math.floor(+new Date/1e3)),!a.Guest.isGuest()&&this.$el.attr("data-is-of-miiverse")&&$.post("/settings/miiverse_info_post")}}}),a.View.Widget.ExitOrBackButton=Backbone.View.extend({initialize:function(){var b=location.pathname,c=location.search,d=$("body").attr("data-profile-url"),e=new RegExp("^(/|/communities|/friend_messages|/guide/for_guest|/news/.+|"+d+"|/welcome/profile)$"),f="1"===a.URI.getQueryVars()._cannot_back,g=(!e.test(b)||/^\/$/.test(b)&&/^\?.*page_param=/.test(c))&&cave.history_getBackCount()>0&&!f,h=a.Toolbar;h.setCornerButtonType(g?h.buttons.BACK:h.buttons.EXIT)}}),a.View.Widget.ToolbarVisibility=Backbone.View.extend({initialize:function(){var b=!/^\/(?:titles\/.+\/.+\/(?:topic\/|artwork\/)?(?:post)|users\/.+\/diary\/post|posts\/.+\/reply|welcome\/(?:3ds|redesign_tutorial)?|warning\/.+|welcome_guest|titles\/.+\/select_album_image)$/.test(location.pathname),c=a.Toolbar;c.setVisible(b)}}),a.View.Widget.HomeButton=Backbone.View.extend({initialize:function(){cave.home_setEnabled&&(/^\/(?:titles\/.+\/.+\/(?:topic\/|artwork\/)?(?:post)|users\/.+\/diary\/post|posts\/.+\/reply)$/.test(location.pathname)?cave.home_setEnabled(0):cave.home_setEnabled(1))}}),a.View.Widget.SelectButtons=Backbone.View.extend({events:{"change select":"onSelectChange"},onSelectChange:function(a){var b=$(a.currentTarget);this.updateLabel(b)},updateLabel:function(a){var b=a[0].options[a[0].selectedIndex];a.siblings(".select-button-content").text(b.text)}}),a.View.Widget.SelectableElements=Backbone.View.extend({events:{"change select":"onSelectChange"},initialize:function(){var a=this;a.$el.find("select").each(function(){a.updateClass($(this))})},updateClass:function(a){var b=!!a.val();a.parent().toggleClass("selected",b)},onSelectChange:function(a){var b=$(a.currentTarget);this.updateClass(b)}}),a.View.Widget.URLSelector=a.View.Widget.SelectableElements.extend({onSelectChange:function(b){a.View.Widget.SelectableElements.prototype.onSelectChange.call(this,b);var c=$(b.currentTarget),d=c.val();d&&a.Browsing.navigate(d)}}),a.View.Widget.eShopJump=Backbone.View.extend({events:{click:"onClick"},onClick:function(b){b.preventDefault();var c=$(b.currentTarget),d=c.attr("data-dst-title-id");d&&a.deferredConfirm(null,a.loc("olv.portal.confirm_open_eshop")).done(function(a){cave.jump_toShop(1,d)})}}),a.View.Widget.CheckableControls=Backbone.View.extend({events:{"click input":"onClick"},initialize:function(){var b="input"===this.el.tagName.toLowerCase()?this.$el:this.$("input:checked");b.each(function(){a.Form.updateParentClass(this)})},onClick:function(b){a.Form.updateParentClass(b.currentTarget)}}),a.View.Widget.FreshPost=Backbone.View.extend({initialize:function(){var b=a.View.Widget.FreshPost.stock.shift();if(b){var c=$("#"+b.attr("data-id")).length?!0:!1,d=this.isInAppropriatePage(b);!c&&d&&this.insertPost(b);var e=+b.attr("data-requires-to-scroll");d&&e&&this.scrollToPost(b)}},isInAppropriatePage:function(a){var b=a.attr("data-post-subtype-id"),c=+this.$el.attr("data-is-visitors-diary-posts");if("diary_post"===b&&c)return!0;var d=a.attr("data-olv-community-id");return!!d&&d===this.$el.attr("data-olv-community-id")},insertPost:function(a){var b=this.$el.next();b.length&&b.hasClass("no-content-window")&&b.remove(),this.el.insertAdjacentHTML("afterbegin",a.prop("text"))},scrollToPost:function(b){var c=a.ScrollGuide.WINDOW_INNER_HEIGHT/2-20,d=$("#"+b.attr("data-id"));d.length&&$(document).one("olv:pagechange:end",function(){setTimeout(function(){cave.brw_scrollImmediately(0,d.offset().top-c),d.attr("data-test-scrolled","1")},5)})}}),a.View.Widget.FreshPost.stock=[],a.View.Widget.FreshReply=a.View.Widget.FreshPost.extend({isInAppropriatePage:function(a){var b=a.attr("data-parent-post-id");return!!b&&b===this.$el.attr("data-parent-post-id")},insertPost:function(a){this.el.insertAdjacentHTML("beforeend",a.prop("text"))}}),a.View.Widget.PostScroller=Backbone.View.extend({events:{keydown:"onKeyDown"},initialize:function(){this.offset=224,this.lastScrollTop=0},onKeyDown:function(a){82===a.which?this.scrollToNearestElement(!1):76===a.which&&this.scrollToNearestElement(!0)},scrollToNearestElement:function(a){var b=this.$(".scroll:not(.none)"),c=null,d=this,e=cave.brw_getScrollTopY(),f=document.body.scrollHeight;460>=f-e&&f-this.lastScrollTop<=460&&(e=this.lastScrollTop),b.each(function(){var b=$(this),f=b.offset().top,g=f-(e+d.offset);if(a){if(g>=0)return!1;
c=b}else if(g>0)return c=b,!1});var g;if(c){var h="a"===c[0].nodeName.toLowerCase()?c:c.find(".scroll-focus").first(),i=h.prop("type");"text"===i||"textarea"===i?(h.attr("open","false"),h.focus(),h.removeAttr("open")):h.focus(),g=c.offset().top-d.offset,c.trigger("olv:keyhandler:scroll:element")}else g=a?0:f,$(document.activeElement).blur(),$(document).trigger("olv:keyhandler:scroll:document");return window.scrollTo(0,g),this.lastScrollTop=g,c}}),a.View.Widget.PageReloader=Backbone.View.extend({events:{keydown:"onKeyDown"},onKeyDown:function(b){89===b.which&&($(document).trigger("olv:pagereloader:reload"),a.Browsing.reload())}}),a.View.Widget.Dropdown=Backbone.View.extend({className:"dropdown",events:{"click .dropdown-toggle":"onToggleClick"},initialize:function(){this.isOpen=this.$el.hasClass("open"),this.eventNS=".delegateEvents"+this.cid,this.$toggle=this.$(".dropdown-toggle").first(),this.$menu=this.$(".dropdown-menu").first()},open:function(a){if(!this.isOpen){this.isOpen=!0,this.$el.addClass("open"),this.$el.trigger("olv:dropdown:open",[this,a||null]);var b="click"+this.eventNS,c=$.proxy(this.onBodyClick,this);setTimeout(function(){$(document.body).on(b,c)})}},close:function(a){this.isOpen&&(this.isOpen=!1,this.$el.removeClass("open"),this.$el.trigger("olv:dropdown:close",[this,a||null]),$(document.body).off(this.eventNS))},isClosableElement:function(a){for(var b=this.$menu[0];a&&a!==b;a=a.parentNode){var c=a.nodeName.toLowerCase();if("input"===c||"button"===c||"a"===c)return!0}return!1},onToggleClick:function(a){a.preventDefault(),this.$el.hasClass("disabled")||this.isOpen||this.open(this.$toggle[0])},onBodyClick:function(a){var b=a.target,c=this.$menu[0];(c!==b&&!$.contains(c,b)||this.isClosableElement(b))&&this.close(b)},undelegateEvents:function(){this.close(),Backbone.View.prototype.undelegateEvents.call(this)}}),a.View.Widget.CloseTutorial=Backbone.View.extend({events:{click:"onCloseTutorialClick"},onCloseTutorialClick:function(b){var c=$(b.currentTarget);if(c.parent().hide(),c.attr("data-tutorial-name"))a.Net.post("/settings/tutorial_post",{tutorial_name:c.attr("data-tutorial-name")}).done(function(){});else if(c.attr("data-achievement-name")){var d=c.attr("data-achievement-name").split(/\s*,\s*/);a.Achievement.requestAchieveWithoutRegard(d)}b.preventDefault()}}),a.View.Widget.PostToBack=Backbone.View.extend({events:{submit:"onSubmit"},onSubmit:function(b){b.preventDefault();var c=$(b.currentTarget),d=c.find('input[type="submit"]');a.Form.submit(c,d,!0).done(function(){history.back()})}}),a.View.Widget.BodyLanguageSelector=Backbone.View.extend({events:{"change select":"onSelectChange"},onSelectChange:function(a){var b=$(a.currentTarget),c=b.val();$("#body-language-"+c).toggleClass("none",!1).siblings(".multi-language-body").toggleClass("none",!0)}}),a.View.Widget.MoreContentButton=Backbone.View.extend({events:{"click .more-content-button":"onMoreContentButton"},initialize:function(b){var c=this.$el.find(".post-content-text");c&&0!=c.length&&c.each(function(){var b=$(this),c=b.text().match(/([\s\S]+)(\n+---+\n[\s\S]+)/);if(c){b.text(c[1]);var d=$('<span class="wrapped none"></span>').text(c[2]);b.append(d);var e=$('<a href="#" class="more-content-button"></a>');e.text(a.loc("olv.portal.read_more_content")),b.after(e)}})},onMoreContentButton:function(a){a.preventDefault();var b=$(a.currentTarget);b.prev().find(".wrapped").removeClass("none"),b.remove()}}),a.View.Widget.MultipleSelectMediator=Backbone.View.extend({events:{"change select":"onChange"},initialize:function(){var b=this,c=_.map(this.$("select"),function(b){return new a.View.Widget.MultipleSelect({el:b})});this.selectsByName=_.groupBy(c,function(a){return a.el.name}),this.$("select").each(function(){b.imposeDistinctRestrictionOn(this)})},uniq:function(a){return _.chain(a).groupBy(function(a){return a}).keys().value()},buildComplementSelector:function(a){return a.map(function(a){return":not("+a+")"}).join("")},onChange:function(a){this.imposeDistinctRestrictionOn(a.currentTarget)},imposeDistinctRestrictionOn:function(b){var c=b.name,d=b.value,e=this.selectsByName[c],f=e.map(function(a){return a.getSelectedConfigurableOption()}).filter(function(a){return a}),g=this.uniq(f.map(function(a){return a.value})),h=e.filter(function(a){return a.el!==b}),i={enableOptionsSelector:"option"+this.buildComplementSelector(g.map(function(a){return"[value="+a+"]"}))},j=new a.View.Widget.MultipleSelect({el:b});j.getSelectedConfigurableOption()&&(i.disableOptionsSelector="option[value="+d+"]"),h.forEach(function(a){a.$el.trigger("olv:select:change",i)})}}),a.View.Widget.MultipleSelect=Backbone.View.extend({events:{"olv:select:change":"onChanged"},getSelectedConfigurableOption:function(){return _.find(this.$el.find("option").toArray(),function(a){return a.selected&&a.hasAttribute("data-is-configurable")})},enableOptions:function(a){var b=this.$el.find(a);b.prop("disabled",!1)},disableOptions:function(a){var b=this.$el.find(a);b.prop("disabled",!0)},onChanged:function(a,b){"enableOptionsSelector"in b&&this.enableOptions(b.enableOptionsSelector),"disableOptionsSelector"in b&&this.disableOptions(b.disableOptionsSelector)}}),a.View.Widget.AchievementUpdater=Backbone.View.extend({events:{"olv:achievement:update":"onAchievementUpdate"},onAchievementUpdate:function(b){var c=$(b.target),d=c.attr("data-achievement-name");d&&a.Achievement.requestAchieveWithoutRegard([d]).done(function(a){c.trigger("olv:achievement:update:done",[a])})}}),a.View.Page.AlbumDetail=a.View.Page.Common.extend({events:{"click .js-album-delete-button":"onDeleteAlbumClick"},initialize:function(){a.View.Page.Common.prototype.initialize.call(this),this.widgets.push(new a.View.Widget.URLSelector({el:$("#post-target-selector")}))},onDeleteAlbumClick:function(b){var c=$(b.currentTarget.form),d=$(b.currentTarget).find(".js-album-delete-button");a.Form.isDisabled(d)||b.defaultPrevented||(b.preventDefault(),a.confirm(null,a.loc("olv.portal.album.delete_confirm"))&&a.Form.submit(c,d,!0).done(function(a){history.back()}))}}),a.View.Widget.CreateDiaryOrSaveScreenshotWindow=Backbone.View.extend({events:{"click .js-edit-diary-button":"onPostDiaryClick","click .js-save-album-button":"onSaveScreenshotClick"},initialize:function(){var a=+this.$el.attr("data-can-create")?!0:!1;if(a){var b=this.setupScreenshotSelector();b.hasImage&&this.$el.toggleClass("no-screenshots",!1);var c=this;b.loadDeferred.then(function(){c.toggleActionEnabled(!0)})}this.$el.toggleClass("none",!1)},toggleActionEnabled:function(a){var b=+this.$el.attr("data-is-readonly")?!0:!1;if(!b||!a){var c=this.$el.find(".js-edit-diary-button"),d=this.$el.find(".js-save-album-button");c.toggleClass("disabled",!a),d.toggleClass("disabled",!a)}},setupScreenshotSelector:function(){var b=this.$el.find(".js-diary-screenshot-window-image-container"),c=b.find(".js-screenshot-capture-button"),d=[];c.each(function(b,c){var e=$(c),f=a.Screenshot[e.hasClass("js-upside")?"SCREEN_UPSIDE":"SCREEN_DOWNSIDE"];if(a.Screenshot.isEnabled(f)){var g=a.Screenshot.retrieveImagePath(f);if(g){var h=e.find("img"),i=$.Deferred();h.one("load",function(){setTimeout(i.resolve,300)}),d.push(i),h.prop("src",g),e.find('input[type="radio"]').prop("disabled",!1)}}});var e,f=d.length>0?!0:!1;if(f){for(var g=0,h=c.length;h>g;g++){var i=c.eq(g).find('input[type="radio"]');if(!i.prop("disabled")){i.prop("checked",!0),a.Form.updateParentClass(i.get(0));break}}e=$.when.apply($,d)}else e=$.Deferred(),e.resolve();return{hasImage:f,loadDeferred:e}},getSelectedScreenshotTarget:function(){var a=this.$el.find(".js-diary-screenshot-window-image-container"),b=a.find(".checked");return b.find('input[type="radio"]').attr("value")},setSelectedScreenshot:function(){var a=this.$('[name="screenshot"]'),b=this.getSelectedScreenshotTarget();a.prop("disabled",!1).attr("lls",b),a.focus(),a.trigger("click"),a.blur()},onPostDiaryClick:function(b){b.preventDefault();var c=this.$el.find(".js-edit-diary-button");if(!a.Form.isDisabled(c)){this.toggleActionEnabled(!1);var d=c.attr("href").split("?")[0],e=d+"?lls="+this.getSelectedScreenshotTarget();a.Browsing.navigate(e)}},onSaveScreenshotClick:function(b){b.preventDefault();var c=this.$el.find(".js-save-album");a.Form.isDisabled(c.find(".js-save-album-button"))||(this.toggleActionEnabled(!1),this.setSelectedScreenshot(),a.Loading.lock(),c.submit())}}),a.View.Widget.ConfirmAlbum=Backbone.View.extend({events:{"click .js-return-to-game-button":"onReturnToGameClick"},onReturnToGameClick:function(){setTimeout(function(){cave.jump_toSuspendedApplication()},0)}}),a.View.Widget.CloseTopicPost=Backbone.View.extend({events:{"click .js-close-topic-post-button":"onCloseTopicPostClick"},onCloseTopicPostClick:function(b){var c=$(b.currentTarget.form),d=$(b.currentTarget).find(".js-close-topic-post-button");a.Form.isDisabled(d)||b.defaultPrevented||(b.preventDefault(),a.confirm(a.loc("olv.portal.edit.action.close_topic_post"),a.loc("olv.portal.edit.action.close_topic_post.confirm"),a.loc("olv.portal.stop"),a.loc("olv.portal.yes"))&&a.Form.submit(c,d,!0).done(function(b){a.Browsing.replaceWith(location.pathname)}))}}),a.View.Page.PostFormAlbumSelector=a.View.Page.Common.extend({initialize:function(){a.View.Page.Common.prototype.initialize.call(this),this.oliveTitleId=$(".js-album-image-list").attr("data-olive-title-id"),this.lockingForBack=!1},events:{"click .js-select-album-image":"onSelectAlbumImage","click .cancel-button":function(){a.Browsing.goBack()}},onSelectAlbumImage:function(b){if(b.preventDefault(),!this.lockingForBack){this.lockingForBack=!0;var c=$(b.target);a.View.Page.PostFormAlbumSelector.stock.push({oliveTitleId:this.oliveTitleId,albumImageId:c.attr("data-album-image-id"),previewUrl:c.attr("data-album-image-preview-src")}),history.back()}}}),a.View.Page.PostFormAlbumSelector.stock=[],a.Content=a.Content||{},a.Content.replaceBody=function(a){var b=$("#body"),c=$("<div>").html(a).find("#body");document.body.replaceChild(c[0],b[0])},a.Form={toggleDisabled:function(b,c){var d=void 0===c;return b.each(function(){var b=$(this),e=d?!a.Form.isDisabled(b):c;if(b.toggleClass("disabled",e),"undefined"!=typeof this.form)b.prop("disabled",e);else{var f=e?"href":"data-disabled-href",g=e?"data-disabled-href":"href",h=b.attr(f);void 0!==h&&(b.removeAttr(f),b.attr(g,h))}}),b},isDisabled:function(a){return a.length&&"undefined"!=typeof a[0].form?a.prop("disabled"):a.hasClass("disabled")},disable:function(b,c){return a.Form.toggleDisabled(b,!0),c.always(function(){a.Form.toggleDisabled(b,!1)}),b},submit:function(a,b,c,d){a.trigger("olv:form:submit",[b||$()]);var e=a.serializeArray(),f=b&&b.is("input, button")&&b.prop("name");f&&e.push({name:f,value:b.val()});var g={type:a.prop("method"),url:a.attr("action"),data:e,lock:c};return d||(g.headers={"X-Requested-With":""}),this.send(g,b)},get:function(a,b,c,d){var e={type:"GET",url:a,data:b,lock:d};return this.send(e,c)},post:function(a,b,c,d){var e={type:"POST",url:a,data:b,lock:d};return this.send(e,c)},send:function(b,c){var d=a.Net.ajax(b);return $(document).trigger("olv:form:send",[d,b,c||$()]),c&&(a.Form.disable(c,d),c.addClass("loading"),d.always(function(){c.removeClass("loading")})),d},updateParentClass:function(a){switch(a.type){case"radio":var b;if(a.form){var c=a.form.elements[a.name];b=c.length?$(Array.prototype.slice.call(c)):$(c)}else b=$('input[name="'+a.name+'"]');b.each(function(){$(this).parent().toggleClass("checked",this.checked)});break;case"checkbox":$(a).parent().toggleClass("checked",a.checked)}},setup:function(){$(document).on("olv:form:send",function(b,c,d){"POST"===(d.type||"").toUpperCase()&&a.Pjax.cacheClear()})},reset:function(b){b.each(function(){this.reset(),$(this).find("input").each(function(){a.Form.updateParentClass(this)})})},serializeUserInputs:function(a){var b={},c=a.$("[data-save-user-input]");return c.each(function(){var a=$(this);if("checkbox"!==a.attr("type")&&"radio"!==a.attr("type")||a.prop("checked")){var c='[name="'+a.attr("name")+'"]';b[c]=a.val()}}),b},fillInputsWithSerializedObject:function(b,c){for(var d in c){var e=c[d],f=b.$(d);"checkbox"===f.attr("type")||"radio"===f.attr("type")?(f.prop("checked",!1).filter('[value="'+e+'"]').prop("checked",!0),a.Form.updateParentClass(f.get(0))):f.val(e)}}},a.Form.setup(),a.Guest={isGuest:function(){return $("#body").hasClass("guest")}},a.Sound={defaultActivationSound:"SE_OLV_OK",playActivationSound:function(a){var b=a.attr("data-sound");""!==b&&this.playSound(b||this.defaultActivationSound)},playSound:function(a){cave.snd_playSe(a)},playBGM:function(a){cave.snd_playBgm(a)},playBGMByPath:function(a){var b=/^\/welcome\//.test(a)?"BGM_CAVE_SYOKAI":/^\/(?:settings(?:\/|$)|help\/|guide\/)/.test(a)?"BGM_CAVE_SETTING":"BGM_CAVE_MAIN";this.playBGM(b)},activationTarget:null,onPreActivate:function(a){for(var b=!1,c=a.target,d=document.body;c&&c!==d;c=c.parentNode){var e=c.nodeName.toLowerCase();if("a"===e){b=!!c.href;break}if("input"===e){var f=c.type;b="text"!==f&&"password"!==f&&"file"!==f&&!c.disabled;break}if("button"===e){b=!c.disabled;break}if("textarea"===e||"select"===e)break;var g=" "+c.className+" ";if(g.indexOf(" trigger ")>=0){b=g.indexOf(" disabled ")<0;break}}this.activationTarget=b?c:null},onActivate:function(a){var b=this.activationTarget;this.activationTarget=null,b&&this.playActivationSound($(b))},onPageChange:function(){this.playBGMByPath(location.pathname)},onScrollElement:function(){this.playSound("SE_WAVE_SCROLL_PAGE_LR")},onScrollDocument:function(){this.playSound("SE_WAVE_SCROLL_LIMIT_LR")},onPageReload:function(a){this.playSound("SE_OLV_RELOAD")},onDropdownOpen:function(a,b,c){b.$toggle.attr("data-sound","SE_OLV_BALLOON_OPEN")},onDropdownClose:function(a,b,c){b.$toggle.attr("data-sound","SE_OLV_BALLOON_CLOSE"),this.activationTarget||this.playSound("SE_OLV_BALLOON_CLOSE")},setup:function(){document.addEventListener("click",$.proxy(this.onPreActivate,this),!0),document.addEventListener("click",$.proxy(this.onActivate,this),!1);var a=$(document);a.on("olv:pagechange:ready",$.proxy(this.onPageChange,this)),this.onPageChange(),a.on("olv:keyhandler:scroll:element",$.proxy(this.onScrollElement,this)),a.on("olv:keyhandler:scroll:document",$.proxy(this.onScrollDocument,this)),a.on("olv:pagereloader:reload",$.proxy(this.onPageReload,this)),a.on("olv:dropdown:open",$.proxy(this.onDropdownOpen,this)),a.on("olv:dropdown:close",$.proxy(this.onDropdownClose,this))}},a.Sound.setup(),a.ScrollGuide={WINDOW_INNER_HEIGHT:480,activate:function(){var a=this,b=history.state?history.state.id:null;$(document).one("olv:router:dispatch:end",function(){setTimeout(function(){var c=history.state?history.state.id:null;document.body.clientHeight>a.WINDOW_INNER_HEIGHT&&cave.brw_getScrollTopY()<=0&&b===c&&a.show()},1500)})},show:function(){a.Toolbar.isVisible()?cave.effect_setScrollGuideOffsetPos(0,28):cave.effect_setScrollGuideOffsetPos(0,0),cave.effect_scrollGuide(1)},hide:function(){cave.effect_scrollGuide(0)}},a.URI={getQueryVars:function(){for(var a,b={},c=window.location.href,d=c.slice(c.indexOf("?")+1).split("&"),e=0;e<d.length;e++)a=d[e].split("="),b[decodeURIComponent(a[0])]=decodeURIComponent(a[1]);return b},origin:function(){return location.protocol+"//"+location.host}},a.Achievement={requestAchieveWithoutRegard:function(a){var b=$.Deferred();return this.requestAchieve(a).always(function(){b.resolveWith(this,arguments)}),b.promise()},requestAchieve:function(b){return a.Net.ajax({type:"POST",url:"/my/achievements.json",contentType:"application/json",data:JSON.stringify({achievements:b}),silent:!0,lock:!0})}},a.Screenshot={SCREEN_UPSIDE:0,SCREEN_DOWNSIDE:1,isEnabled:function(a){return void 0===cave.capture_isEnabledEx?cave.capture_isEnabled():cave.capture_isEnabledEx(a)},isEnabledAnySide:function(){return this.isEnabled(this.SCREEN_UPSIDE)||this.isEnabled(this.SCREEN_DOWNSIDE)},retrieveImagePath:function(a){if(a===this.SCREEN_UPSIDE)return cave.lls_setCaptureImage("upside",3),cave.lls_getPath("upside");if(a===this.SCREEN_DOWNSIDE)return cave.lls_setCaptureImage("downside",0),cave.lls_getPath("downside");throw new Error("Invalid screen id")}},a.UpdateChecker=function(a){this._settings={},this.delay_=a||1e3,this.timeout_=null,this.pjaxLoadLog=""},a.UpdateChecker.getInstance=function(){return void 0==a.UpdateChecker.instance&&(a.UpdateChecker.instance=new a.UpdateChecker(1e3)),a.UpdateChecker.instance},a.UpdateChecker.prototype.invoke=function(){this.timeout_=setTimeout($.proxy(function(){this.callback_(),this.clearTimeout()},this),this.delay_)},a.UpdateChecker.prototype.clearTimeout=function(){clearTimeout(this.timeout_)},a.UpdateChecker.prototype.callback_=function(){var b={};$.each(this._settings,$.proxy(function(a){void 0!=this._settings[a].pathname&&this._settings[a].pathname!=location.pathname?delete this._settings[a]:$.each(this._settings[a].params,function(a,c){b[a]=JSON.stringify(c)})},this)),this.pjaxLoadLog&&(b.times=this.pjaxLoadLog),a.Net.ajax({url:"/check_update.json",data:b,silent:!0,cache:!1}).done($.proxy(function(a){$(document).triggerHandler("olv:updatechecker:update",[a])},this))},a.UpdateChecker.prototype.onUpdate=function(a,b,c,d){this._settings[a]={params:b,update:c},d&&(this._settings[a].pathname=location.pathname)},Backbone.History.prototype.loadUrl=function(a){var b=this.fragment=this.getFragment(a),c=(b||"").replace(/\?.*/,"");return _.any(this.handlers,function(a){return a.route.test(c)?(a.callback(c),!0):void 0})},Backbone.History.prototype.getFragment=function(a,b){if(null==a)if(this._hasPushState||!this._wantsHashChange||b){a=this.location.pathname+this.location.search;var c=this.root.replace(/\/$/,"");a.indexOf(c)||(a=a.slice(c.length))}else a=this.getHash();return a.replace(/^\/+/,"")},a.Router=Backbone.Router.extend({isReverting:!1,lockRequest:!1,initialize:function(){this.on("route",function(){a.History.state=history.state})},navigate:function(b,c){if(!this.lockRequest){a.History.isInitialLoad||(this.lockRequest=!0);var d=b.replace(a.URI.origin(),"").replace(Backbone.history.options.root,"");if(c&&c!==!0||(c={trigger:!!c}),!a.Pjax.isEnabled)return void Backbone.Router.prototype.navigate.call(this,d,c);var e=_.extend({},history.state,{scrollTo:cave.brw_getScrollTopY()});window.history.replaceState(e,null),a.History.needToSetState&&(history.state=e),a.Router.prototype._isSameUrl(e.url,b)&&(console.log("Replacing: "+e.url+" -> "+b),c.replace=!0);var f={id:a.Pjax.uniqueId(),url:b,fragment:d,scrollTo:0,replace:!!c.replace};Backbone.Router.prototype.navigate.call(this,d,_.extend({},c,{trigger:!1})),window.history.replaceState(f,null,b),a.History.needToSetState&&(history.state=f),c.trigger&&Backbone.history.loadUrl(d),a.History.isInitialLoad=!1}},route:function(b,c,d){return _.isFunction(c)||d||(d=this[c]),Backbone.Router.prototype.route.call(this,b,c,function(){function b(){a.Router.prototype._isSameUrl(h,history.state.url)?d&&d.apply(e,f):a.Router.prototype._routeManually(Backbone.history.getFragment()),$(document).trigger("olv:router:dispatch:end")}var e=this,f=arguments;if(e.isReverting)return e.isReverting=!1,void $(document).trigger("olv:pagechange:end");console.log("Routing: "+Backbone.history.fragment+" -> "+c);var g=a.History.state?a.History.state.id>history.state.id?"back":history.state.replace?"replace":"forward":void 0,h=history.state.url;a.History.isInitialLoad?b():a.Pjax.go(history.state.url,{direction:g,cacheId:history.state.id}).done(b)})},_isSameUrl:function(a,b){return a&&b&&a.replace(/%20/g,"+")===b.replace(/%20/g,"+")},_routeManually:function(b){var c,d=(b||"").replace(/\?.*/,""),e=_.find(this.routes,function(a,b){return c=Backbone.Router.prototype._routeToRegExp(b),c.test(d)}),f=Backbone.Router.prototype._extractParameters(c,d);_.isFunction(e)?e.apply(a.router,f):this[e]&&this[e].apply(a.router,f)}}),a.Router=a.Router.extend({routes:{"":"activity",communities:"communities","communities/categories/:category":"communities","communities/favorites":"communities",identified_user_posts:"identifiedUserPosts","titles/:titleId/:communityId/post":"postForm","titles/:titleId/:communityId/topic/post":"postForm","titles/:titleId/:communityId/artwork/post":"postForm","titles/:titleId/:communityId/post_memo":"postMemo","titles/:titleId/:communityId/artwork/post_memo":"postMemo","titles/:titleId/select_album_image":"postFormAlbumSelector","users/:userId/diary/post_memo":"postMemo",post_memo:"postMemo","titles/:titleId/:communityId":"community","titles/:titleId/:communityId/new":"community","titles/:titleId/:communityId/hot":"community","titles/:titleId/:communityId/diary":"community","titles/:titleId/:communityId/topic":"community","titles/:titleId/:communityId/topic/new":"community","titles/:titleId/:communityId/topic/open":"community","titles/:titleId/:communityId/artwork":"community","titles/:titleId/:communityId/artwork/new":"community","titles/:titleId/:communityId/artwork/hot":"community","titles/:titleId/:communityId/in_game":"community","titles/:titleId/:communityId/old":"community","titles/search":"titleSearch","posts/:postId":"post","posts/:postId/reply":"replyForm","posts/:postId/violations.create":"violation","replies/:postId/violations.create":"violation","posts/:postId/edit":"editForm","replies/:postId/edit":"editForm",posts:"postProcess",diary_posts:"postProcess",artwork_posts:"postProcess",topic_posts:"postProcess","posts/:postId/replies":"postProcess","replies/:postId":"reply","users/:userId":"user","users/:userId/posts":"user","users/:userId/diary":"userDiary","users/:userId/diary/post":"postDiaryForm","users/:userId/empathies":"user","users/:userId/following":"user","users/:userId/followers":"user","users/:userId/violators.create":"violation","users/:userId/blacklist.confirm":"confirmBlacklist","users/:userId/album/:albumImageId":"albumDetail","users/:userId/album.confirm":"confirmAlbum","settings/account":"accountSettings","settings/profile":"profileSettings","settings/:page":"settings","settings/titles/:titleId":"settings","admin_messages.post":"violation",my_blacklist:"blacklist","welcome/(3ds)":"welcome","welcome/profile":"welcomeProfile",welcome_guest:"guestWelcome","welcome/favorite_community_visibility":"welcomeFavoriteCommunityVisibility",users:"users","news/my_news":"my_news","warning/:page":"warning","error/post_form/:page":"errorPostForm","help/(:page)":"help","guide/(:page)":"guide","*path":"defaultRoute"},defaultRoute:function(b){new a.View.Page.Common({el:"body"})},activity:function(){new a.View.Page.Activity({el:"body"})},communities:function(){new a.View.Page.Communities({el:"body"})},postForm:function(){new a.View.Page.PostForm({el:"body"})},postDiaryForm:function(){new a.View.Page.PostDiaryForm({el:"body"})},replyForm:function(){new a.View.Page.ReplyForm({el:"body"})},postMemo:function(){new a.View.Page.PostMemo({el:"body"})},postProcess:function(){new a.View.Page.PostRedirection({el:"body"})},postFormAlbumSelector:function(){new a.View.Page.PostFormAlbumSelector({el:"body"})},violation:function(){new a.View.Page.Violation({el:"body"})},editForm:function(){new a.View.Page.EditForm({el:"body"})},post:function(){new a.View.Page.Post({el:"body"})},reply:function(){new a.View.Page.Reply({el:"body"})},community:function(){new a.View.Page.Community({el:"body"})},titleSearch:function(){new a.View.Page.TitleSearch({el:"body"})},user:function(){new a.View.Page.User({el:"body"})},userDiary:function(){new a.View.Page.UserDiary({el:"body"})},settings:function(){new a.View.Page.Settings({el:"body"})},accountSettings:function(){new a.View.Page.AccountSettings({el:"body"})},profileSettings:function(){new a.View.Page.ProfileSettings({el:"body"})},users:function(){new a.View.Page.Users({el:"body"})},blacklist:function(){new a.View.Page.Blacklist({el:"body"})},confirmBlacklist:function(){new a.View.Page.ConfirmBlacklist({el:"body "})},identifiedUserPosts:function(){new a.View.Page.IdentifiedUserPosts({el:"body"})},my_news:function(){new a.View.Page.MyNews({el:"body"})},welcome:function(){new a.View.Page.Welcome({el:"body"})},welcomeProfile:function(){new a.View.Page.WelcomeProfile({el:"body"})},guestWelcome:function(){new a.View.Page.GuestWelcome({el:"body"})},welcomeFavoriteCommunityVisibility:function(){new a.View.Page.WelcomeFavoriteCommunityVisibility({el:"body"})},warning:function(){new a.View.Page.Warning({el:"body"})},help:function(){new a.View.Page.Help({el:"body"})},guide:function(){new a.View.Page.Common({el:"body"}),$(".guide-exit-button").length&&a.Toolbar.setVisible(!1),a.ScrollGuide.activate()},albumDetail:function(){new a.View.Page.AlbumDetail({el:"body"})},confirmAlbum:function(){new a.View.Page.ConfirmAlbum({el:"body "})},errorPostForm:function(){new a.View.Page.PostFormError({el:"body"})}}))}).call(this,Olv);
Olv.Locale.Data = {"olv.datetime":{"value":"MM/dd/yyyy h:mm a"},"olv.datetime.n3ds.date":{"args":[2,3,1],"value":"%s/%s/%s"},"olv.datetime.n3ds.date %1%2%3":{"args":[2,3,1],"value":"%s/%s/%s"},"olv.datetime.n3ds.date [_1][_2][_3]":{"args":[2,3,1],"value":"%s/%s/%s"},"olv.portal.age_gate.select_label":{"value":"Please enter your date of birth."},"olv.portal.album.delete_confirm":{"value":"Are you sure you want to delete this?"},"olv.portal.album.save_album_image":{"value":"Save Screenshot"},"olv.portal.album.save_album_image.confirm":{"value":"The screenshot has been saved. Continue using Miiverse?"},"olv.portal.back":{"value":"Back"},"olv.portal.block":{"value":"Block"},"olv.portal.blocklist.add":{"value":"Block"},"olv.portal.blocklist.block_confirm":{"value":"Are you sure you want to block this user? You will no longer receive friend requests from this user, and you will be less likely to encounter him or her in games."},"olv.portal.blocklist.block_confirm_to.for_n3ds":{"args":[1],"value":"Do you want to add %s to your blocked-user list?"},"olv.portal.blocklist.block_confirm_to.for_n3ds %1":{"args":[1],"value":"Do you want to add %s to your blocked-user list?"},"olv.portal.blocklist.block_confirm_to.for_n3ds [_1]":{"args":[1],"value":"Do you want to add %s to your blocked-user list?"},"olv.portal.blocklist.block_successed_to":{"args":[1],"value":"%s has been blocked."},"olv.portal.blocklist.block_successed_to %1":{"args":[1],"value":"%s has been blocked."},"olv.portal.blocklist.block_successed_to [_1]":{"args":[1],"value":"%s has been blocked."},"olv.portal.blocklist.delete":{"value":"Unblock"},"olv.portal.blocklist.unblock_successed_to":{"args":[1],"value":"%s has been unblocked."},"olv.portal.blocklist.unblock_successed_to %1":{"args":[1],"value":"%s has been unblocked."},"olv.portal.blocklist.unblock_successed_to [_1]":{"args":[1],"value":"%s has been unblocked."},"olv.portal.button.remove":{"value":"Yes"},"olv.portal.cancel":{"value":"Cancel"},"olv.portal.close":{"value":"Close"},"olv.portal.confirm.remove_from_blocklist":{"value":"Remove this user from your blocked-user list?"},"olv.portal.confirm.remove_from_blocklist_to":{"args":[1],"value":"Do you want to unblock\n%s?"},"olv.portal.confirm.remove_from_blocklist_to %1":{"args":[1],"value":"Do you want to unblock\n%s?"},"olv.portal.confirm.remove_from_blocklist_to [_1]":{"args":[1],"value":"Do you want to unblock\n%s?"},"olv.portal.confirm_app_jump":{"args":[],"value":"This will close Miiverse.\nAre you sure you want to proceed?"},"olv.portal.confirm_app_jump %1":{"args":[],"value":"This will close Miiverse.\nAre you sure you want to proceed?"},"olv.portal.confirm_app_jump [_1]":{"args":[],"value":"This will close Miiverse.\nAre you sure you want to proceed?"},"olv.portal.confirm_display_played_mark":{"value":"If you have played the game you're posting about, your posts and comments will have a mark indicating this."},"olv.portal.confirm_first_favorite":{"value":"Added to favorite communities."},"olv.portal.confirm_open_eshop":{"value":"This will close Miiverse.\nAre you sure you want to proceed?"},"olv.portal.confirm_syste_update.body":{"value":"You must connect to the Internet and perform a system update before you can use this feature.\nPerform a system update now?"},"olv.portal.confirm_syste_update.title":{"value":"Please Perform a System Update"},"olv.portal.confirm_url_form.body":{"value":"This web page will be displayed in the Internet browser.\n\nDo you want to close Miiverse and view this web page?"},"olv.portal.confirm_url_form.body.for_n3ds":{"value":"This web page will be displayed in the Internet browser.\n\nDo you want to close Miiverse and view this web page?"},"olv.portal.confirm_url_form.title":{"value":"Open Link"},"olv.portal.confirm_you_have_no_soft":{"value":"You do not have this software."},"olv.portal.continue_miiverse":{"value":"Continue Using Miiverse"},"olv.portal.dialog.apply_settings_done":{"value":"Settings saved."},"olv.portal.edit.action.close_topic_post":{"value":"Close for Comments"},"olv.portal.edit.action.close_topic_post.confirm":{"value":"It will no longer be possible to post comments on this discussion. Is that OK? (This action cannot be reversed.)"},"olv.portal.edit.edit_post":{"value":"Edit Post"},"olv.portal.edit.edit_reply":{"value":"Edit Comment"},"olv.portal.empathy.n_added":{"args":[1],"args_1":[1],"quanttype":"1_o","value":"%s people gave this a Yeah.","value_1":"%s person gave this a Yeah."},"olv.portal.empathy.n_added %1":{"args":[1],"args_1":[1],"quanttype":"1_o","value":"%s people gave this a Yeah.","value_1":"%s person gave this a Yeah."},"olv.portal.empathy.n_added [_1]":{"args":[1],"args_1":[1],"quanttype":"1_o","value":"%s people gave this a Yeah.","value_1":"%s person gave this a Yeah."},"olv.portal.empathy.you_added":{"value":"You gave this a Yeah."},"olv.portal.empathy.you_and_n_added":{"args":[1],"args_1":[1],"quanttype":"1_o","value":"You and %s other people gave this a Yeah.","value_1":"You and %s other person gave this a Yeah."},"olv.portal.empathy.you_and_n_added %1":{"args":[1],"args_1":[1],"quanttype":"1_o","value":"You and %s other people gave this a Yeah.","value_1":"You and %s other person gave this a Yeah."},"olv.portal.empathy.you_and_n_added [_1]":{"args":[1],"args_1":[1],"quanttype":"1_o","value":"You and %s other people gave this a Yeah.","value_1":"You and %s other person gave this a Yeah."},"olv.portal.error.500.for_n3ds":{"value":"An error has occurred.\n\nPlease wait and try again later.\n\nIf this error continues to occur, please make note of the error code and visit support.nintendo.com."},"olv.portal.error.503.content":{"value":"The server is currently\nundergoing maintenance.\n\nPlease try again later."},"olv.portal.error.album_limit_exceeded":{"value":"Unable to save because the maximum number of screenshots that can be saved has been reached. Please delete some saved screenshots, and then try again."},"olv.portal.error.code":{"args":[1],"value":"Error Code: %s"},"olv.portal.error.code %1":{"args":[1],"value":"Error Code: %s"},"olv.portal.error.code [_1]":{"args":[1],"value":"Error Code: %s"},"olv.portal.error.daily_post_limit_exceeded":{"value":"You have already exceeded the number of posts that you can contribute in a single day. Please try again tomorrow."},"olv.portal.error.failed_to_connect":{"value":"An error has occurred."},"olv.portal.error.network_unavailable":{"value":"Could not connect to the Internet.\nPlease check your network\nconnection and try again."},"olv.portal.error.post_time_restriction":{"args":[],"value":"Multiple posts cannot be made in such a short period of time. Please try posting again later."},"olv.portal.error.post_time_restriction %1":{"args":[],"value":"Multiple posts cannot be made in such a short period of time. Please try posting again later."},"olv.portal.error.post_time_restriction [_1]":{"args":[],"value":"Multiple posts cannot be made in such a short period of time. Please try posting again later."},"olv.portal.followlist.confirm_unfollow_to":{"args":[1],"value":"Stop following\n%s?"},"olv.portal.followlist.confirm_unfollow_to %1":{"args":[1],"value":"Stop following\n%s?"},"olv.portal.followlist.confirm_unfollow_to [_1]":{"args":[1],"value":"Stop following\n%s?"},"olv.portal.guest.alert.message":{"value":"A Nintendo Network ID is required to use this feature. Do you want to link a Nintendo Network ID?"},"olv.portal.guest.alert.reight":{"value":"Link"},"olv.portal.miitoo.frustrated":{"value":"Yeah..."},"olv.portal.miitoo.frustrated.delete":{"value":"Unyeah"},"olv.portal.miitoo.happy":{"value":"Yeah!"},"olv.portal.miitoo.happy.delete":{"value":"Unyeah"},"olv.portal.miitoo.like":{"value":"Yeah\u2665"},"olv.portal.miitoo.like.delete":{"value":"Unyeah"},"olv.portal.miitoo.normal":{"value":"Yeah!"},"olv.portal.miitoo.normal.delete":{"value":"Unyeah"},"olv.portal.miitoo.puzzled":{"value":"Yeah..."},"olv.portal.miitoo.puzzled.delete":{"value":"Unyeah"},"olv.portal.miitoo.surprised":{"value":"Yeah!?"},"olv.portal.miitoo.surprised.delete":{"value":"Unyeah"},"olv.portal.my_page":{"value":"User Page"},"olv.portal.n3ds.ok":{"value":"OK"},"olv.portal.n3ds.youtube.alert":{"value":"You can watch this video\nif you download the\nYouTube application from\nNintendo eShop."},"olv.portal.n3ds.youtube.alert.patch":{"value":"Please download the latest version of the YouTube application."},"olv.portal.n3ds.youtube.jump":{"value":"Do you want to close Miiverse and launch YouTube?"},"olv.portal.offline.post.delete":{"value":"Do you want to delete this post?"},"olv.portal.offline.post_form":{"value":"Create Post"},"olv.portal.offline.post_form.alert":{"value":"You cannot save any additional posts. Please delete a previously saved post before starting a new one."},"olv.portal.ok":{"value":"OK"},"olv.portal.post.delete_confirm":{"value":"Delete this post?"},"olv.portal.post.screenshot_forbidden.for_n3ds":{"value":"This screenshot cannot be attached."},"olv.portal.post.screenshot_required":{"value":"Please select a screenshot."},"olv.portal.profile_post":{"value":"Favorite Post"},"olv.portal.profile_post.confirm_remove":{"value":"Remove this post from your profile?\nThe original post will not be deleted."},"olv.portal.profile_post.confirm_update":{"value":"Set this post as your favorite?\nPlease note, it will replace any existing favorite post."},"olv.portal.profile_post.confirm_update.yes":{"value":"OK"},"olv.portal.profile_post.done":{"value":"Your favorite post has been set.\nWould you like to view your profile?"},"olv.portal.read_more_content":{"value":"Read More"},"olv.portal.reply.delete_confirm":{"value":"Delete this comment?"},"olv.portal.setup":{"value":"Set Up"},"olv.portal.show_more_content":{"value":"View Entire Post"},"olv.portal.stop":{"value":"Cancel"},"olv.portal.unfavorite_succeeded_to":{"value":"Removed from favorites."},"olv.portal.unfollow":{"value":"Unfollow"},"olv.portal.unfollow_succeeded_to":{"args":[1],"value":"You are no longer following\n%s."},"olv.portal.unfollow_succeeded_to %1":{"args":[1],"value":"You are no longer following\n%s."},"olv.portal.unfollow_succeeded_to [_1]":{"args":[1],"value":"You are no longer following\n%s."},"olv.portal.user.search.found_message":{"args":[1],"value":"Found: %s"},"olv.portal.user.search.found_message %1":{"args":[1],"value":"Found: %s"},"olv.portal.user.search.found_message [_1]":{"args":[1],"value":"Found: %s"},"olv.portal.user.search.go":{"value":"View Profile"},"olv.portal.user.search.not_found_message":{"args":[1],"value":"\"%s\" could not be found.\nSelect Retry Search if you want to try again."},"olv.portal.user.search.not_found_message %1":{"args":[1],"value":"\"%s\" could not be found.\nSelect Retry Search if you want to try again."},"olv.portal.user.search.not_found_message [_1]":{"args":[1],"value":"\"%s\" could not be found.\nSelect Retry Search if you want to try again."},"olv.portal.welcome.select_game_skill":{"value":"Select your skill level."},"olv.portal.welcome.select_luminous_opt_in":{"value":"Please select a notification option."},"olv.portal.yes":{"value":"Yes"},"olv.potal.n3ds.youtube.jump":{"value":"Do you want to close Miiverse and launch YouTube?"}};
